---
title: Retrieve and detect changes to metadata (Developer Guide for Dynamics 365 for Customer Engagement apps) | MicrosoftDocs
description: The classes in the Query namespace and the RetrieveMetadataChangesRequest and RetrieveMetadataChangesResponse classes let you build efficient metadata queries and capture changes to metadata as they occur over time.
ms.custom: ''
ms.date: 10/31/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: 11c1d485-e5e9-40ac-8ac1-76504ba8bef5
caps.latest.revision: 29
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 0a82f33297d8337d0ab8cecb47bf7939122360ed
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "386219"
---
# <a name="retrieve-and-detect-changes-to-metadata"></a><span data-ttu-id="e26a7-103">Retrieve and detect changes to metadata</span><span class="sxs-lookup"><span data-stu-id="e26a7-103">Retrieve and detect changes to metadata</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="e26a7-104">The classes in the <xref:Microsoft.Xrm.Sdk.Metadata.Query> namespace and the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest> and <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse> classes let you build efficient metadata queries and capture changes to metadata as they occur over time.</span><span class="sxs-lookup"><span data-stu-id="e26a7-104">The classes in the <xref:Microsoft.Xrm.Sdk.Metadata.Query> namespace and the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest> and <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse> classes let you build efficient metadata queries and capture changes to metadata as they occur over time.</span></span>  
  
 <span data-ttu-id="e26a7-105">All code examples referenced in this document are found in [Sample: Query Metadata and Detect Changes](org-service/sample-query-metadata-detect-changes.md).</span><span class="sxs-lookup"><span data-stu-id="e26a7-105">All code examples referenced in this document are found in [Sample: Query Metadata and Detect Changes](org-service/sample-query-metadata-detect-changes.md).</span></span>  
  
 <span data-ttu-id="e26a7-106">The technical article [Query Metadata Using JavaScript](https://msdn.microsoft.com/library/jj919080.aspx) provides a [!INCLUDE[pn_JavaScript](../includes/pn-javascript.md)] library to use the objects and messages in client-sided code.</span><span class="sxs-lookup"><span data-stu-id="e26a7-106">The technical article [Query Metadata Using JavaScript](https://msdn.microsoft.com/library/jj919080.aspx) provides a [!INCLUDE[pn_JavaScript](../includes/pn-javascript.md)] library to use the objects and messages in client-sided code.</span></span>  
  
<a name="BKMK_MetadataStrategies"></a> 
  
## <a name="strategies-for-using-metadata"></a><span data-ttu-id="e26a7-107">Strategies for using metadata</span><span class="sxs-lookup"><span data-stu-id="e26a7-107">Strategies for using metadata</span></span>  

 <span data-ttu-id="e26a7-108">Metadata lets you create applications that adapt as the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] Customer Engagement data model changes.</span><span class="sxs-lookup"><span data-stu-id="e26a7-108">Metadata lets you create applications that adapt as the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] Customer Engagement data model changes.</span></span> <span data-ttu-id="e26a7-109">Metadata is important for the following types of application:</span><span class="sxs-lookup"><span data-stu-id="e26a7-109">Metadata is important for the following types of application:</span></span>  
  
- <span data-ttu-id="e26a7-110">UI for client applications</span><span class="sxs-lookup"><span data-stu-id="e26a7-110">UI for client applications</span></span>  
  
- <span data-ttu-id="e26a7-111">Integration tools that have to map Dynamics 365 for Customer Engagement apps data to external systems</span><span class="sxs-lookup"><span data-stu-id="e26a7-111">Integration tools that have to map Dynamics 365 for Customer Engagement apps data to external systems</span></span>  
  
- <span data-ttu-id="e26a7-112">Development tools</span><span class="sxs-lookup"><span data-stu-id="e26a7-112">Development tools</span></span>  
  
  <span data-ttu-id="e26a7-113">Using the classes in the <xref:Microsoft.Xrm.Sdk.Metadata.Query> namespace you can implement designs that will exist somewhere between a lightweight query and a persistent metadata cache.</span><span class="sxs-lookup"><span data-stu-id="e26a7-113">Using the classes in the <xref:Microsoft.Xrm.Sdk.Metadata.Query> namespace you can implement designs that will exist somewhere between a lightweight query and a persistent metadata cache.</span></span>  
  
### <a name="lightweight-query"></a><span data-ttu-id="e26a7-114">Lightweight query</span><span class="sxs-lookup"><span data-stu-id="e26a7-114">Lightweight query</span></span>
  
 <span data-ttu-id="e26a7-115">An example of a lightweight query is when you have a custom web resource UI that provides a select control to display the current options in a Dynamics 365 for Customer Engagement Option Set (Picklist) attribute.</span><span class="sxs-lookup"><span data-stu-id="e26a7-115">An example of a lightweight query is when you have a custom web resource UI that provides a select control to display the current options in a Dynamics 365 for Customer Engagement Option Set (Picklist) attribute.</span></span> <span data-ttu-id="e26a7-116">You do not want to hard-code these options because you would have to update that code if the available options are ever changed.</span><span class="sxs-lookup"><span data-stu-id="e26a7-116">You do not want to hard-code these options because you would have to update that code if the available options are ever changed.</span></span> <span data-ttu-id="e26a7-117">Instead you can construct a query to just retrieve those options values and labels from the metadata.</span><span class="sxs-lookup"><span data-stu-id="e26a7-117">Instead you can construct a query to just retrieve those options values and labels from the metadata.</span></span>  
  
 <span data-ttu-id="e26a7-118">You do not have to cache this data because you can use the <xref:Microsoft.Xrm.Sdk.Metadata.Query> classes to retrieve this data directly from the Dynamics 365 for Customer Engagement application cache.</span><span class="sxs-lookup"><span data-stu-id="e26a7-118">You do not have to cache this data because you can use the <xref:Microsoft.Xrm.Sdk.Metadata.Query> classes to retrieve this data directly from the Dynamics 365 for Customer Engagement application cache.</span></span>  
  
### <a name="persistent-metadata-cache"></a><span data-ttu-id="e26a7-119">Persistent metadata cache</span><span class="sxs-lookup"><span data-stu-id="e26a7-119">Persistent metadata cache</span></span>
  
 <span data-ttu-id="e26a7-120">When you have an application that must be able to work while disconnected from the Dynamics 365 for Customer Engagement server, or that is sensitive to limited network bandwidth between the client and the server, such as a mobile application, you will want to implement a persistent metadata cache.</span><span class="sxs-lookup"><span data-stu-id="e26a7-120">When you have an application that must be able to work while disconnected from the Dynamics 365 for Customer Engagement server, or that is sensitive to limited network bandwidth between the client and the server, such as a mobile application, you will want to implement a persistent metadata cache.</span></span>  
  
 <span data-ttu-id="e26a7-121">With a persistent metadata cache your application will have to query all the necessary metadata the first time it connects.</span><span class="sxs-lookup"><span data-stu-id="e26a7-121">With a persistent metadata cache your application will have to query all the necessary metadata the first time it connects.</span></span> <span data-ttu-id="e26a7-122">Then you will save that data in the application.</span><span class="sxs-lookup"><span data-stu-id="e26a7-122">Then you will save that data in the application.</span></span> <span data-ttu-id="e26a7-123">The next time the application connects to the server you can retrieve just the difference since your last query, which should be much less data to transmit, and then merge the changes into your metadata cache when your application is loading.</span><span class="sxs-lookup"><span data-stu-id="e26a7-123">The next time the application connects to the server you can retrieve just the difference since your last query, which should be much less data to transmit, and then merge the changes into your metadata cache when your application is loading.</span></span>  
  
 <span data-ttu-id="e26a7-124">How frequently you should poll for metadata changes depends on the expected volatility of metadata for your application and how long your application will remaining running.</span><span class="sxs-lookup"><span data-stu-id="e26a7-124">How frequently you should poll for metadata changes depends on the expected volatility of metadata for your application and how long your application will remaining running.</span></span> <span data-ttu-id="e26a7-125">There is no event available that you can use to detect when metadata changes occur.</span><span class="sxs-lookup"><span data-stu-id="e26a7-125">There is no event available that you can use to detect when metadata changes occur.</span></span> <span data-ttu-id="e26a7-126">There is a limit to the number of days that deleted metadata changes are saved and a request for changes that occurs beyond that limit will require a full re-initialization of the metadata cache.</span><span class="sxs-lookup"><span data-stu-id="e26a7-126">There is a limit to the number of days that deleted metadata changes are saved and a request for changes that occurs beyond that limit will require a full re-initialization of the metadata cache.</span></span> <span data-ttu-id="e26a7-127">For more information see [Deleted metadata expiration](retrieve-detect-changes-metadata.md#BKMK_DeletedMetadataExpiration).</span><span class="sxs-lookup"><span data-stu-id="e26a7-127">For more information see [Deleted metadata expiration](retrieve-detect-changes-metadata.md#BKMK_DeletedMetadataExpiration).</span></span>  
  
 <span data-ttu-id="e26a7-128">When there are no changes the query should respond quickly and there will be no data to transmit back.</span><span class="sxs-lookup"><span data-stu-id="e26a7-128">When there are no changes the query should respond quickly and there will be no data to transmit back.</span></span> <span data-ttu-id="e26a7-129">However, if there are changes, especially if there are deleted metadata items that have to be removed from your cache, you can expect that the request may take some additional time to finish.</span><span class="sxs-lookup"><span data-stu-id="e26a7-129">However, if there are changes, especially if there are deleted metadata items that have to be removed from your cache, you can expect that the request may take some additional time to finish.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="e26a7-130">[Performance When Retrieving Deleted Metadata](retrieve-detect-changes-metadata.md#BKMK_PerformanceRetrievingDeletedMetadata)</span><span class="sxs-lookup"><span data-stu-id="e26a7-130">[Performance When Retrieving Deleted Metadata](retrieve-detect-changes-metadata.md#BKMK_PerformanceRetrievingDeletedMetadata)</span></span>  
  
<a name="BKMK_RetrieveJusttheMetadataYouNeed"></a>
   
## <a name="retrieve-only-the-metadata-you-need"></a><span data-ttu-id="e26a7-131">Retrieve only the metadata you need</span><span class="sxs-lookup"><span data-stu-id="e26a7-131">Retrieve only the metadata you need</span></span>  

 <span data-ttu-id="e26a7-132">Metadata is frequently retrieved or synchronized when an application starts and can affect the time the application takes to load.</span><span class="sxs-lookup"><span data-stu-id="e26a7-132">Metadata is frequently retrieved or synchronized when an application starts and can affect the time the application takes to load.</span></span> <span data-ttu-id="e26a7-133">This is particularly true for mobile applications retrieving metadata for the first time.</span><span class="sxs-lookup"><span data-stu-id="e26a7-133">This is particularly true for mobile applications retrieving metadata for the first time.</span></span> <span data-ttu-id="e26a7-134">Retrieving only the metadata you need is very important to create an application that performs well.</span><span class="sxs-lookup"><span data-stu-id="e26a7-134">Retrieving only the metadata you need is very important to create an application that performs well.</span></span>  
  
 <span data-ttu-id="e26a7-135">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression> class provides a structure consistent with the <xref:Microsoft.Xrm.Sdk.Query.QueryExpression> class you use to create complex queries to retrieve entity data.</span><span class="sxs-lookup"><span data-stu-id="e26a7-135">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression> class provides a structure consistent with the <xref:Microsoft.Xrm.Sdk.Query.QueryExpression> class you use to create complex queries to retrieve entity data.</span></span> <span data-ttu-id="e26a7-136">Unlike the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAllEntitiesRequest>, <xref:Microsoft.Xrm.Sdk.Messages.RetrieveEntityRequest>,  <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAttributeRequest>, or <xref:Microsoft.Xrm.Sdk.Messages.RetrieveRelationshipRequest> classes, the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest> contains a `Query` parameter that accepts an <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression> instance that you can use to specify specific criteria for the data to return in addition to which properties you want.</span><span class="sxs-lookup"><span data-stu-id="e26a7-136">Unlike the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAllEntitiesRequest>, <xref:Microsoft.Xrm.Sdk.Messages.RetrieveEntityRequest>,  <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAttributeRequest>, or <xref:Microsoft.Xrm.Sdk.Messages.RetrieveRelationshipRequest> classes, the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest> contains a `Query` parameter that accepts an <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression> instance that you can use to specify specific criteria for the data to return in addition to which properties you want.</span></span> <span data-ttu-id="e26a7-137">You can use <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest> to return the full set of metadata that you get using the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAllEntitiesRequest>, or just a label for a specific attribute.</span><span class="sxs-lookup"><span data-stu-id="e26a7-137">You can use <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest> to return the full set of metadata that you get using the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAllEntitiesRequest>, or just a label for a specific attribute.</span></span>  
  
### <a name="specify-your-filter-criteria"></a><span data-ttu-id="e26a7-138">Specify your filter criteria</span><span class="sxs-lookup"><span data-stu-id="e26a7-138">Specify your filter criteria</span></span>  

 <span data-ttu-id="e26a7-139">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria></span><span class="sxs-lookup"><span data-stu-id="e26a7-139">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria></span></span> <span data-ttu-id="e26a7-140">property accepts a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression> that contains a collection of <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionExpression> objects that allow for defining conditions for filtering entity properties based on their value.</span><span class="sxs-lookup"><span data-stu-id="e26a7-140">property accepts a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression> that contains a collection of <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionExpression> objects that allow for defining conditions for filtering entity properties based on their value.</span></span> <span data-ttu-id="e26a7-141">These conditions use a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator> that allows for the following operators:</span><span class="sxs-lookup"><span data-stu-id="e26a7-141">These conditions use a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator> that allows for the following operators:</span></span>  
  
- <span data-ttu-id="e26a7-142"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.Equals</span><span class="sxs-lookup"><span data-stu-id="e26a7-142"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.Equals</span></span>  
  
- <span data-ttu-id="e26a7-143"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.NotEquals</span><span class="sxs-lookup"><span data-stu-id="e26a7-143"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.NotEquals</span></span>  
  
- <span data-ttu-id="e26a7-144"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.In</span><span class="sxs-lookup"><span data-stu-id="e26a7-144"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.In</span></span>  
  
- <span data-ttu-id="e26a7-145"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.NotIn</span><span class="sxs-lookup"><span data-stu-id="e26a7-145"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.NotIn</span></span>  
  
- <span data-ttu-id="e26a7-146"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.GreaterThan</span><span class="sxs-lookup"><span data-stu-id="e26a7-146"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.GreaterThan</span></span>  
  
- <span data-ttu-id="e26a7-147"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.LessThan</span><span class="sxs-lookup"><span data-stu-id="e26a7-147"><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataConditionOperator>.LessThan</span></span>  
  
  <span data-ttu-id="e26a7-148">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression> also includes a <xref:Microsoft.Xrm.Sdk.Query.LogicalOperator> to represent whether to apply `And` or `Or` logic when you evaluate the conditions.</span><span class="sxs-lookup"><span data-stu-id="e26a7-148">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression> also includes a <xref:Microsoft.Xrm.Sdk.Query.LogicalOperator> to represent whether to apply `And` or `Or` logic when you evaluate the conditions.</span></span>  
  
  <span data-ttu-id="e26a7-149">Not all properties can be used as filter criteria.</span><span class="sxs-lookup"><span data-stu-id="e26a7-149">Not all properties can be used as filter criteria.</span></span> <span data-ttu-id="e26a7-150">Only properties that represent simple data types, enumerations, <xref:Microsoft.Xrm.Sdk.BooleanManagedProperty> or <xref:Microsoft.Xrm.Sdk.Metadata.AttributeRequiredLevelManagedProperty> types can be used in a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-150">Only properties that represent simple data types, enumerations, <xref:Microsoft.Xrm.Sdk.BooleanManagedProperty> or <xref:Microsoft.Xrm.Sdk.Metadata.AttributeRequiredLevelManagedProperty> types can be used in a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression>.</span></span> <span data-ttu-id="e26a7-151">When a <xref:Microsoft.Xrm.Sdk.BooleanManagedProperty> or <xref:Microsoft.Xrm.Sdk.Metadata.AttributeRequiredLevelManagedProperty> is specified, only the `Value` property is evaluated.</span><span class="sxs-lookup"><span data-stu-id="e26a7-151">When a <xref:Microsoft.Xrm.Sdk.BooleanManagedProperty> or <xref:Microsoft.Xrm.Sdk.Metadata.AttributeRequiredLevelManagedProperty> is specified, only the `Value` property is evaluated.</span></span>  
  
  <span data-ttu-id="e26a7-152">The following table lists <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata> properties that cannot be used in a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression>:</span><span class="sxs-lookup"><span data-stu-id="e26a7-152">The following table lists <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata> properties that cannot be used in a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression>:</span></span>  
  
|||||  
|-|-|-|-|  
|<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Attributes>|<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Description>|<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.DisplayCollectionName>|<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.DisplayName>|  
|<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.ManyToManyRelationships>|<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.ManyToOneRelationships>|<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.OneToManyRelationships>|<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Privileges>|  
  
 <span data-ttu-id="e26a7-153">The following example shows a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression> that will return a set of non-intersect, user-owned entities not included in a list of entities to exclude:</span><span class="sxs-lookup"><span data-stu-id="e26a7-153">The following example shows a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression> that will return a set of non-intersect, user-owned entities not included in a list of entities to exclude:</span></span>  
  
 [!code-csharp[MetadataQuery#EntityFilter](../snippets/csharp/CRMV8/metadataquery/cs/entityfilter.cs#entityfilter)]  

  
### <a name="specify-the-properties-you-want"></a><span data-ttu-id="e26a7-154">Specify the properties you want</span><span class="sxs-lookup"><span data-stu-id="e26a7-154">Specify the properties you want</span></span>
  
 <span data-ttu-id="e26a7-155">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties> property accepts a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-155">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties> property accepts a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression>.</span></span> <span data-ttu-id="e26a7-156">You can set <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression.AllProperties></span><span class="sxs-lookup"><span data-stu-id="e26a7-156">You can set <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression.AllProperties></span></span> <span data-ttu-id="e26a7-157">to `true` if you want to return all the properties or you can provide a collection of strings to the <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression.PropertyNames></span><span class="sxs-lookup"><span data-stu-id="e26a7-157">to `true` if you want to return all the properties or you can provide a collection of strings to the <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataPropertiesExpression.PropertyNames></span></span> <span data-ttu-id="e26a7-158">to define which properties you want to include in the results.</span><span class="sxs-lookup"><span data-stu-id="e26a7-158">to define which properties you want to include in the results.</span></span>  
  
 <span data-ttu-id="e26a7-159">The strongly typed objects returned will include all properties, but only those that you request will have data.</span><span class="sxs-lookup"><span data-stu-id="e26a7-159">The strongly typed objects returned will include all properties, but only those that you request will have data.</span></span> <span data-ttu-id="e26a7-160">All other properties will be null, with the following few exceptions: every item of metadata will include the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.MetadataId> ,`LogicalName` and <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.HasChanged> values if they exist for that item.</span><span class="sxs-lookup"><span data-stu-id="e26a7-160">All other properties will be null, with the following few exceptions: every item of metadata will include the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.MetadataId> ,`LogicalName` and <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.HasChanged> values if they exist for that item.</span></span> <span data-ttu-id="e26a7-161">You do not have to specify them in the <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties> you request.</span><span class="sxs-lookup"><span data-stu-id="e26a7-161">You do not have to specify them in the <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties> you request.</span></span>  
  
 <span data-ttu-id="e26a7-162">If you are not using managed code and are actually parsing the `responseXML` returned from the XMLHttpRequest you will get elements for each property but only those you request will contain data.</span><span class="sxs-lookup"><span data-stu-id="e26a7-162">If you are not using managed code and are actually parsing the `responseXML` returned from the XMLHttpRequest you will get elements for each property but only those you request will contain data.</span></span> <span data-ttu-id="e26a7-163">The following XML shows the contact entity metadata xml that will be returned when `IsVisibleInMobile` is the only property requested.</span><span class="sxs-lookup"><span data-stu-id="e26a7-163">The following XML shows the contact entity metadata xml that will be returned when `IsVisibleInMobile` is the only property requested.</span></span>  
  
```xml  
<a:EntityMetadata>  
 <c:MetadataId>608861bc-50a4-4c5f-a02c-21fe1943e2cf</c:MetadataId>  
 <c:HasChanged i:nil="true"/>  
 <c:ActivityTypeMask i:nil="true"/>  
 <c:Attributes i:nil="true"/>  
 <c:AutoRouteToOwnerQueue i:nil="true"/>  
 <c:CanBeInManyToMany i:nil="true"/>  
 <c:CanBePrimaryEntityInRelationship i:nil="true"/>  
 <c:CanBeRelatedEntityInRelationship i:nil="true"/>  
 <c:CanCreateAttributes i:nil="true"/>  
 <c:CanCreateCharts i:nil="true"/>  
 <c:CanCreateForms i:nil="true"/>  
 <c:CanCreateViews i:nil="true"/>  
 <c:CanModifyAdditionalSettings i:nil="true"/>  
 <c:CanTriggerWorkflow i:nil="true"/>  
 <c:Description i:nil="true"/>  
 <c:DisplayCollectionName i:nil="true"/>  
 <c:DisplayName i:nil="true"/>  
 <c:IconLargeName i:nil="true"/>  
 <c:IconMediumName i:nil="true"/>  
 <c:IconSmallName i:nil="true"/>  
 <c:IsActivity i:nil="true"/>  
 <c:IsActivityParty i:nil="true"/>  
 <c:IsAuditEnabled i:nil="true"/>  
 <c:IsAvailableOffline i:nil="true"/>  
 <c:IsChildEntity i:nil="true"/>  
 <c:IsConnectionsEnabled i:nil="true"/>  
 <c:IsCustomEntity i:nil="true"/>  
 <c:IsCustomizable i:nil="true"/>  
 <c:IsDocumentManagementEnabled i:nil="true"/>  
 <c:IsDuplicateDetectionEnabled i:nil="true"/>  
 <c:IsEnabledForCharts i:nil="true"/>  
 <c:IsImportable i:nil="true"/>  
 <c:IsIntersect i:nil="true"/>  
 <c:IsMailMergeEnabled i:nil="true"/>  
 <c:IsManaged i:nil="true"/>  
 <c:IsMappable i:nil="true"/>  
 <c:IsReadingPaneEnabled i:nil="true"/>  
 <c:IsRenameable i:nil="true"/>  
 <c:IsValidForAdvancedFind i:nil="true"/>  
 <c:IsValidForQueue i:nil="true"/>  
 <c:IsVisibleInMobile>  
  <a:CanBeChanged>false</a:CanBeChanged>  
  <a:ManagedPropertyLogicalName>canmodifymobilevisibility</a:ManagedPropertyLogicalName>  
  <a:Value>false</a:Value>  
 </c:IsVisibleInMobile>  
 <c:LogicalName>contact</c:LogicalName>  
 <c:ManyToManyRelationships i:nil="true"/>  
 <c:ManyToOneRelationships i:nil="true"/>  
 <c:ObjectTypeCode i:nil="true"/>  
 <c:OneToManyRelationships i:nil="true"/>  
 <c:OwnershipType i:nil="true"/>  
 <c:PrimaryIdAttribute i:nil="true"/>  
 <c:PrimaryNameAttribute i:nil="true"/>  
 <c:Privileges i:nil="true"/>  
 <c:RecurrenceBaseEntityLogicalName i:nil="true"/>  
 <c:ReportViewName i:nil="true"/>  
 <c:SchemaName i:nil="true"/>  
</a:EntityMetadata>  
  
```  
  
 <span data-ttu-id="e26a7-164">In a future release further efficiencies may be achieved by not returning elements with null values for properties that were not requested.</span><span class="sxs-lookup"><span data-stu-id="e26a7-164">In a future release further efficiencies may be achieved by not returning elements with null values for properties that were not requested.</span></span> <span data-ttu-id="e26a7-165">If you write code to parse this XML you should expect that the XML returned for the same query could be reduced to only the following XML.</span><span class="sxs-lookup"><span data-stu-id="e26a7-165">If you write code to parse this XML you should expect that the XML returned for the same query could be reduced to only the following XML.</span></span>  
  
```xml  
<a:EntityMetadata>  
 <c:MetadataId>608861bc-50a4-4c5f-a02c-21fe1943e2cf</c:MetadataId>  
 <c:IsVisibleInMobile>  
  <a:CanBeChanged>false</a:CanBeChanged>  
  <a:ManagedPropertyLogicalName>canmodifymobilevisibility</a:ManagedPropertyLogicalName>  
  <a:Value>false</a:Value>  
 </c:IsVisibleInMobile>  
 <c:LogicalName>contact</c:LogicalName>  
</a:EntityMetadata>  
```  
  
 <span data-ttu-id="e26a7-166">Metadata is returned in a hierarchical structure just as it is using the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAllEntitiesRequest>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-166">Metadata is returned in a hierarchical structure just as it is using the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAllEntitiesRequest>.</span></span> <span data-ttu-id="e26a7-167">To access a specific attribute or relationship you must create a query that returns the entity they are part of.</span><span class="sxs-lookup"><span data-stu-id="e26a7-167">To access a specific attribute or relationship you must create a query that returns the entity they are part of.</span></span> <span data-ttu-id="e26a7-168">If you want to retrieve data about a specific attribute, you must include the <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Attributes></span><span class="sxs-lookup"><span data-stu-id="e26a7-168">If you want to retrieve data about a specific attribute, you must include the <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Attributes></span></span> <span data-ttu-id="e26a7-169">property in your <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-169">property in your <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties>.</span></span> <span data-ttu-id="e26a7-170">For the entity relationships to be returned, you must include one or more of the following <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata> properties:  <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.ManyToManyRelationships>,  <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.ManyToOneRelationships>, or <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.OneToManyRelationships>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-170">For the entity relationships to be returned, you must include one or more of the following <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata> properties:  <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.ManyToManyRelationships>,  <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.ManyToOneRelationships>, or <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.OneToManyRelationships>.</span></span>  
  
 <span data-ttu-id="e26a7-171">The following example will return the `Attributes` property for requested entities:</span><span class="sxs-lookup"><span data-stu-id="e26a7-171">The following example will return the `Attributes` property for requested entities:</span></span>  
  
 [!code-csharp[MetadataQuery#EntityProperties](../snippets/csharp/CRMV8/metadataquery/cs/entityproperties.cs#entityproperties)]  

### <a name="retrieve-attribute-metadata"></a><span data-ttu-id="e26a7-172">Retrieve attribute metadata</span><span class="sxs-lookup"><span data-stu-id="e26a7-172">Retrieve attribute metadata</span></span> 
 
 <span data-ttu-id="e26a7-173">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression.AttributeQuery></span><span class="sxs-lookup"><span data-stu-id="e26a7-173">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression.AttributeQuery></span></span> <span data-ttu-id="e26a7-174">property accepts an <xref:Microsoft.Xrm.Sdk.Metadata.Query.AttributeQueryExpression> that defines <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria> and <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties> for attributes to be returned for the entities that match the <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria> and <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-174">property accepts an <xref:Microsoft.Xrm.Sdk.Metadata.Query.AttributeQueryExpression> that defines <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria> and <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties> for attributes to be returned for the entities that match the <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria> and <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties>.</span></span>  
  
 <span data-ttu-id="e26a7-175">The following table lists <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata> properties that cannot be used in a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression></span><span class="sxs-lookup"><span data-stu-id="e26a7-175">The following table lists <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata> properties that cannot be used in a <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataFilterExpression></span></span>  
  
|||  
|-|-|  
|<xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.Description>|<xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.DisplayName>|  
|<xref:Microsoft.Xrm.Sdk.Metadata.EnumAttributeMetadata.OptionSet>|<xref:Microsoft.Xrm.Sdk.Metadata.LookupAttributeMetadata.Targets>|  
  
 <span data-ttu-id="e26a7-176">The following example will limit Attributes returned to only those that have an `OptionSet` and will only return the <xref:Microsoft.Xrm.Sdk.Metadata.EnumAttributeMetadata.OptionSet> and <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.AttributeType> properties for those attributes:</span><span class="sxs-lookup"><span data-stu-id="e26a7-176">The following example will limit Attributes returned to only those that have an `OptionSet` and will only return the <xref:Microsoft.Xrm.Sdk.Metadata.EnumAttributeMetadata.OptionSet> and <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.AttributeType> properties for those attributes:</span></span>  
  
 [!code-csharp[MetadataQuery#AttributeQueryExpression](../snippets/csharp/CRMV8/metadataquery/cs/attributequeryexpression.cs#attributequeryexpression)]  
  
### <a name="retrieve-relationship-metadata"></a><span data-ttu-id="e26a7-177">Retrieve relationship metadata</span><span class="sxs-lookup"><span data-stu-id="e26a7-177">Retrieve relationship metadata</span></span>
  
 <span data-ttu-id="e26a7-178">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression.RelationshipQuery></span><span class="sxs-lookup"><span data-stu-id="e26a7-178">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression.RelationshipQuery></span></span> <span data-ttu-id="e26a7-179">property accepts a <xref:Microsoft.Xrm.Sdk.Metadata.Query.RelationshipQueryExpression> to specify the entity relationship <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria> and <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties> you want for the entities that match the <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria> and <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-179">property accepts a <xref:Microsoft.Xrm.Sdk.Metadata.Query.RelationshipQueryExpression> to specify the entity relationship <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria> and <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties> you want for the entities that match the <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression><xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Criteria> and <xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties>.</span></span>  
  
 <span data-ttu-id="e26a7-180">Use the <xref:Microsoft.Xrm.Sdk.Metadata.RelationshipMetadataBase.RelationshipType> property in your criteria to specify whether you want to return ManyToMany Relationships or OneToMany Relationships.</span><span class="sxs-lookup"><span data-stu-id="e26a7-180">Use the <xref:Microsoft.Xrm.Sdk.Metadata.RelationshipMetadataBase.RelationshipType> property in your criteria to specify whether you want to return ManyToMany Relationships or OneToMany Relationships.</span></span>  
  
 <span data-ttu-id="e26a7-181">The following table lists Relationship metadata properties that cannot be used in a MetadataFilterExpression:</span><span class="sxs-lookup"><span data-stu-id="e26a7-181">The following table lists Relationship metadata properties that cannot be used in a MetadataFilterExpression:</span></span>  
  
||  
|-|  
|<span data-ttu-id="e26a7-182"><xref:Microsoft.Xrm.Sdk.Metadata.OneToManyRelationshipMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.OneToManyRelationshipMetadata.AssociatedMenuConfiguration></span><span class="sxs-lookup"><span data-stu-id="e26a7-182"><xref:Microsoft.Xrm.Sdk.Metadata.OneToManyRelationshipMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.OneToManyRelationshipMetadata.AssociatedMenuConfiguration></span></span>|  
|<span data-ttu-id="e26a7-183"><xref:Microsoft.Xrm.Sdk.Metadata.OneToManyRelationshipMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.OneToManyRelationshipMetadata.CascadeConfiguration></span><span class="sxs-lookup"><span data-stu-id="e26a7-183"><xref:Microsoft.Xrm.Sdk.Metadata.OneToManyRelationshipMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.OneToManyRelationshipMetadata.CascadeConfiguration></span></span>|  
|<span data-ttu-id="e26a7-184"><xref:Microsoft.Xrm.Sdk.Metadata.ManyToManyRelationshipMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.ManyToManyRelationshipMetadata.Entity1AssociatedMenuConfiguration></span><span class="sxs-lookup"><span data-stu-id="e26a7-184"><xref:Microsoft.Xrm.Sdk.Metadata.ManyToManyRelationshipMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.ManyToManyRelationshipMetadata.Entity1AssociatedMenuConfiguration></span></span>|  
|<span data-ttu-id="e26a7-185"><xref:Microsoft.Xrm.Sdk.Metadata.ManyToManyRelationshipMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.ManyToManyRelationshipMetadata.Entity2AssociatedMenuConfiguration></span><span class="sxs-lookup"><span data-stu-id="e26a7-185"><xref:Microsoft.Xrm.Sdk.Metadata.ManyToManyRelationshipMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.ManyToManyRelationshipMetadata.Entity2AssociatedMenuConfiguration></span></span>|  
  
### <a name="retrieve-labels"></a><span data-ttu-id="e26a7-186">Retrieve labels</span><span class="sxs-lookup"><span data-stu-id="e26a7-186">Retrieve labels</span></span>
  
 <span data-ttu-id="e26a7-187">Finally, the <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression.LabelQuery></span><span class="sxs-lookup"><span data-stu-id="e26a7-187">Finally, the <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression.LabelQuery></span></span> <span data-ttu-id="e26a7-188">property accepts a <xref:Microsoft.Xrm.Sdk.Metadata.Query.LabelQueryExpression> that lets you specify one or more integer `LCID` values for to determine which localized labels to return.</span><span class="sxs-lookup"><span data-stu-id="e26a7-188">property accepts a <xref:Microsoft.Xrm.Sdk.Metadata.Query.LabelQueryExpression> that lets you specify one or more integer `LCID` values for to determine which localized labels to return.</span></span> [!INCLUDE[LCID](../includes/lcid.md)] <span data-ttu-id="e26a7-189">If an organization has many language packs installed the labels for all languages will be returned unless you specify a <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression.LabelQuery>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-189">If an organization has many language packs installed the labels for all languages will be returned unless you specify a <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression.LabelQuery>.</span></span>  
  
 <span data-ttu-id="e26a7-190">The following example defines a <xref:Microsoft.Xrm.Sdk.Metadata.Query.LabelQueryExpression> that will limit labels to only those representing the users preferred language.</span><span class="sxs-lookup"><span data-stu-id="e26a7-190">The following example defines a <xref:Microsoft.Xrm.Sdk.Metadata.Query.LabelQueryExpression> that will limit labels to only those representing the users preferred language.</span></span>  
  
 [!code-csharp[MetadataQuery#LabelQueryExpression0](../snippets/csharp/CRMV8/metadataquery/cs/labelqueryexpression0.cs#labelqueryexpression0)]  
[!code-csharp[MetadataQuery#LabelQueryExpression1](../snippets/csharp/CRMV8/metadataquery/cs/labelqueryexpression1.cs#labelqueryexpression1)]  
[!code-csharp[MetadataQuery#LabelQueryExpression2](../snippets/csharp/CRMV8/metadataquery/cs/labelqueryexpression2.cs#labelqueryexpression2)]  
[!code-csharp[MetadataQuery#LabelQueryExpression3](../snippets/csharp/CRMV8/metadataquery/cs/labelqueryexpression3.cs#labelqueryexpression3)]  
  
<a name="BKMK_RetrievingNeworChangedMetadata"></a> 
  
## <a name="retrieve-new-or-changed-metadata"></a><span data-ttu-id="e26a7-191">Retrieve new or changed metadata</span><span class="sxs-lookup"><span data-stu-id="e26a7-191">Retrieve new or changed metadata</span></span>

 <span data-ttu-id="e26a7-192">The <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse> class returns a strongly typed <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadataCollection> that contains the requested data.</span><span class="sxs-lookup"><span data-stu-id="e26a7-192">The <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse> class returns a strongly typed <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadataCollection> that contains the requested data.</span></span> <span data-ttu-id="e26a7-193">The <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse> class also provides a <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse.ServerVersionStamp> value that you can pass to the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp></span><span class="sxs-lookup"><span data-stu-id="e26a7-193">The <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse> class also provides a <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse.ServerVersionStamp> value that you can pass to the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp></span></span> <span data-ttu-id="e26a7-194">property in later requests.</span><span class="sxs-lookup"><span data-stu-id="e26a7-194">property in later requests.</span></span> <span data-ttu-id="e26a7-195">When a value is included for the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> property, only data that matches the <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression> and has changed since the `ClientVersionStamp` was retrieved will be returned.</span><span class="sxs-lookup"><span data-stu-id="e26a7-195">When a value is included for the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> property, only data that matches the <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression> and has changed since the `ClientVersionStamp` was retrieved will be returned.</span></span> <span data-ttu-id="e26a7-196">The only exception to this is when your <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties></span><span class="sxs-lookup"><span data-stu-id="e26a7-196">The only exception to this is when your <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression>.<xref:Microsoft.Xrm.Sdk.Metadata.Query.MetadataQueryExpression.Properties></span></span> <span data-ttu-id="e26a7-197">includes <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Privileges>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-197">includes <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Privileges>.</span></span> <span data-ttu-id="e26a7-198">Privileges will always be returned regardless of the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-198">Privileges will always be returned regardless of the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp>.</span></span> <span data-ttu-id="e26a7-199">This way your application can determine whether any important changes have occurred that you care about since you last queried the metadata.</span><span class="sxs-lookup"><span data-stu-id="e26a7-199">This way your application can determine whether any important changes have occurred that you care about since you last queried the metadata.</span></span> <span data-ttu-id="e26a7-200">You can then merge any new or changed metadata into your persistent metadata cache so that your application will be able to avoid the performance issues with downloading metadata you may not need.</span><span class="sxs-lookup"><span data-stu-id="e26a7-200">You can then merge any new or changed metadata into your persistent metadata cache so that your application will be able to avoid the performance issues with downloading metadata you may not need.</span></span>  
  
 <span data-ttu-id="e26a7-201">The <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.HasChanged> property provides a way to detect which child elements in a metadata item have changed.</span><span class="sxs-lookup"><span data-stu-id="e26a7-201">The <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.HasChanged> property provides a way to detect which child elements in a metadata item have changed.</span></span> <span data-ttu-id="e26a7-202">Because all the metadata is returned as part of the containing metadata item, when the label of a <xref:Microsoft.Xrm.Sdk.Metadata.OptionMetadata> has changed, the containing <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>, <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata>, and <xref:Microsoft.Xrm.Sdk.Metadata.OptionSetMetadata> properties are returned.</span><span class="sxs-lookup"><span data-stu-id="e26a7-202">Because all the metadata is returned as part of the containing metadata item, when the label of a <xref:Microsoft.Xrm.Sdk.Metadata.OptionMetadata> has changed, the containing <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>, <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata>, and <xref:Microsoft.Xrm.Sdk.Metadata.OptionSetMetadata> properties are returned.</span></span> <span data-ttu-id="e26a7-203">However, the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.HasChanged> property will be false for those containing metadata items.</span><span class="sxs-lookup"><span data-stu-id="e26a7-203">However, the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.HasChanged> property will be false for those containing metadata items.</span></span> <span data-ttu-id="e26a7-204">Only the <xref:Microsoft.Xrm.Sdk.Metadata.OptionMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.HasChanged></span><span class="sxs-lookup"><span data-stu-id="e26a7-204">Only the <xref:Microsoft.Xrm.Sdk.Metadata.OptionMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.HasChanged></span></span> <span data-ttu-id="e26a7-205">property will be true.</span><span class="sxs-lookup"><span data-stu-id="e26a7-205">property will be true.</span></span>  
  
 <span data-ttu-id="e26a7-206">The following example makes an initial request by defining an <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression> and executing a request with a <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> set to null.</span><span class="sxs-lookup"><span data-stu-id="e26a7-206">The following example makes an initial request by defining an <xref:Microsoft.Xrm.Sdk.Metadata.Query.EntityQueryExpression> and executing a request with a <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> set to null.</span></span>  
  
 [!code-csharp[MetadataQuery#InitialRequest](../snippets/csharp/CRMV8/metadataquery/cs/initialrequest.cs#initialrequest)]  
[!code-csharp[MetadataQuery#getMetadataChanges](../snippets/csharp/CRMV8/metadataquery/cs/getmetadatachanges.cs#getmetadatachanges)]  
  
<a name="BKMK_RetrieveInformationaboutDeletedMetadata"></a>
   
## <a name="retrieve-information-about-deleted-metadata"></a><span data-ttu-id="e26a7-207">Retrieve information about deleted metadata</span><span class="sxs-lookup"><span data-stu-id="e26a7-207">Retrieve information about deleted metadata</span></span>  

 <span data-ttu-id="e26a7-208">The <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse.DeletedMetadata></span><span class="sxs-lookup"><span data-stu-id="e26a7-208">The <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse.DeletedMetadata></span></span> <span data-ttu-id="e26a7-209">property will return a <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataCollection> when the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> and <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.DeletedMetadataFilters> properties are set on the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-209">property will return a <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataCollection> when the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> and <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.DeletedMetadataFilters> properties are set on the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest>.</span></span> <span data-ttu-id="e26a7-210">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataCollection> contains the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.MetadataId> values of any <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>,  <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata> or <xref:Microsoft.Xrm.Sdk.Metadata.RelationshipMetadataBase> objects that have been deleted from the system in a time limit.</span><span class="sxs-lookup"><span data-stu-id="e26a7-210">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataCollection> contains the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.MetadataId> values of any <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>,  <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata> or <xref:Microsoft.Xrm.Sdk.Metadata.RelationshipMetadataBase> objects that have been deleted from the system in a time limit.</span></span> <span data-ttu-id="e26a7-211">For more information, see [Deleted metadata expiration](retrieve-detect-changes-metadata.md#BKMK_DeletedMetadataExpiration).</span><span class="sxs-lookup"><span data-stu-id="e26a7-211">For more information, see [Deleted metadata expiration](retrieve-detect-changes-metadata.md#BKMK_DeletedMetadataExpiration).</span></span>  
  
 <span data-ttu-id="e26a7-212">Use the <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters> enumeration with the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.DeletedMetadataFilters></span><span class="sxs-lookup"><span data-stu-id="e26a7-212">Use the <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters> enumeration with the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.DeletedMetadataFilters></span></span> <span data-ttu-id="e26a7-213">to limit the information to only those types of metadata you are interested in.</span><span class="sxs-lookup"><span data-stu-id="e26a7-213">to limit the information to only those types of metadata you are interested in.</span></span> <span data-ttu-id="e26a7-214">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters> enumeration provides the following options:</span><span class="sxs-lookup"><span data-stu-id="e26a7-214">The <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters> enumeration provides the following options:</span></span>  
  
- <span data-ttu-id="e26a7-215"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.Entity (Default)</span><span class="sxs-lookup"><span data-stu-id="e26a7-215"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.Entity (Default)</span></span>  
  
- <span data-ttu-id="e26a7-216"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.Attribute</span><span class="sxs-lookup"><span data-stu-id="e26a7-216"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.Attribute</span></span>  
  
- <span data-ttu-id="e26a7-217"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.Relationship</span><span class="sxs-lookup"><span data-stu-id="e26a7-217"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.Relationship</span></span>  
  
- <span data-ttu-id="e26a7-218"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.Label</span><span class="sxs-lookup"><span data-stu-id="e26a7-218"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.Label</span></span>  
  
- <span data-ttu-id="e26a7-219"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.OptionSet</span><span class="sxs-lookup"><span data-stu-id="e26a7-219"><xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters>.OptionSet</span></span>  
  
  <span data-ttu-id="e26a7-220">You will also use <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters> enumeration as a key to the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse.DeletedMetadata></span><span class="sxs-lookup"><span data-stu-id="e26a7-220">You will also use <xref:Microsoft.Xrm.Sdk.Metadata.Query.DeletedMetadataFilters> enumeration as a key to the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse.DeletedMetadata></span></span> <span data-ttu-id="e26a7-221">to filter the `GUID` values found in the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse.DeletedMetadata></span><span class="sxs-lookup"><span data-stu-id="e26a7-221">to filter the `GUID` values found in the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesResponse.DeletedMetadata></span></span> <span data-ttu-id="e26a7-222">property.</span><span class="sxs-lookup"><span data-stu-id="e26a7-222">property.</span></span>  
  
  <span data-ttu-id="e26a7-223">When you design a metadata cache you will want to use the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.MetadataId> for each item so that you can identify deleted metadata items and remove them.</span><span class="sxs-lookup"><span data-stu-id="e26a7-223">When you design a metadata cache you will want to use the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.MetadataId> for each item so that you can identify deleted metadata items and remove them.</span></span>  
  
<a name="BKMK_DeletedMetadataExpiration"></a>
   
### <a name="deleted-metadata-expiration"></a><span data-ttu-id="e26a7-224">Deleted metadata expiration</span><span class="sxs-lookup"><span data-stu-id="e26a7-224">Deleted metadata expiration</span></span>  

 <span data-ttu-id="e26a7-225">Any metadata items that are deleted are tracked for a limited period of time specified by the `Organization.ExpireSubscriptionsInDays` value.</span><span class="sxs-lookup"><span data-stu-id="e26a7-225">Any metadata items that are deleted are tracked for a limited period of time specified by the `Organization.ExpireSubscriptionsInDays` value.</span></span> <span data-ttu-id="e26a7-226">By default this value is 90 days.</span><span class="sxs-lookup"><span data-stu-id="e26a7-226">By default this value is 90 days.</span></span> <span data-ttu-id="e26a7-227">If the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp></span><span class="sxs-lookup"><span data-stu-id="e26a7-227">If the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest>.<xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp></span></span> <span data-ttu-id="e26a7-228">value indicates that the last metadata query was from before the expiration date, the service will throw an `ExpiredVersionStamp` error (0x80044352), When you are retrieving data to refresh and existing metadata cache you should always try to catch this error and be prepared to re-initialize your metadata cache with the results from a second request passed without a <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp>.</span><span class="sxs-lookup"><span data-stu-id="e26a7-228">value indicates that the last metadata query was from before the expiration date, the service will throw an `ExpiredVersionStamp` error (0x80044352), When you are retrieving data to refresh and existing metadata cache you should always try to catch this error and be prepared to re-initialize your metadata cache with the results from a second request passed without a <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp>.</span></span> <span data-ttu-id="e26a7-229">The `ExpiredVersionStamp` error is also thrown when changes on the server, such as changes to the `ExpireSubscriptionsInDays` value, affect accurately tracking the deleted metadata.</span><span class="sxs-lookup"><span data-stu-id="e26a7-229">The `ExpiredVersionStamp` error is also thrown when changes on the server, such as changes to the `ExpireSubscriptionsInDays` value, affect accurately tracking the deleted metadata.</span></span>  
  
 <span data-ttu-id="e26a7-230">The following example passes a <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> and catches the `ExpiredVersionStamp`.</span><span class="sxs-lookup"><span data-stu-id="e26a7-230">The following example passes a <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> and catches the `ExpiredVersionStamp`.</span></span> <span data-ttu-id="e26a7-231">If the error is caught the cache is reinitialized by passing in a new request with the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> set to `null`.</span><span class="sxs-lookup"><span data-stu-id="e26a7-231">If the error is caught the cache is reinitialized by passing in a new request with the <xref:Microsoft.Xrm.Sdk.Messages.RetrieveMetadataChangesRequest.ClientVersionStamp> set to `null`.</span></span>  
  
 [!code-csharp[MetadataQuery#updateOptionLabelList](../snippets/csharp/CRMV8/metadataquery/cs/updateoptionlabellist.cs#updateoptionlabellist)]  

  
<a name="BKMK_PerformanceRetrievingDeletedMetadata"></a>
   
### <a name="performance-when-retrieving-deleted-metadata"></a><span data-ttu-id="e26a7-232">Performance when retrieving deleted metadata</span><span class="sxs-lookup"><span data-stu-id="e26a7-232">Performance when retrieving deleted metadata</span></span> 
 
 <span data-ttu-id="e26a7-233">When a metadata item is deleted it is saved in the database and not in the Dynamics 365 for Customer Engagement metadata cache.</span><span class="sxs-lookup"><span data-stu-id="e26a7-233">When a metadata item is deleted it is saved in the database and not in the Dynamics 365 for Customer Engagement metadata cache.</span></span> <span data-ttu-id="e26a7-234">Although the deleted metadata is limited to just the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.MetadataId> and the type of metadata item, accessing the database is an operation that will require more server resources than just querying for changes.</span><span class="sxs-lookup"><span data-stu-id="e26a7-234">Although the deleted metadata is limited to just the <xref:Microsoft.Xrm.Sdk.Metadata.MetadataBase.MetadataId> and the type of metadata item, accessing the database is an operation that will require more server resources than just querying for changes.</span></span>  
  
### <a name="see-also"></a><span data-ttu-id="e26a7-235">Xem thm</span><span class="sxs-lookup"><span data-stu-id="e26a7-235">See also</span></span>  
 <span data-ttu-id="e26a7-236">[Write Applications and Server Extensions](extend-dynamics-365-server.md) </span><span class="sxs-lookup"><span data-stu-id="e26a7-236">[Write Applications and Server Extensions](extend-dynamics-365-server.md) </span></span>  
 <span data-ttu-id="e26a7-237">[Offline Use of the Dynamics 365 for Customer Engagement Services](org-service/offline-use-services.md) </span><span class="sxs-lookup"><span data-stu-id="e26a7-237">[Offline Use of the Dynamics 365 for Customer Engagement Services](org-service/offline-use-services.md) </span></span>  
 <span data-ttu-id="e26a7-238">[Sample: Query Metadata and Detect Changes](org-service/sample-query-metadata-detect-changes.md) </span><span class="sxs-lookup"><span data-stu-id="e26a7-238">[Sample: Query Metadata and Detect Changes](org-service/sample-query-metadata-detect-changes.md) </span></span>  
 <span data-ttu-id="e26a7-239">[Extend the Metadata Model for Dynamics 365 for Customer Engagement](org-service/use-organization-service-metadata.md) </span><span class="sxs-lookup"><span data-stu-id="e26a7-239">[Extend the Metadata Model for Dynamics 365 for Customer Engagement](org-service/use-organization-service-metadata.md) </span></span>  
 <span data-ttu-id="e26a7-240">[Customize Entity Metadata](customize-entity-metadata.md) </span><span class="sxs-lookup"><span data-stu-id="e26a7-240">[Customize Entity Metadata](customize-entity-metadata.md) </span></span>  
 <span data-ttu-id="e26a7-241">[Customize Entity Attribute Metadata](customize-entity-attribute-metadata.md) </span><span class="sxs-lookup"><span data-stu-id="e26a7-241">[Customize Entity Attribute Metadata](customize-entity-attribute-metadata.md) </span></span>  
 <span data-ttu-id="e26a7-242">[Customize Entity Relationship Metadata](customize-entity-relationship-metadata.md) </span><span class="sxs-lookup"><span data-stu-id="e26a7-242">[Customize Entity Relationship Metadata](customize-entity-relationship-metadata.md) </span></span>  
 [<span data-ttu-id="e26a7-243">Query Metadata Using JavaScript</span><span class="sxs-lookup"><span data-stu-id="e26a7-243">Query Metadata Using JavaScript</span></span>](https://msdn.microsoft.com/library/jj919080.aspx)
