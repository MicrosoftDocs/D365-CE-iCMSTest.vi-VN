---
title: Define custom state model transitions (Developer Guide for Dynamics 365 for Customer Engagement) | MicrosoftDocs
descriptions: Learn about defining custom state model transistions for the Incident (Case) entity or custom entities.
ms.custom: ''
ms.date: 10/31/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: 5c2a584a-b52a-4bf9-8952-b48418422d10
caps.latest.revision: 15
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 2fba3bb8980b4e9fbd66890eeb7f7c450f48ede5
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "388802"
---
# <a name="define-custom-state-model-transitions"></a><span data-ttu-id="f8ddc-102">Define custom state model transitions</span><span class="sxs-lookup"><span data-stu-id="f8ddc-102">Define custom state model transitions</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="f8ddc-103">You can specify custom state transitions for the `Incident` (**Case**) entity or custom entities.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-103">You can specify custom state transitions for the `Incident` (**Case**) entity or custom entities.</span></span> <span data-ttu-id="f8ddc-104">The <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.IsStateModelAware></span><span class="sxs-lookup"><span data-stu-id="f8ddc-104">The <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.IsStateModelAware></span></span> <span data-ttu-id="f8ddc-105">property is `true` for entities that support state model transitions.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-105">property is `true` for entities that support state model transitions.</span></span>  
  
 <span data-ttu-id="f8ddc-106">Custom state transitions are an optional level of filtering to define which state transitions are valid for a record in a given state.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-106">Custom state transitions are an optional level of filtering to define which state transitions are valid for a record in a given state.</span></span> <span data-ttu-id="f8ddc-107">Particularly when you have a large number of combinations for valid states and status values, defining a limited list of options can make it easier for people to choose the correct status for a record.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-107">Particularly when you have a large number of combinations for valid states and status values, defining a limited list of options can make it easier for people to choose the correct status for a record.</span></span>  

<a name="BKMK_StateModel"></a>   
## <a name="what-is-the-state-model"></a><span data-ttu-id="f8ddc-108">What is the state model?</span><span class="sxs-lookup"><span data-stu-id="f8ddc-108">What is the state model?</span></span>  
 <span data-ttu-id="f8ddc-109">Entities that support the concept of state have a pair of attributes that capture this data, as shown in this table.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-109">Entities that support the concept of state have a pair of attributes that capture this data, as shown in this table.</span></span>  
  
|<span data-ttu-id="f8ddc-110">Logical Name</span><span class="sxs-lookup"><span data-stu-id="f8ddc-110">Logical Name</span></span>|<span data-ttu-id="f8ddc-111">Tên Hiển thị</span><span class="sxs-lookup"><span data-stu-id="f8ddc-111">Display Name</span></span>|<span data-ttu-id="f8ddc-112">Mô tả</span><span class="sxs-lookup"><span data-stu-id="f8ddc-112">Description</span></span>|  
|------------------|------------------|-----------------|  
|`statecode`|<span data-ttu-id="f8ddc-113">**Trạng thái**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-113">**Status**</span></span>|<span data-ttu-id="f8ddc-114">Biểu thị trạng thái của hồ sơ.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-114">Represents the state of the record.</span></span> <span data-ttu-id="f8ddc-115">For custom entities this is **Active** or **Inactive**.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-115">For custom entities this is **Active** or **Inactive**.</span></span> <span data-ttu-id="f8ddc-116">The Incident (case) entity uses **Active**, **Resolved**, and **Canceled**.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-116">The Incident (case) entity uses **Active**, **Resolved**, and **Canceled**.</span></span> <span data-ttu-id="f8ddc-117">You can’t add more state options but you can change the option labels.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-117">You can’t add more state options but you can change the option labels.</span></span>|  
|`statuscode`|<span data-ttu-id="f8ddc-118">**Lý do dẫn đến Trạng thái**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-118">**Status Reason**</span></span>|<span data-ttu-id="f8ddc-119">Represents a status that is linked to a specific state.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-119">Represents a status that is linked to a specific state.</span></span> <span data-ttu-id="f8ddc-120">Each state must have at least one possible status.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-120">Each state must have at least one possible status.</span></span> <span data-ttu-id="f8ddc-121">You can add additional status options and change the labels of existing options.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-121">You can add additional status options and change the labels of existing options.</span></span>|  
  
 <span data-ttu-id="f8ddc-122">The metadata for the attributes defines what status values are valid for a given state.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-122">The metadata for the attributes defines what status values are valid for a given state.</span></span> <span data-ttu-id="f8ddc-123">For example, for the `Incident` (**Case**) entity, the default state and status options are shown in the following table.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-123">For example, for the `Incident` (**Case**) entity, the default state and status options are shown in the following table.</span></span>  
  
|<span data-ttu-id="f8ddc-124">Tiểu bang</span><span class="sxs-lookup"><span data-stu-id="f8ddc-124">State</span></span>|<span data-ttu-id="f8ddc-125">Trạng thái</span><span class="sxs-lookup"><span data-stu-id="f8ddc-125">Status</span></span>|  
|-----------|------------|  
|<span data-ttu-id="f8ddc-126">`Label`: **Active**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-126">`Label`: **Active**</span></span><br /><br /> <span data-ttu-id="f8ddc-127">`Value`: 0</span><span class="sxs-lookup"><span data-stu-id="f8ddc-127">`Value`: 0</span></span>|<span data-ttu-id="f8ddc-128">`Label`: **In Progress**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-128">`Label`: **In Progress**</span></span><br /><br /> <span data-ttu-id="f8ddc-129">`Value`: 1</span><span class="sxs-lookup"><span data-stu-id="f8ddc-129">`Value`: 1</span></span><br /><br /> <span data-ttu-id="f8ddc-130">`State`: 0</span><span class="sxs-lookup"><span data-stu-id="f8ddc-130">`State`: 0</span></span>|  
|<span data-ttu-id="f8ddc-131">`Label`: **Active**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-131">`Label`: **Active**</span></span><br /><br /> <span data-ttu-id="f8ddc-132">`Value`: 0</span><span class="sxs-lookup"><span data-stu-id="f8ddc-132">`Value`: 0</span></span>|<span data-ttu-id="f8ddc-133">`Label`: **On Hold**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-133">`Label`: **On Hold**</span></span><br /><br /> <span data-ttu-id="f8ddc-134">`Value`: 2</span><span class="sxs-lookup"><span data-stu-id="f8ddc-134">`Value`: 2</span></span><br /><br /> <span data-ttu-id="f8ddc-135">`State`: 0</span><span class="sxs-lookup"><span data-stu-id="f8ddc-135">`State`: 0</span></span>|  
|<span data-ttu-id="f8ddc-136">`Label`: **Active**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-136">`Label`: **Active**</span></span><br /><br /> <span data-ttu-id="f8ddc-137">`Value`: 0</span><span class="sxs-lookup"><span data-stu-id="f8ddc-137">`Value`: 0</span></span>|<span data-ttu-id="f8ddc-138">`Label`: **Waiting for Details**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-138">`Label`: **Waiting for Details**</span></span><br /><br /> <span data-ttu-id="f8ddc-139">`Value`: 3</span><span class="sxs-lookup"><span data-stu-id="f8ddc-139">`Value`: 3</span></span><br /><br /> <span data-ttu-id="f8ddc-140">`State`: 0</span><span class="sxs-lookup"><span data-stu-id="f8ddc-140">`State`: 0</span></span>|  
|<span data-ttu-id="f8ddc-141">`Label`: **Active**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-141">`Label`: **Active**</span></span><br /><br /> <span data-ttu-id="f8ddc-142">`Value`: 0</span><span class="sxs-lookup"><span data-stu-id="f8ddc-142">`Value`: 0</span></span>|<span data-ttu-id="f8ddc-143">Label: **Researching**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-143">Label: **Researching**</span></span><br /><br /> <span data-ttu-id="f8ddc-144">`Value`: 4</span><span class="sxs-lookup"><span data-stu-id="f8ddc-144">`Value`: 4</span></span><br /><br /> <span data-ttu-id="f8ddc-145">`State`: 0</span><span class="sxs-lookup"><span data-stu-id="f8ddc-145">`State`: 0</span></span>|  
|<span data-ttu-id="f8ddc-146">`Label`: **Resolved**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-146">`Label`: **Resolved**</span></span><br /><br /> <span data-ttu-id="f8ddc-147">`Value`: 1</span><span class="sxs-lookup"><span data-stu-id="f8ddc-147">`Value`: 1</span></span>|<span data-ttu-id="f8ddc-148">`Label`: **Problem Solved**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-148">`Label`: **Problem Solved**</span></span><br /><br /> <span data-ttu-id="f8ddc-149">`Value`: 5</span><span class="sxs-lookup"><span data-stu-id="f8ddc-149">`Value`: 5</span></span><br /><br /> <span data-ttu-id="f8ddc-150">`State`: 1</span><span class="sxs-lookup"><span data-stu-id="f8ddc-150">`State`: 1</span></span>|  
|<span data-ttu-id="f8ddc-151">`Label`: **Resolved**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-151">`Label`: **Resolved**</span></span><br /><br /> <span data-ttu-id="f8ddc-152">`Value`: 1</span><span class="sxs-lookup"><span data-stu-id="f8ddc-152">`Value`: 1</span></span>|<span data-ttu-id="f8ddc-153">Label: **Information Provided**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-153">Label: **Information Provided**</span></span><br /><br /> <span data-ttu-id="f8ddc-154">`Value`: 1000</span><span class="sxs-lookup"><span data-stu-id="f8ddc-154">`Value`: 1000</span></span><br /><br /> <span data-ttu-id="f8ddc-155">`State`: 1</span><span class="sxs-lookup"><span data-stu-id="f8ddc-155">`State`: 1</span></span>|  
|<span data-ttu-id="f8ddc-156">Label: **Canceled**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-156">Label: **Canceled**</span></span><br /><br /> <span data-ttu-id="f8ddc-157">`Value`: 2</span><span class="sxs-lookup"><span data-stu-id="f8ddc-157">`Value`: 2</span></span>|<span data-ttu-id="f8ddc-158">`Label`: **Canceled**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-158">`Label`: **Canceled**</span></span><br /><br /> <span data-ttu-id="f8ddc-159">`Value`: 6</span><span class="sxs-lookup"><span data-stu-id="f8ddc-159">`Value`: 6</span></span><br /><br /> <span data-ttu-id="f8ddc-160">`State`: 2</span><span class="sxs-lookup"><span data-stu-id="f8ddc-160">`State`: 2</span></span>|  
|<span data-ttu-id="f8ddc-161">Label: **Canceled**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-161">Label: **Canceled**</span></span><br /><br /> <span data-ttu-id="f8ddc-162">`Value`: 2</span><span class="sxs-lookup"><span data-stu-id="f8ddc-162">`Value`: 2</span></span>|<span data-ttu-id="f8ddc-163">`Label`: **Merged**</span><span class="sxs-lookup"><span data-stu-id="f8ddc-163">`Label`: **Merged**</span></span><br /><br /> <span data-ttu-id="f8ddc-164">`Value`: 2000</span><span class="sxs-lookup"><span data-stu-id="f8ddc-164">`Value`: 2000</span></span><br /><br /> <span data-ttu-id="f8ddc-165">`State`: 2</span><span class="sxs-lookup"><span data-stu-id="f8ddc-165">`State`: 2</span></span>|  
  
 <span data-ttu-id="f8ddc-166">This data is stored in the <xref:Microsoft.Xrm.Sdk.Metadata.StatusOptionMetadata> class, which represents the options in the <xref:Microsoft.Xrm.Sdk.Metadata.StatusAttributeMetadata> class.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-166">This data is stored in the <xref:Microsoft.Xrm.Sdk.Metadata.StatusOptionMetadata> class, which represents the options in the <xref:Microsoft.Xrm.Sdk.Metadata.StatusAttributeMetadata> class.</span></span>  
  
[!INCLUDE[metadata_browser](../includes/metadata-browser.md)]
  
<a name="BKMK_DetectValidStatusTransitions"></a>   
## <a name="detect-valid-status-transitions"></a><span data-ttu-id="f8ddc-167">Detect valid status transitions</span><span class="sxs-lookup"><span data-stu-id="f8ddc-167">Detect valid status transitions</span></span>  
 <span data-ttu-id="f8ddc-168">You can modify the `statuscode` attribute to define which other status options represent valid transitions from the current status.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-168">You can modify the `statuscode` attribute to define which other status options represent valid transitions from the current status.</span></span> <span data-ttu-id="f8ddc-169">For instructions, see the Customization Guide topic: [Define status reason transitions](http://go.microsoft.com/fwlink/p/?LinkId=393657)</span><span class="sxs-lookup"><span data-stu-id="f8ddc-169">For instructions, see the Customization Guide topic: [Define status reason transitions](http://go.microsoft.com/fwlink/p/?LinkId=393657)</span></span>  
  
 <span data-ttu-id="f8ddc-170">When custom state transitions are applied to an entity, the <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.EnforceStateTransitions></span><span class="sxs-lookup"><span data-stu-id="f8ddc-170">When custom state transitions are applied to an entity, the <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.EnforceStateTransitions></span></span> <span data-ttu-id="f8ddc-171">property will be `true`.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-171">property will be `true`.</span></span> <span data-ttu-id="f8ddc-172">Also, each <xref:Microsoft.Xrm.Sdk.Metadata.StatusOptionMetadata> within the <xref:Microsoft.Xrm.Sdk.Metadata.StatusAttributeMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.OptionSetMetadata.Options></span><span class="sxs-lookup"><span data-stu-id="f8ddc-172">Also, each <xref:Microsoft.Xrm.Sdk.Metadata.StatusOptionMetadata> within the <xref:Microsoft.Xrm.Sdk.Metadata.StatusAttributeMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.OptionSetMetadata.Options></span></span> <span data-ttu-id="f8ddc-173">collection will have a new <xref:Microsoft.Xrm.Sdk.Metadata.StatusOptionMetadata.TransitionData> property.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-173">collection will have a new <xref:Microsoft.Xrm.Sdk.Metadata.StatusOptionMetadata.TransitionData> property.</span></span> <span data-ttu-id="f8ddc-174">This property will contain a String value that represents an XML document.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-174">This property will contain a String value that represents an XML document.</span></span> <span data-ttu-id="f8ddc-175">This document contains the definition of the allowed transitions.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-175">This document contains the definition of the allowed transitions.</span></span> <span data-ttu-id="f8ddc-176">For example, the default `Incident` (**Case**) `StatusCode` attribute option may have the following `TransitionData` value.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-176">For example, the default `Incident` (**Case**) `StatusCode` attribute option may have the following `TransitionData` value.</span></span>  
  
```xml  
<allowedtransitions xmlns="http://schemas.microsoft.com/crm/2009/WebServices">  
<allowedtransition sourcestatusid="1" tostatusid="6" />  
<allowedtransition sourcestatusid="1" tostatusid="1000" />   
<allowedtransition sourcestatusid="1" tostatusid="2000" />  
<allowedtransition sourcestatusid="1" tostatusid="5" />  
</allowedtransitions>  
```  
  
> [!NOTE]
>  <span data-ttu-id="f8ddc-177">When this data is retrieved in unmanaged code from the web service, for example when using [!INCLUDE[pn_JavaScript](../includes/pn-javascript.md)], it will be escaped and appear like the following example.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-177">When this data is retrieved in unmanaged code from the web service, for example when using [!INCLUDE[pn_JavaScript](../includes/pn-javascript.md)], it will be escaped and appear like the following example.</span></span>  
  
```  
&lt;allowedtransitions xmlns="http://schemas.microsoft.com/crm/2009/WebServices"&gt;  
&lt;allowedtransition sourcestatusid="1" tostatusid="6" /&gt;  
&lt;allowedtransition sourcestatusid="1" tostatusid="1000" /&gt;  
&lt;allowedtransition sourcestatusid="1" tostatusid="2000" /&gt;  
&lt;allowedtransition sourcestatusid="1" tostatusid="5" /&gt;  
&lt;/allowedtransitions&gt;  
```  
  
 <span data-ttu-id="f8ddc-178">When this data is present and the Entity `EnforceStateTransitions` property is `true`, any incident instance can only be changed to one of the allowed `statuscode` values.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-178">When this data is present and the Entity `EnforceStateTransitions` property is `true`, any incident instance can only be changed to one of the allowed `statuscode` values.</span></span> <span data-ttu-id="f8ddc-179">You can use<xref:Microsoft.Xrm.Sdk.IOrganizationService>.<xref:Microsoft.Xrm.Sdk.IOrganizationService.Update*></span><span class="sxs-lookup"><span data-stu-id="f8ddc-179">You can use<xref:Microsoft.Xrm.Sdk.IOrganizationService>.<xref:Microsoft.Xrm.Sdk.IOrganizationService.Update*></span></span> <span data-ttu-id="f8ddc-180">to set the `statuscode`<xref:Microsoft.Xrm.Sdk.OptionSetValue> to any of the allowed values that don’t represent a change in state.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-180">to set the `statuscode`<xref:Microsoft.Xrm.Sdk.OptionSetValue> to any of the allowed values that don’t represent a change in state.</span></span> <span data-ttu-id="f8ddc-181">To change the state, use <xref:Microsoft.Crm.Sdk.Messages.SetStateRequest> setting the allowed <xref:Microsoft.Crm.Sdk.Messages.SetStateRequest.State> and <xref:Microsoft.Crm.Sdk.Messages.SetStateRequest.Status> property values or the <xref:Microsoft.Crm.Sdk.Messages.CloseIncidentRequest> setting <xref:Microsoft.Crm.Sdk.Messages.CloseIncidentRequest.Status> property to one of the values allowed for the current `statuscode` value.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-181">To change the state, use <xref:Microsoft.Crm.Sdk.Messages.SetStateRequest> setting the allowed <xref:Microsoft.Crm.Sdk.Messages.SetStateRequest.State> and <xref:Microsoft.Crm.Sdk.Messages.SetStateRequest.Status> property values or the <xref:Microsoft.Crm.Sdk.Messages.CloseIncidentRequest> setting <xref:Microsoft.Crm.Sdk.Messages.CloseIncidentRequest.Status> property to one of the values allowed for the current `statuscode` value.</span></span> <span data-ttu-id="f8ddc-182">Attempting to set an invalid value throws an error.</span><span class="sxs-lookup"><span data-stu-id="f8ddc-182">Attempting to set an invalid value throws an error.</span></span>  
  
### <a name="see-also"></a><span data-ttu-id="f8ddc-183">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="f8ddc-183">See also</span></span>  
 <span data-ttu-id="f8ddc-184">[Sample: Retrieve Valid Status Transitions](sample-retrieve-valid-status-transitions.md) </span><span class="sxs-lookup"><span data-stu-id="f8ddc-184">[Sample: Retrieve Valid Status Transitions](sample-retrieve-valid-status-transitions.md) </span></span>  
 <span data-ttu-id="f8ddc-185">[Record state and status](introduction-entities.md#bkmk_RecordStateandStatus) </span><span class="sxs-lookup"><span data-stu-id="f8ddc-185">[Record state and status](introduction-entities.md#bkmk_RecordStateandStatus) </span></span>  
 <span data-ttu-id="f8ddc-186">[Retrieve and Detect Changes to Metadata](retrieve-detect-changes-metadata.md) </span><span class="sxs-lookup"><span data-stu-id="f8ddc-186">[Retrieve and Detect Changes to Metadata](retrieve-detect-changes-metadata.md) </span></span>  
 [<span data-ttu-id="f8ddc-187">Xác định chuyển đổi lý do trạng thái</span><span class="sxs-lookup"><span data-stu-id="f8ddc-187">Define status reason transitions</span></span>](http://go.microsoft.com/fwlink/p/?LinkId=393657)
