---
title: Event execution pipeline (Developer Guide for Dynamics 365 for Customer Engagement apps) | MicrosoftDocs
description: 'The messages that contains business entity information and core operation information which are passed through the event execution pipeline where it can be read or modified by the platform core operation and any registered plug-ins. '
ms.custom: ''
ms.date: 12/03/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: 1281920e-554b-458d-a48c-c5f6bb485062
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 625a746239778b2c7d99ba948eac95f7e0669576
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "386968"
---
# <a name="event-execution-pipeline"></a><span data-ttu-id="ad1b6-103">Event execution pipeline</span><span class="sxs-lookup"><span data-stu-id="ad1b6-103">Event execution pipeline</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="ad1b6-104">The [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps event processing subsystem executes plug-ins based on a message pipeline execution model.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-104">The [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps event processing subsystem executes plug-ins based on a message pipeline execution model.</span></span> <span data-ttu-id="ad1b6-105">A user action in the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] Web application or an Organization service method call by a plug-in or other application results in a message being sent to the event processing subsystem.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-105">A user action in the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] Web application or an Organization service method call by a plug-in or other application results in a message being sent to the event processing subsystem.</span></span> <span data-ttu-id="ad1b6-106">The message contains business entity information and core operation information.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-106">The message contains business entity information and core operation information.</span></span> <span data-ttu-id="ad1b6-107">The message is passed through the event execution pipeline where it can be read or modified by the platform core operation and any registered plug-ins.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-107">The message is passed through the event execution pipeline where it can be read or modified by the platform core operation and any registered plug-ins.</span></span>  

> [!NOTE]
>  <span data-ttu-id="ad1b6-108">While there are several Web services hosted by the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps platform, only events triggered by the Organization service and the Web Api can cause plug-ins to execute.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-108">While there are several Web services hosted by the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps platform, only events triggered by the Organization service and the Web Api can cause plug-ins to execute.</span></span>  

<a name="bkmk_Architecture"></a>

## <a name="architecture-and-related-components"></a><span data-ttu-id="ad1b6-109">Architecture and related components</span><span class="sxs-lookup"><span data-stu-id="ad1b6-109">Architecture and related components</span></span>

<span data-ttu-id="ad1b6-110">The following diagram illustrates the overall architecture of the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps platform with respect to both synchronous and asynchronous event processing.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-110">The following diagram illustrates the overall architecture of the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps platform with respect to both synchronous and asynchronous event processing.</span></span>  

<span data-ttu-id="ad1b6-111">![Event processing architecture](media/asyncservice.gif "Event processing architecture")</span><span class="sxs-lookup"><span data-stu-id="ad1b6-111">![Event processing architecture](media/asyncservice.gif "Event processing architecture")</span></span>  
<span data-ttu-id="ad1b6-112">Synchronous and Asynchronous Event Processing Diagram</span><span class="sxs-lookup"><span data-stu-id="ad1b6-112">Synchronous and Asynchronous Event Processing Diagram</span></span>  

<span data-ttu-id="ad1b6-113">The event execution pipeline processes events either synchronously or asynchronously.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-113">The event execution pipeline processes events either synchronously or asynchronously.</span></span> <span data-ttu-id="ad1b6-114">The platform core operation and any plug-ins registered for synchronous execution are executed immediately.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-114">The platform core operation and any plug-ins registered for synchronous execution are executed immediately.</span></span> <span data-ttu-id="ad1b6-115">Synchronous plug-ins that are registered for the event are executed in a well-defined order.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-115">Synchronous plug-ins that are registered for the event are executed in a well-defined order.</span></span> <span data-ttu-id="ad1b6-116">Plug-ins registered for asynchronous execution are queued by the Asynchronous Queue Agent and executed at a later time by the asynchronous service.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-116">Plug-ins registered for asynchronous execution are queued by the Asynchronous Queue Agent and executed at a later time by the asynchronous service.</span></span>  

> [!IMPORTANT]
>  <span data-ttu-id="ad1b6-117">Regardless of whether a plug-in executes synchronously or asynchronously, there’s a two-minute time limit imposed on the execution of a (message) request.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-117">Regardless of whether a plug-in executes synchronously or asynchronously, there’s a two-minute time limit imposed on the execution of a (message) request.</span></span> <span data-ttu-id="ad1b6-118">If the execution of your plug-in logic exceeds the time limit, a [System.TimeoutException](https://msdn.microsoft.com/library/system.timeoutexception.aspx) is thrown.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-118">If the execution of your plug-in logic exceeds the time limit, a [System.TimeoutException](https://msdn.microsoft.com/library/system.timeoutexception.aspx) is thrown.</span></span> <span data-ttu-id="ad1b6-119">If a plug-in needs more processing time than two minutes, consider using a workflow or other background process to accomplish the intended task.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-119">If a plug-in needs more processing time than two minutes, consider using a workflow or other background process to accomplish the intended task.</span></span> <span data-ttu-id="ad1b6-120">This two-minute time limit applies only to plug-ins registered to execute under partial trust, also known as the sandbox.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-120">This two-minute time limit applies only to plug-ins registered to execute under partial trust, also known as the sandbox.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="ad1b6-121">[Plug-in Isolation, Trusts, and Statistics](plugin-isolation-trusts-statistics.md)</span><span class="sxs-lookup"><span data-stu-id="ad1b6-121">[Plug-in Isolation, Trusts, and Statistics](plugin-isolation-trusts-statistics.md)</span></span>  

<a name="bkmk_PipelineStages"></a>

## <a name="pipeline-stages"></a><span data-ttu-id="ad1b6-122">Pipeline stages</span><span class="sxs-lookup"><span data-stu-id="ad1b6-122">Pipeline stages</span></span>

<span data-ttu-id="ad1b6-123">The event pipeline is divided into multiple stages, of which three are available to register custom developed or 3rd party plug-ins. Multiple plug-ins that are registered in each stage can be further ordered (ranked) within that stage during plug-in registration.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-123">The event pipeline is divided into multiple stages, of which three are available to register custom developed or 3rd party plug-ins. Multiple plug-ins that are registered in each stage can be further ordered (ranked) within that stage during plug-in registration.</span></span>  


|          <span data-ttu-id="ad1b6-124">Sự kiện</span><span class="sxs-lookup"><span data-stu-id="ad1b6-124">Event</span></span>          |   <span data-ttu-id="ad1b6-125">Stage name</span><span class="sxs-lookup"><span data-stu-id="ad1b6-125">Stage name</span></span>   | <span data-ttu-id="ad1b6-126">Stage number</span><span class="sxs-lookup"><span data-stu-id="ad1b6-126">Stage number</span></span> |                                                                                                                                                                                    <span data-ttu-id="ad1b6-127">Mô tả</span><span class="sxs-lookup"><span data-stu-id="ad1b6-127">Description</span></span>                                                                                                                                                                                    |
|-------------------------|----------------|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|        <span data-ttu-id="ad1b6-128">Pre-Event</span><span class="sxs-lookup"><span data-stu-id="ad1b6-128">Pre-Event</span></span>        | <span data-ttu-id="ad1b6-129">Pre-validation</span><span class="sxs-lookup"><span data-stu-id="ad1b6-129">Pre-validation</span></span> |      <span data-ttu-id="ad1b6-130">10</span><span class="sxs-lookup"><span data-stu-id="ad1b6-130">10</span></span>      | <span data-ttu-id="ad1b6-131">Stage in the pipeline for plug-ins that are to execute before the main system operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-131">Stage in the pipeline for plug-ins that are to execute before the main system operation.</span></span> <span data-ttu-id="ad1b6-132">Plug-ins registered in this stage may execute outside the database transaction.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-132">Plug-ins registered in this stage may execute outside the database transaction.</span></span><br /><span data-ttu-id="ad1b6-133">**Security Note:**  The pre-validation stage occurs prior to security checks being performed to verify the calling or logged on user has the correct permissions to perform the intended operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-133">**Security Note:**  The pre-validation stage occurs prior to security checks being performed to verify the calling or logged on user has the correct permissions to perform the intended operation.</span></span> |
|        <span data-ttu-id="ad1b6-134">Pre-Event</span><span class="sxs-lookup"><span data-stu-id="ad1b6-134">Pre-Event</span></span>        | <span data-ttu-id="ad1b6-135">Pre-operation</span><span class="sxs-lookup"><span data-stu-id="ad1b6-135">Pre-operation</span></span>  |      <span data-ttu-id="ad1b6-136">20</span><span class="sxs-lookup"><span data-stu-id="ad1b6-136">20</span></span>      |                                                                                                     <span data-ttu-id="ad1b6-137">Stage in the pipeline for plug-ins that are to execute before the main system operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-137">Stage in the pipeline for plug-ins that are to execute before the main system operation.</span></span> <span data-ttu-id="ad1b6-138">Plug-ins registered in this stage are executed within the database transaction.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-138">Plug-ins registered in this stage are executed within the database transaction.</span></span>                                                                                                      |
| <span data-ttu-id="ad1b6-139">Platform Core Operation</span><span class="sxs-lookup"><span data-stu-id="ad1b6-139">Platform Core Operation</span></span> | <span data-ttu-id="ad1b6-140">MainOperation</span><span class="sxs-lookup"><span data-stu-id="ad1b6-140">MainOperation</span></span>  |      <span data-ttu-id="ad1b6-141">30</span><span class="sxs-lookup"><span data-stu-id="ad1b6-141">30</span></span>      |                                                                                             <span data-ttu-id="ad1b6-142">In-transaction main operation of the system, such as create, update, delete, and so on.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-142">In-transaction main operation of the system, such as create, update, delete, and so on.</span></span> <span data-ttu-id="ad1b6-143">No custom plug-ins can be registered in this stage.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-143">No custom plug-ins can be registered in this stage.</span></span> [!INCLUDE[internal](../includes/internal.md)]                                                                                             |
|       <span data-ttu-id="ad1b6-144">Post-Event</span><span class="sxs-lookup"><span data-stu-id="ad1b6-144">Post-Event</span></span>        | <span data-ttu-id="ad1b6-145">Post-operation</span><span class="sxs-lookup"><span data-stu-id="ad1b6-145">Post-operation</span></span> |      <span data-ttu-id="ad1b6-146">40</span><span class="sxs-lookup"><span data-stu-id="ad1b6-146">40</span></span>      |                                                                                                         <span data-ttu-id="ad1b6-147">Stage in the pipeline for plug-ins which are to execute after the main operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-147">Stage in the pipeline for plug-ins which are to execute after the main operation.</span></span> <span data-ttu-id="ad1b6-148">Plug-ins registered in this stage are executed within the database transaction.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-148">Plug-ins registered in this stage are executed within the database transaction.</span></span>                                                                                                         |

<a name="bkmk_MessageProcessing"></a>

## <a name="message-processing"></a><span data-ttu-id="ad1b6-149">Message processing</span><span class="sxs-lookup"><span data-stu-id="ad1b6-149">Message processing</span></span>

<span data-ttu-id="ad1b6-150">Whenever application code or a workflow invokes a [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps Organization service method, a state change in the system occurs that raises an event.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-150">Whenever application code or a workflow invokes a [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps Organization service method, a state change in the system occurs that raises an event.</span></span> <span data-ttu-id="ad1b6-151">The information passed as a parameter to the Web service method is internally packaged up into a <xref:Microsoft.Xrm.Sdk.OrganizationRequest> message and processed by the pipeline.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-151">The information passed as a parameter to the Web service method is internally packaged up into a <xref:Microsoft.Xrm.Sdk.OrganizationRequest> message and processed by the pipeline.</span></span> <span data-ttu-id="ad1b6-152">The information in the <xref:Microsoft.Xrm.Sdk.OrganizationRequest> message is passed to the first plug-in registered for that event where it can be read or modified before being passed to the next registered plug-in for that event and so on.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-152">The information in the <xref:Microsoft.Xrm.Sdk.OrganizationRequest> message is passed to the first plug-in registered for that event where it can be read or modified before being passed to the next registered plug-in for that event and so on.</span></span> <span data-ttu-id="ad1b6-153">Plug-ins receive the message information in the form of context that is passed to their <xref:Microsoft.Xrm.Sdk.IPlugin.Execute*> method.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-153">Plug-ins receive the message information in the form of context that is passed to their <xref:Microsoft.Xrm.Sdk.IPlugin.Execute*> method.</span></span> <span data-ttu-id="ad1b6-154">The message is also passed to the platform core operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-154">The message is also passed to the platform core operation.</span></span>  

<a name="bkmk_PluginRegistration"></a>

## <a name="plug-in-registration"></a><span data-ttu-id="ad1b6-155">Plug-in registration</span><span class="sxs-lookup"><span data-stu-id="ad1b6-155">Plug-in registration</span></span>

<span data-ttu-id="ad1b6-156">Plug-ins can be registered to execute before or after the core platform operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-156">Plug-ins can be registered to execute before or after the core platform operation.</span></span> <span data-ttu-id="ad1b6-157">Pre-event registered plug-ins receive the <xref:Microsoft.Xrm.Sdk.OrganizationRequest> message first and can modify the message information before the message is passed to the core operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-157">Pre-event registered plug-ins receive the <xref:Microsoft.Xrm.Sdk.OrganizationRequest> message first and can modify the message information before the message is passed to the core operation.</span></span> <span data-ttu-id="ad1b6-158">After the core platform operation has completed, the message is then known as the <xref:Microsoft.Xrm.Sdk.OrganizationResponse>.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-158">After the core platform operation has completed, the message is then known as the <xref:Microsoft.Xrm.Sdk.OrganizationResponse>.</span></span> <span data-ttu-id="ad1b6-159">The response is passed to the registered post-event plug-ins. Post-event plug-ins have the opportunity to modify the message before a copy of the response is passed to any registered asynchronous plug-ins. Finally, the response is returned to the application or workflow that invoked the original Organization service method call.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-159">The response is passed to the registered post-event plug-ins. Post-event plug-ins have the opportunity to modify the message before a copy of the response is passed to any registered asynchronous plug-ins. Finally, the response is returned to the application or workflow that invoked the original Organization service method call.</span></span>  

<span data-ttu-id="ad1b6-160">Because a single [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps server can host more than one organization, the execution pipeline is organization specific.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-160">Because a single [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps server can host more than one organization, the execution pipeline is organization specific.</span></span> <span data-ttu-id="ad1b6-161">There is a virtual pipeline for every organization.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-161">There is a virtual pipeline for every organization.</span></span> <span data-ttu-id="ad1b6-162">Plug-ins registered with the pipeline can only process business data for a single organization.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-162">Plug-ins registered with the pipeline can only process business data for a single organization.</span></span> <span data-ttu-id="ad1b6-163">A plug-in that is designed to work with multiple organizations must be registered with each organization's execution pipeline.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-163">A plug-in that is designed to work with multiple organizations must be registered with each organization's execution pipeline.</span></span>  

<a name="bkmk_DatabaseTransactions"></a>

## <a name="inclusion-in-database-transactions"></a><span data-ttu-id="ad1b6-164">Inclusion in database transactions</span><span class="sxs-lookup"><span data-stu-id="ad1b6-164">Inclusion in database transactions</span></span>

<span data-ttu-id="ad1b6-165">Plug-ins registered to run asynchronously do not participate in database transactions.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-165">Plug-ins registered to run asynchronously do not participate in database transactions.</span></span>

<span data-ttu-id="ad1b6-166">Synchronous plug-ins may or may not execute within the database transaction of the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] platform.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-166">Synchronous plug-ins may or may not execute within the database transaction of the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] platform.</span></span> <span data-ttu-id="ad1b6-167">Whether a plug-in is part of the transaction is dependent on how the message request is processed by the pipeline.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-167">Whether a plug-in is part of the transaction is dependent on how the message request is processed by the pipeline.</span></span> <span data-ttu-id="ad1b6-168">You can check if the plug-in is executing in-transaction by reading the <xref:Microsoft.Xrm.Sdk.IExecutionContext.IsInTransaction> property inherited by <xref:Microsoft.Xrm.Sdk.IPluginExecutionContext> that is passed to the plug-in.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-168">You can check if the plug-in is executing in-transaction by reading the <xref:Microsoft.Xrm.Sdk.IExecutionContext.IsInTransaction> property inherited by <xref:Microsoft.Xrm.Sdk.IPluginExecutionContext> that is passed to the plug-in.</span></span> <span data-ttu-id="ad1b6-169">If a plug-in is executing in the database transaction and allows an exception to be passed back to the platform, the entire transaction will be rolled back.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-169">If a plug-in is executing in the database transaction and allows an exception to be passed back to the platform, the entire transaction will be rolled back.</span></span> <span data-ttu-id="ad1b6-170">Stages 20 and 40 are guaranteed to be part of the database transaction while stage 10 may be part of the transaction.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-170">Stages 20 and 40 are guaranteed to be part of the database transaction while stage 10 may be part of the transaction.</span></span>  

<span data-ttu-id="ad1b6-171">Any registered plug-in that executes during the database transaction and that passes an exception back to the platform cancels the core operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-171">Any registered plug-in that executes during the database transaction and that passes an exception back to the platform cancels the core operation.</span></span> <span data-ttu-id="ad1b6-172">This results in a rollback of the core operation.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-172">This results in a rollback of the core operation.</span></span> <span data-ttu-id="ad1b6-173">In addition, any pre-event or post event registered plug-ins that have not yet executed and any workflow that is triggered by the same event that the plug-in was registered for will not execute.</span><span class="sxs-lookup"><span data-stu-id="ad1b6-173">In addition, any pre-event or post event registered plug-ins that have not yet executed and any workflow that is triggered by the same event that the plug-in was registered for will not execute.</span></span>  

### <a name="see-also"></a><span data-ttu-id="ad1b6-174">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="ad1b6-174">See also</span></span>  
 <span data-ttu-id="ad1b6-175">[Introduction to the Event Framework](introduction-event-framework.md) </span><span class="sxs-lookup"><span data-stu-id="ad1b6-175">[Introduction to the Event Framework](introduction-event-framework.md) </span></span>  
 <span data-ttu-id="ad1b6-176">[Plug-in Isolation, Trusts, and Statistics](plugin-isolation-trusts-statistics.md) </span><span class="sxs-lookup"><span data-stu-id="ad1b6-176">[Plug-in Isolation, Trusts, and Statistics](plugin-isolation-trusts-statistics.md) </span></span>  
 <span data-ttu-id="ad1b6-177">[Register and Deploy Plug-ins](register-deploy-plugins.md) </span><span class="sxs-lookup"><span data-stu-id="ad1b6-177">[Register and Deploy Plug-ins](register-deploy-plugins.md) </span></span>  
 [<span data-ttu-id="ad1b6-178">Asynchronous Service in Dynamics 365 for Customer Engagement apps</span><span class="sxs-lookup"><span data-stu-id="ad1b6-178">Asynchronous Service in Dynamics 365 for Customer Engagement apps</span></span>](asynchronous-service.md)
