---
title: Azure integration with Dynamics 365 for Customer Engagement (Developer Guide for Dynamics 365 for Customer Engagement apps)| MicrosoftDocs
description: Learn about connecting Dynamics 365 for Customer Engagement apps with the Azure platform by coupling the Dynamics 365 for Customer Engagement apps event execution pipeline to the Azure Service Bus.
ms.custom: ''
ms.date: 09/19/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
helpviewer_keywords:
- azure, about crm integration
ms.assetid: fbfa6e40-52d2-4042-a9fb-93f1b1cd1c1a
caps.latest.revision: 73
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 05003569994c4882e7b7e2717ff8302b6142253e
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "386615"
---
# <a name="azure-integration-with-customer-engagement"></a><span data-ttu-id="6ef9f-103">Azure integration with Customer Engagement</span><span class="sxs-lookup"><span data-stu-id="6ef9f-103">Azure integration with Customer Engagement</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="6ef9f-104">You can connect [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps with the [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)] platform by coupling the [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps event execution pipeline to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)].</span><span class="sxs-lookup"><span data-stu-id="6ef9f-104">You can connect [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps with the [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)] platform by coupling the [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps event execution pipeline to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)].</span></span> <span data-ttu-id="6ef9f-105">Once configured,this connection allows data that’s been processed as part of the current [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps operation to be posted to the service bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-105">Once configured,this connection allows data that’s been processed as part of the current [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps operation to be posted to the service bus.</span></span> [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] <span data-ttu-id="6ef9f-106">solutions that are “[!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps-aware” can listen for and read the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps data from the service bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-106">solutions that are “[!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps-aware” can listen for and read the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps data from the service bus.</span></span>  
  
 <span data-ttu-id="6ef9f-107">This connection between [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and the [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)] platform provides a secure and reliable channel for communicating [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps run-time data to external cloud-based line-of-business (LOB) applications.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-107">This connection between [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and the [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)] platform provides a secure and reliable channel for communicating [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps run-time data to external cloud-based line-of-business (LOB) applications.</span></span>  
  
<a name="bkmk_identify"></a>   

## <a name="key-elements-of-the-connection"></a><span data-ttu-id="6ef9f-108">Key elements of the connection</span><span class="sxs-lookup"><span data-stu-id="6ef9f-108">Key elements of the connection</span></span>  

 <span data-ttu-id="6ef9f-109">The key elements that implement the connection between [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] are described below.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-109">The key elements that implement the connection between [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] are described below.</span></span> <span data-ttu-id="6ef9f-110">A diagram in the next section shows these elements in operation.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-110">A diagram in the next section shows these elements in operation.</span></span>  
  
 <span data-ttu-id="6ef9f-111">**Data Context**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-111">**Data Context**</span></span>  
 <span data-ttu-id="6ef9f-112">The *data context* contains the business data that is being processed as part of the current [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps operation.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-112">The *data context* contains the business data that is being processed as part of the current [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps operation.</span></span> <span data-ttu-id="6ef9f-113">This processing was initiated when a request to perform a certain operation was made by a user, workflow, or application,  to the Dynamics 365 for Customer Engagement apps platform.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-113">This processing was initiated when a request to perform a certain operation was made by a user, workflow, or application,  to the Dynamics 365 for Customer Engagement apps platform.</span></span> <span data-ttu-id="6ef9f-114">The data context is passed to any plug-ins or custom workflow activities that are registered with the event pipeline to execute on the specific request and entity combination that is currently being processed.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-114">The data context is passed to any plug-ins or custom workflow activities that are registered with the event pipeline to execute on the specific request and entity combination that is currently being processed.</span></span> <span data-ttu-id="6ef9f-115">The data context is of type <xref:Microsoft.Xrm.Sdk.IPluginExecutionContext> when it is being passed along the event execution pipeline and <xref:Microsoft.Xrm.Sdk.RemoteExecutionContext> when it is posted to the service bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-115">The data context is of type <xref:Microsoft.Xrm.Sdk.IPluginExecutionContext> when it is being passed along the event execution pipeline and <xref:Microsoft.Xrm.Sdk.RemoteExecutionContext> when it is posted to the service bus.</span></span>  
  
 <span data-ttu-id="6ef9f-116">The data context contained within the message that is posted to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] can be formatted in XML or JSON in addition to the default .NET binary format.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-116">The data context contained within the message that is posted to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] can be formatted in XML or JSON in addition to the default .NET binary format.</span></span> <span data-ttu-id="6ef9f-117">This allows for cross-platform interoperability where Azure hosted non-.NET clients can read [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps data from the service bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-117">This allows for cross-platform interoperability where Azure hosted non-.NET clients can read [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps data from the service bus.</span></span> [!INCLUDE[cc_feature_included_with_update_8_1_0_admins](../includes/cc-feature-included-with-update-8-1-0-admins.md)]<span data-ttu-id="6ef9f-118">.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-118">.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="6ef9f-119">When the size of the entire HTTP payload exceeds 192Kb, the following properties will be removed:</span><span class="sxs-lookup"><span data-stu-id="6ef9f-119">When the size of the entire HTTP payload exceeds 192Kb, the following properties will be removed:</span></span>
>
> - <xref:Microsoft.Xrm.Sdk.RemoteExecutionContext.ParentContext>
> - <xref:Microsoft.Xrm.Sdk.RemoteExecutionContext.InputParameters>
> - <xref:Microsoft.Xrm.Sdk.RemoteExecutionContext.PreEntityImages>
> - <xref:Microsoft.Xrm.Sdk.RemoteExecutionContext.PostEntityImages>
>
> <span data-ttu-id="6ef9f-120">Some operations do not include these properties.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-120">Some operations do not include these properties.</span></span> 
>
> - <span data-ttu-id="6ef9f-121">If the size of the payload is below 192Kb after the additional data is removed, an additional `MessageMaxSizeExceeded` property is added to the [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) sent by the system.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-121">If the size of the payload is below 192Kb after the additional data is removed, an additional `MessageMaxSizeExceeded` property is added to the [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) sent by the system.</span></span> <span data-ttu-id="6ef9f-122">This indicates that some of the data has been truncated.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-122">This indicates that some of the data has been truncated.</span></span>
> - <span data-ttu-id="6ef9f-123">If the size of the payload exceeds 192Kb after the  additional data is removed, an error occurs and the message is not sent.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-123">If the size of the payload exceeds 192Kb after the  additional data is removed, an error occurs and the message is not sent.</span></span>
  
 [!INCLUDE[sdk_for_more_info_about](../includes/sdk-for-more-info-about.md)] <span data-ttu-id="6ef9f-124">the technologies described above see: [Understand the data context passed to a plug-in](understand-data-context-passed-plugin.md), [Event execution pipeline.](event-execution-pipeline.md), and [Write a listener application for a Microsoft Azure solution](write-listener-application-azure-solution.md).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-124">the technologies described above see: [Understand the data context passed to a plug-in](understand-data-context-passed-plugin.md), [Event execution pipeline.](event-execution-pipeline.md), and [Write a listener application for a Microsoft Azure solution](write-listener-application-azure-solution.md).</span></span>  
  
 <span data-ttu-id="6ef9f-125">**Phần bổ trợ**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-125">**Plug-ins**</span></span>  
 <span data-ttu-id="6ef9f-126">Plug-ins are one of two methods used to initiate posting the message containing the data context to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)], the other method being a custom workflow activity.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-126">Plug-ins are one of two methods used to initiate posting the message containing the data context to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)], the other method being a custom workflow activity.</span></span> <span data-ttu-id="6ef9f-127">There are two kinds of plug-ins supported by the Dynamics 365 for Customer Engagement apps-Azure connection feature: out-of-box (OOB), and custom.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-127">There are two kinds of plug-ins supported by the Dynamics 365 for Customer Engagement apps-Azure connection feature: out-of-box (OOB), and custom.</span></span> <span data-ttu-id="6ef9f-128">In either case, it is recommended that you register the plug-in to run asynchronously for best system performance.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-128">In either case, it is recommended that you register the plug-in to run asynchronously for best system performance.</span></span>  
  
 <span data-ttu-id="6ef9f-129">An [!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware OOB plug-in is provided with [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps and can be registered using the Plug-in Registration Tool in the  SDK download.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-129">An [!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware OOB plug-in is provided with [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps and can be registered using the Plug-in Registration Tool in the  SDK download.</span></span> <span data-ttu-id="6ef9f-130">This plug-in executes in full trust with the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps platform.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-130">This plug-in executes in full trust with the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps platform.</span></span> <span data-ttu-id="6ef9f-131">You must register a plug-in 'step' in the event execution pipeline  that identifies the message and entity combination that triggers  the plug-in to execute and perform the posting notification.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-131">You must register a plug-in 'step' in the event execution pipeline  that identifies the message and entity combination that triggers  the plug-in to execute and perform the posting notification.</span></span> <span data-ttu-id="6ef9f-132">When executed, the plug-in  notifies the asynchronous service, through a service endpoint notification service (<xref:Microsoft.Xrm.Sdk.IServiceEndpointNotificationService>), to post the current request data context to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)].</span><span class="sxs-lookup"><span data-stu-id="6ef9f-132">When executed, the plug-in  notifies the asynchronous service, through a service endpoint notification service (<xref:Microsoft.Xrm.Sdk.IServiceEndpointNotificationService>), to post the current request data context to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)].</span></span>  
  
 <span data-ttu-id="6ef9f-133">You can also write your own custom plug-in that is “[!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware”.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-133">You can also write your own custom plug-in that is “[!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware”.</span></span> <span data-ttu-id="6ef9f-134">The custom plug-in executes in partial trust mode in the sandbox.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-134">The custom plug-in executes in partial trust mode in the sandbox.</span></span> <span data-ttu-id="6ef9f-135">A custom plug-in can initiate posting of the data context to the service bus through the service endpoint notification service.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-135">A custom plug-in can initiate posting of the data context to the service bus through the service endpoint notification service.</span></span> <span data-ttu-id="6ef9f-136">Adding code to invoke this service makes the plug-in “[!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware”.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-136">Adding code to invoke this service makes the plug-in “[!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware”.</span></span> <span data-ttu-id="6ef9f-137">For more information about plug-ins in general, see [Writing a Plug-in](write-plugin.md).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-137">For more information about plug-ins in general, see [Writing a Plug-in](write-plugin.md).</span></span> <span data-ttu-id="6ef9f-138">For more information about [!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware plug-ins, see [Write a Custom Azure-aware Plug-in](write-custom-azure-aware-plugin.md).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-138">For more information about [!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware plug-ins, see [Write a Custom Azure-aware Plug-in](write-custom-azure-aware-plugin.md).</span></span>  
  
 <span data-ttu-id="6ef9f-139">**Custom Workflow Activities**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-139">**Custom Workflow Activities**</span></span>  
 <span data-ttu-id="6ef9f-140">Similarly to plug-ins, custom workflow activities can be written to initiate posting the current request message data context to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] by using the service endpoint notification service (<xref:Microsoft.Xrm.Sdk.IServiceEndpointNotificationService>).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-140">Similarly to plug-ins, custom workflow activities can be written to initiate posting the current request message data context to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] by using the service endpoint notification service (<xref:Microsoft.Xrm.Sdk.IServiceEndpointNotificationService>).</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="6ef9f-141">[Sample: Azure Aware Custom Workflow Activity](sample-azure-aware-custom-workflow-activity.md).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-141">[Sample: Azure Aware Custom Workflow Activity](sample-azure-aware-custom-workflow-activity.md).</span></span>  
  
 <span data-ttu-id="6ef9f-142">**Dịch vụ Không đồng thời**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-142">**Asynchronous Service**</span></span>  
 <span data-ttu-id="6ef9f-143">Once notified by the service endpoint notification service, the asynchronous service handles posting the  data context of the request message currently being processed by the event execution pipeline to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)].</span><span class="sxs-lookup"><span data-stu-id="6ef9f-143">Once notified by the service endpoint notification service, the asynchronous service handles posting the  data context of the request message currently being processed by the event execution pipeline to the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)].</span></span> <span data-ttu-id="6ef9f-144">Each post is performed by a system job of the asynchronous service.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-144">Each post is performed by a system job of the asynchronous service.</span></span> <span data-ttu-id="6ef9f-145">A user can view the status of each system job by using the **System Jobs** view of the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps web application.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-145">A user can view the status of each system job by using the **System Jobs** view of the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps web application.</span></span>  
  
 [!INCLUDE[sdk_for_more_info_about](../includes/sdk-for-more-info-about.md)] <span data-ttu-id="6ef9f-146">the asynchronous service see [Asynchronous service in Dynamics 365 for Customer Engagement apps](asynchronous-service.md).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-146">the asynchronous service see [Asynchronous service in Dynamics 365 for Customer Engagement apps](asynchronous-service.md).</span></span>  
  
 <span data-ttu-id="6ef9f-147">**Microsoft Azure Service Bus**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-147">**Microsoft Azure Service Bus**</span></span>  
 <span data-ttu-id="6ef9f-148">The service bus relays the request messagedata context between[!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] solution listener applications.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-148">The service bus relays the request messagedata context between[!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] solution listener applications.</span></span> <span data-ttu-id="6ef9f-149">The service bus also provides data security so that only authorized applications can access the posted Dynamics 365 for Customer Engagement apps data.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-149">The service bus also provides data security so that only authorized applications can access the posted Dynamics 365 for Customer Engagement apps data.</span></span>  <span data-ttu-id="6ef9f-150">Authorization of [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps to post the data context to the service bus and for listener applications to read it is managed by  [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)] Shared Access Signatures (SAS).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-150">Authorization of [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps to post the data context to the service bus and for listener applications to read it is managed by  [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)] Shared Access Signatures (SAS).</span></span>  
  
  
 [!INCLUDE[sdk_for_more_info_about](../includes/sdk-for-more-info-about.md)] <span data-ttu-id="6ef9f-151">the service bus see [Service Bus](https://azure.microsoft.com/en-us/services/service-bus/).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-151">the service bus see [Service Bus](https://azure.microsoft.com/en-us/services/service-bus/).</span></span> [!INCLUDE[sdk_for_more_info_about](../includes/sdk-for-more-info-about.md)] <span data-ttu-id="6ef9f-152">service bus authorization see [Service Bus authentication and authorization](https://azure.microsoft.com/en-us/documentation/articles/service-bus-authentication-and-authorization/).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-152">service bus authorization see [Service Bus authentication and authorization](https://azure.microsoft.com/en-us/documentation/articles/service-bus-authentication-and-authorization/).</span></span>  
  
 <span data-ttu-id="6ef9f-153">**Microsoft Azure Solution**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-153">**Microsoft Azure Solution**</span></span>  
 <span data-ttu-id="6ef9f-154">For the [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)]-[!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)] connection to work there must be at least one solution in an [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] solution account, where the solution contains one or more service endpoints.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-154">For the [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)]-[!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)] connection to work there must be at least one solution in an [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] solution account, where the solution contains one or more service endpoints.</span></span> <span data-ttu-id="6ef9f-155">For a relay endpoint contract, a listener application that is “[!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)]-aware” must be actively listening on the endpoint for the [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] request on the service bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-155">For a relay endpoint contract, a listener application that is “[!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)]-aware” must be actively listening on the endpoint for the [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] request on the service bus.</span></span> <span data-ttu-id="6ef9f-156">For a queue endpoint contract, a listener doesn’t have to be actively listening.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-156">For a queue endpoint contract, a listener doesn’t have to be actively listening.</span></span> <span data-ttu-id="6ef9f-157">A listener is made “[!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)]-aware” by linking it to the <xref:Microsoft.Xrm.Sdk> assembly so that type <xref:Microsoft.Xrm.Sdk.RemoteExecutionContext> is defined.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-157">A listener is made “[!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)]-aware” by linking it to the <xref:Microsoft.Xrm.Sdk> assembly so that type <xref:Microsoft.Xrm.Sdk.RemoteExecutionContext> is defined.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="6ef9f-158">[Write a Listener for a Microsoft Azure Solution](write-listener-application-azure-solution.md)</span><span class="sxs-lookup"><span data-stu-id="6ef9f-158">[Write a Listener for a Microsoft Azure Solution](write-listener-application-azure-solution.md)</span></span>  
  
 [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] <span data-ttu-id="6ef9f-159">apps support sending event data to an [!INCLUDE[pn_azure_event_hubs](../includes/pn-azure-event-hubs.md)] solution.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-159">apps support sending event data to an [!INCLUDE[pn_azure_event_hubs](../includes/pn-azure-event-hubs.md)] solution.</span></span> [!INCLUDE[cc_feature_included_with_update_8_1_0_admins](../includes/cc-feature-included-with-update-8-1-0-admins.md)]<span data-ttu-id="6ef9f-160">.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-160">.</span></span> [!INCLUDE[sdk_for_more_info_about](../includes/sdk-for-more-info-about.md)] <span data-ttu-id="6ef9f-161">event hubs see [Work with Dynamics 365 for Customer Engagement apps event data in your Azure Event Hub solution](work-event-data-azure-event-hub-solution.md).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-161">event hubs see [Work with Dynamics 365 for Customer Engagement apps event data in your Azure Event Hub solution](work-event-data-azure-event-hub-solution.md).</span></span>  
  
<a name="bkmk_describing"></a>  
 
## <a name="a-includepndynamicscrmincludespn-dynamics-crmmd-apps-to-service-bus-scenario"></a><span data-ttu-id="6ef9f-162">A [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps-to-service bus scenario</span><span class="sxs-lookup"><span data-stu-id="6ef9f-162">A [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps-to-service bus scenario</span></span>  

 <span data-ttu-id="6ef9f-163">Let us now identify a scenario that implements the previously mentioned connection components.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-163">Let us now identify a scenario that implements the previously mentioned connection components.</span></span> <span data-ttu-id="6ef9f-164">As a prerequisite, SAS has been configured to recognize [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps as the supported issuer and the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] solution configured with rules to allow [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps to post to the endpoint where the listener is.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-164">As a prerequisite, SAS has been configured to recognize [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps as the supported issuer and the [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] solution configured with rules to allow [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps to post to the endpoint where the listener is.</span></span>  
  
 <span data-ttu-id="6ef9f-165">The following diagram shows the physical elements that make up the scenario.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-165">The following diagram shows the physical elements that make up the scenario.</span></span>  
  
 <span data-ttu-id="6ef9f-166">![Dynamics 365 for Customer Engagement apps to Service Bus scenario](media/crm-v5s-az.png "Dynamics 365 for Customer Engagement apps to Service Bus scenario")</span><span class="sxs-lookup"><span data-stu-id="6ef9f-166">![Dynamics 365 for Customer Engagement apps to Service Bus scenario](media/crm-v5s-az.png "Dynamics 365 for Customer Engagement apps to Service Bus scenario")</span></span>  
  
 <span data-ttu-id="6ef9f-167">The sequence of events as identified in this diagram are as follows:</span><span class="sxs-lookup"><span data-stu-id="6ef9f-167">The sequence of events as identified in this diagram are as follows:</span></span>  
  
1. <span data-ttu-id="6ef9f-168">A listener application is registered on a [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] solution endpoint and begins actively listening for the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps remote execution context on the service bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-168">A listener application is registered on a [!INCLUDE[windows_azure_service_bus](../includes/windows-azure-service-bus.md)] solution endpoint and begins actively listening for the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps remote execution context on the service bus.</span></span>  
  
2. <span data-ttu-id="6ef9f-169">A user performs some operation in [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps that triggers execution of the registered OOB plug-in or a custom [!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware plug-in.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-169">A user performs some operation in [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps that triggers execution of the registered OOB plug-in or a custom [!INCLUDE[pn_azure_shortest](../includes/pn-azure-shortest.md)]-aware plug-in.</span></span> <span data-ttu-id="6ef9f-170">The plug-in initiates a post, through an asynchronous service system job, of the current request data context to the service bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-170">The plug-in initiates a post, through an asynchronous service system job, of the current request data context to the service bus.</span></span>  
  
3. <span data-ttu-id="6ef9f-171">The claims posted by [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps are authenticated.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-171">The claims posted by [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps are authenticated.</span></span> <span data-ttu-id="6ef9f-172">The service bus then relays the remote execution context to the listener.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-172">The service bus then relays the remote execution context to the listener.</span></span> <span data-ttu-id="6ef9f-173">The listener processes the context information and performs some business-related task with that information.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-173">The listener processes the context information and performs some business-related task with that information.</span></span> <span data-ttu-id="6ef9f-174">The service bus notifies the asynchronous service of a successful post and sets the related system job to a completed status.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-174">The service bus notifies the asynchronous service of a successful post and sets the related system job to a completed status.</span></span>  
  
<a name="bkmk_establising"></a>  
 
## <a name="establish-a-contract-between-includepndynamicscrmincludespn-dynamics-crmmd-apps-and-an-azure-solution"></a><span data-ttu-id="6ef9f-175">Establish a contract between [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and an Azure solution</span><span class="sxs-lookup"><span data-stu-id="6ef9f-175">Establish a contract between [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and an Azure solution</span></span>  
 <span data-ttu-id="6ef9f-176">For each solution endpoint, you configure a contract that defines the handling of these remote execution context “messages” on the service bus and the security that should be used on that endpoint.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-176">For each solution endpoint, you configure a contract that defines the handling of these remote execution context “messages” on the service bus and the security that should be used on that endpoint.</span></span> <span data-ttu-id="6ef9f-177">Service bus messages are received at an endpoint using one of the supported contracts listed here.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-177">Service bus messages are received at an endpoint using one of the supported contracts listed here.</span></span>  
  
 <span data-ttu-id="6ef9f-178">**Hàng đợi**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-178">**Queue**</span></span>  
 <span data-ttu-id="6ef9f-179">A queue contract provides a message queue in the cloud.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-179">A queue contract provides a message queue in the cloud.</span></span> <span data-ttu-id="6ef9f-180">With a queue contract, a listener doesn’t have to be actively listening for messages on the endpoint.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-180">With a queue contract, a listener doesn’t have to be actively listening for messages on the endpoint.</span></span> <span data-ttu-id="6ef9f-181">For queues, there is a destructive read and a non-destructive read.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-181">For queues, there is a destructive read and a non-destructive read.</span></span> <span data-ttu-id="6ef9f-182">A destructive read reads an available message from the queue and the message is removed.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-182">A destructive read reads an available message from the queue and the message is removed.</span></span> <span data-ttu-id="6ef9f-183">A non-destructive read doesn’t remove a message from the queue.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-183">A non-destructive read doesn’t remove a message from the queue.</span></span>  
  
 <span data-ttu-id="6ef9f-184">The type of queue supported by [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps is called a persistent queue.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-184">The type of queue supported by [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps is called a persistent queue.</span></span> <span data-ttu-id="6ef9f-185">Persistent queues have a long but finite message availability duration that can be specified in code.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-185">Persistent queues have a long but finite message availability duration that can be specified in code.</span></span>  
  
 <span data-ttu-id="6ef9f-186">**One-way**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-186">**One-way**</span></span>  
 <span data-ttu-id="6ef9f-187">A one-way contract requires an active listener.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-187">A one-way contract requires an active listener.</span></span> <span data-ttu-id="6ef9f-188">If there is no active listener on an endpoint, the post to the service bus fails.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-188">If there is no active listener on an endpoint, the post to the service bus fails.</span></span> [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] <span data-ttu-id="6ef9f-189">apps will retry the post in exponentially larger and larger time spans until the asynchronous system job that is posting the request is eventually aborted and its status is set to “Failed.”</span><span class="sxs-lookup"><span data-stu-id="6ef9f-189">apps will retry the post in exponentially larger and larger time spans until the asynchronous system job that is posting the request is eventually aborted and its status is set to “Failed.”</span></span>  
  
 <span data-ttu-id="6ef9f-190">**Two-way**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-190">**Two-way**</span></span>  
 <span data-ttu-id="6ef9f-191">A two-way contract is similar to a one-way contract except that a string value can be returned from the listener to the plug-in or custom workflow activity that initiated the post.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-191">A two-way contract is similar to a one-way contract except that a string value can be returned from the listener to the plug-in or custom workflow activity that initiated the post.</span></span>  
  
 <span data-ttu-id="6ef9f-192">**REST**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-192">**REST**</span></span>  
 <span data-ttu-id="6ef9f-193">A REST contract is similar to a two-way contract on a REST endpoint.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-193">A REST contract is similar to a two-way contract on a REST endpoint.</span></span>  
  
 <span data-ttu-id="6ef9f-194">**Chủ đề**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-194">**Topic**</span></span>  
 <span data-ttu-id="6ef9f-195">Similar to a queue except that one or more listeners can subscribe to receive messages from the topic.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-195">Similar to a queue except that one or more listeners can subscribe to receive messages from the topic.</span></span>  
  
 <span data-ttu-id="6ef9f-196">**Event Hub**</span><span class="sxs-lookup"><span data-stu-id="6ef9f-196">**Event Hub**</span></span>  
 <span data-ttu-id="6ef9f-197">This contract type applies to [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)] Event Hub solutions.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-197">This contract type applies to [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)] Event Hub solutions.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="6ef9f-198">To use these contracts, you must write your listener applications using the [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)][SDK](http://www.windowsazure.com/develop/downloads/) v1.7 or later.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-198">To use these contracts, you must write your listener applications using the [!INCLUDE[pn_Windows_Azure](../includes/pn-windows-azure.md)][SDK](http://www.windowsazure.com/develop/downloads/) v1.7 or later.</span></span>  
  
 <span data-ttu-id="6ef9f-199">Identifying the kind of security a contract uses is part of the contract’s configuration.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-199">Identifying the kind of security a contract uses is part of the contract’s configuration.</span></span> <span data-ttu-id="6ef9f-200">A contract can use Transport security, which uses Transport Layer Security (TLS) or Secure Sockets Layer (SSL) (https).</span><span class="sxs-lookup"><span data-stu-id="6ef9f-200">A contract can use Transport security, which uses Transport Layer Security (TLS) or Secure Sockets Layer (SSL) (https).</span></span>  
  
 <span data-ttu-id="6ef9f-201">Claims authentication is used for secure access to the service bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-201">Claims authentication is used for secure access to the service bus.</span></span> <span data-ttu-id="6ef9f-202">The claim used to authenticate to the service bus is generated in [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and signed by the AppFabricIssuer certificate specified in the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps configuration database.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-202">The claim used to authenticate to the service bus is generated in [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps and signed by the AppFabricIssuer certificate specified in the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps configuration database.</span></span>  
  
<a name="bkmk_management"></a>   

## <a name="manage-of-run-time-errors"></a><span data-ttu-id="6ef9f-203">Manage of run-time errors</span><span class="sxs-lookup"><span data-stu-id="6ef9f-203">Manage of run-time errors</span></span>  

 <span data-ttu-id="6ef9f-204">If an error occurred after a post was attempted to the service bus, check the status of the related system job in the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps web application for more information on the error.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-204">If an error occurred after a post was attempted to the service bus, check the status of the related system job in the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps web application for more information on the error.</span></span> <span data-ttu-id="6ef9f-205">If the service bus is down or a listener/endpoint isn’t available, the current message being processed in [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps will not be posted to the bus.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-205">If the service bus is down or a listener/endpoint isn’t available, the current message being processed in [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps will not be posted to the bus.</span></span> <span data-ttu-id="6ef9f-206">The asynchronous service will continue to try to post the message in an exponential pattern where it will try to post frequently at first and then at longer and longer intervals.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-206">The asynchronous service will continue to try to post the message in an exponential pattern where it will try to post frequently at first and then at longer and longer intervals.</span></span> <span data-ttu-id="6ef9f-207">For an internal [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps error, message posts are not attempted.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-207">For an internal [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps error, message posts are not attempted.</span></span> <span data-ttu-id="6ef9f-208">For an external service bus or network error, the related system job will be in a “Wait” state.</span><span class="sxs-lookup"><span data-stu-id="6ef9f-208">For an external service bus or network error, the related system job will be in a “Wait” state.</span></span>  
  
### <a name="see-also"></a><span data-ttu-id="6ef9f-209">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="6ef9f-209">See also</span></span>  
 <span data-ttu-id="6ef9f-210">[Azure Extensions for Dynamics 365 for Customer Engagement apps](azure-extensions.md) </span><span class="sxs-lookup"><span data-stu-id="6ef9f-210">[Azure Extensions for Dynamics 365 for Customer Engagement apps](azure-extensions.md) </span></span>  
 <span data-ttu-id="6ef9f-211">[Configure Azure integration with Dynamics 365 for Customer Engagement apps](configure-azure-integration.md) </span><span class="sxs-lookup"><span data-stu-id="6ef9f-211">[Configure Azure integration with Dynamics 365 for Customer Engagement apps](configure-azure-integration.md) </span></span>  
 <span data-ttu-id="6ef9f-212">[Plug-ins for Extending Dynamics 365 for Customer Engagement apps](write-plugin-extend-business-processes.md) </span><span class="sxs-lookup"><span data-stu-id="6ef9f-212">[Plug-ins for Extending Dynamics 365 for Customer Engagement apps](write-plugin-extend-business-processes.md) </span></span>  
 <span data-ttu-id="6ef9f-213">[Understanding the Asynchronous Service](asynchronous-service.md) </span><span class="sxs-lookup"><span data-stu-id="6ef9f-213">[Understanding the Asynchronous Service](asynchronous-service.md) </span></span>  
 [<span data-ttu-id="6ef9f-214">System Job (asyncoperation) Entities</span><span class="sxs-lookup"><span data-stu-id="6ef9f-214">System Job (asyncoperation) Entities</span></span>](asyncoperation-system-job-entity.md)
