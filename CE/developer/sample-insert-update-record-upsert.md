---
title: 'Sample: Insert or update a record using Upsert (Developer Guide for Dynamics 365 for Customer Engagement apps)| MicrosoftDocs'
description: This sample code shows how to insert or update records by using the Upsert message
ms.custom: ''
ms.date: 10/31/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: samples
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: 5aac6430-5d98-4e50-94f9-c2f6ce5cee62
caps.latest.revision: 24
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 23362e781c903abc7d8abc9d43c122535f306a94
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "388344"
---
# <a name="sample-insert-or-update-a-record-using-upsert"></a><span data-ttu-id="a162e-103">Sample: Insert or update a record using Upsert</span><span class="sxs-lookup"><span data-stu-id="a162e-103">Sample: Insert or update a record using Upsert</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="a162e-104">This sample code shows how to insert or update records by using the `Upsert` message.</span><span class="sxs-lookup"><span data-stu-id="a162e-104">This sample code shows how to insert or update records by using the `Upsert` message.</span></span> <span data-ttu-id="a162e-105">For more information about the feature that this sample demonstrates, see [Use Upsert to insert or update a record](use-upsert-insert-update-record.md).</span><span class="sxs-lookup"><span data-stu-id="a162e-105">For more information about the feature that this sample demonstrates, see [Use Upsert to insert or update a record](use-upsert-insert-update-record.md).</span></span>  

 <span data-ttu-id="a162e-106">This is available to download from [Insert or update a record using Upsert](http://go.microsoft.com/fwlink/p/?LinkId=532924).</span><span class="sxs-lookup"><span data-stu-id="a162e-106">This is available to download from [Insert or update a record using Upsert](http://go.microsoft.com/fwlink/p/?LinkId=532924).</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="a162e-107">Điều kiện tiên quyết</span><span class="sxs-lookup"><span data-stu-id="a162e-107">Prerequisites</span></span>  

1. <span data-ttu-id="a162e-108">Have access to a [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps or [!INCLUDE[pn_crm_online_2016_update_shortest](../includes/pn-crm-online-2016-update-shortest.md)] organization.</span><span class="sxs-lookup"><span data-stu-id="a162e-108">Have access to a [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps or [!INCLUDE[pn_crm_online_2016_update_shortest](../includes/pn-crm-online-2016-update-shortest.md)] organization.</span></span>  

2. <span data-ttu-id="a162e-109">Download the UpsertSample Visual Studio project.</span><span class="sxs-lookup"><span data-stu-id="a162e-109">Download the UpsertSample Visual Studio project.</span></span>  

3. <span data-ttu-id="a162e-110">Open the UpsertSample Visual Studio project and install Microsoft.CrmSdk.CoreAssemblies version 8.0.0-preview or later NuGet Package.</span><span class="sxs-lookup"><span data-stu-id="a162e-110">Open the UpsertSample Visual Studio project and install Microsoft.CrmSdk.CoreAssemblies version 8.0.0-preview or later NuGet Package.</span></span> <span data-ttu-id="a162e-111">See [Install NuGet packages](sample-insert-update-record-upsert.md#BKMK_installNuget) for instructions.</span><span class="sxs-lookup"><span data-stu-id="a162e-111">See [Install NuGet packages](sample-insert-update-record-upsert.md#BKMK_installNuget) for instructions.</span></span>  

4. <span data-ttu-id="a162e-112">After you install the NuGet packages, see [Run the sample](sample-insert-update-record-upsert.md#BKMK_runSample) for instructions on how to run the sample and what to expect.</span><span class="sxs-lookup"><span data-stu-id="a162e-112">After you install the NuGet packages, see [Run the sample](sample-insert-update-record-upsert.md#BKMK_runSample) for instructions on how to run the sample and what to expect.</span></span>  

<a name="BKMK_WhatThisSampleDoes"></a>   
## <a name="what-this-sample-does"></a><span data-ttu-id="a162e-113">What this sample does</span><span class="sxs-lookup"><span data-stu-id="a162e-113">What this sample does</span></span>  

1. <span data-ttu-id="a162e-114">The `ProductUpsertSample` class `Run` method calls the `ImportUpsertSampleSolution` method which first detects whether the UpsertSample managed solution is already installed.</span><span class="sxs-lookup"><span data-stu-id="a162e-114">The `ProductUpsertSample` class `Run` method calls the `ImportUpsertSampleSolution` method which first detects whether the UpsertSample managed solution is already installed.</span></span> <span data-ttu-id="a162e-115">If it is not, the UpsertSample_1_0_0_0_managed.zip file is imported to install this managed solution.</span><span class="sxs-lookup"><span data-stu-id="a162e-115">If it is not, the UpsertSample_1_0_0_0_managed.zip file is imported to install this managed solution.</span></span>  

    <span data-ttu-id="a162e-116">This managed solution contains a custom sample_product entity that is used by this sample.</span><span class="sxs-lookup"><span data-stu-id="a162e-116">This managed solution contains a custom sample_product entity that is used by this sample.</span></span> <span data-ttu-id="a162e-117">This entity has a sample_productcode alternate key that creates a unique constraint on the values stored in that attribute.</span><span class="sxs-lookup"><span data-stu-id="a162e-117">This entity has a sample_productcode alternate key that creates a unique constraint on the values stored in that attribute.</span></span>  

2. <span data-ttu-id="a162e-118">The `WaitForEntityAndKeysToBeActive` method is necessary because the alternate keys required for this sample may not be ready immediately after the UpsertSample solution is installed.</span><span class="sxs-lookup"><span data-stu-id="a162e-118">The `WaitForEntityAndKeysToBeActive` method is necessary because the alternate keys required for this sample may not be ready immediately after the UpsertSample solution is installed.</span></span> <span data-ttu-id="a162e-119">This method polls the metadata for the sample_product entity to delay the execution of the rest of the sample until the alternate keys are ready.</span><span class="sxs-lookup"><span data-stu-id="a162e-119">This method polls the metadata for the sample_product entity to delay the execution of the rest of the sample until the alternate keys are ready.</span></span>  

3. <span data-ttu-id="a162e-120">The first time the `ProcessUpsert` method is called it processes data in the newsampleproduct.xml file to represent new products.</span><span class="sxs-lookup"><span data-stu-id="a162e-120">The first time the `ProcessUpsert` method is called it processes data in the newsampleproduct.xml file to represent new products.</span></span> <span data-ttu-id="a162e-121">The <xref:Microsoft.Xrm.Sdk.Messages.UpsertRequest> is passed to the <xref:Microsoft.Xrm.Sdk.IOrganizationService>.<xref:Microsoft.Xrm.Sdk.IOrganizationService.Execute*></span><span class="sxs-lookup"><span data-stu-id="a162e-121">The <xref:Microsoft.Xrm.Sdk.Messages.UpsertRequest> is passed to the <xref:Microsoft.Xrm.Sdk.IOrganizationService>.<xref:Microsoft.Xrm.Sdk.IOrganizationService.Execute*></span></span> <span data-ttu-id="a162e-122">method to create 13 new records.</span><span class="sxs-lookup"><span data-stu-id="a162e-122">method to create 13 new records.</span></span>  

    <span data-ttu-id="a162e-123">The <xref:Microsoft.Xrm.Sdk.Messages.UpsertResponse>.<xref:Microsoft.Xrm.Sdk.Messages.UpsertResponse.RecordCreated></span><span class="sxs-lookup"><span data-stu-id="a162e-123">The <xref:Microsoft.Xrm.Sdk.Messages.UpsertResponse>.<xref:Microsoft.Xrm.Sdk.Messages.UpsertResponse.RecordCreated></span></span> <span data-ttu-id="a162e-124">property returns true to indicate that new records were created.</span><span class="sxs-lookup"><span data-stu-id="a162e-124">property returns true to indicate that new records were created.</span></span>  

    <span data-ttu-id="a162e-125">Before the `ProcessUpsert` method completes, the program will ask if you want to view the sample product entity records.</span><span class="sxs-lookup"><span data-stu-id="a162e-125">Before the `ProcessUpsert` method completes, the program will ask if you want to view the sample product entity records.</span></span> <span data-ttu-id="a162e-126">If you respond with ‘y’ the program will attempt to open [!INCLUDE[pn_Internet_Explorer](../includes/pn-internet-explorer.md)] to a view showing the newly created records.</span><span class="sxs-lookup"><span data-stu-id="a162e-126">If you respond with ‘y’ the program will attempt to open [!INCLUDE[pn_Internet_Explorer](../includes/pn-internet-explorer.md)] to a view showing the newly created records.</span></span>  

4. <span data-ttu-id="a162e-127">The second time the `ProcessUpsert` method is called it processes data in the updatedsampleproduct.xml file to represent updates to products previously created.</span><span class="sxs-lookup"><span data-stu-id="a162e-127">The second time the `ProcessUpsert` method is called it processes data in the updatedsampleproduct.xml file to represent updates to products previously created.</span></span> <span data-ttu-id="a162e-128">The `Upsert` message is used to update 6 records.</span><span class="sxs-lookup"><span data-stu-id="a162e-128">The `Upsert` message is used to update 6 records.</span></span> <span data-ttu-id="a162e-129">The `UpsertResponse`.`RecordCreated`</span><span class="sxs-lookup"><span data-stu-id="a162e-129">The `UpsertResponse`.`RecordCreated`</span></span> <span data-ttu-id="a162e-130">property returns false showing that records were updated.</span><span class="sxs-lookup"><span data-stu-id="a162e-130">property returns false showing that records were updated.</span></span>  

    <span data-ttu-id="a162e-131">Again, the `ProcessUpsert` method will ask if you want to view the records in the browser.</span><span class="sxs-lookup"><span data-stu-id="a162e-131">Again, the `ProcessUpsert` method will ask if you want to view the records in the browser.</span></span> <span data-ttu-id="a162e-132">If you already have the view open, you can just refresh the view to observe the changes.</span><span class="sxs-lookup"><span data-stu-id="a162e-132">If you already have the view open, you can just refresh the view to observe the changes.</span></span>  

5. <span data-ttu-id="a162e-133">Finally, the `DeleteUpsertSampleSolution` will prompt you to delete the Upsert Sample managed solution.</span><span class="sxs-lookup"><span data-stu-id="a162e-133">Finally, the `DeleteUpsertSampleSolution` will prompt you to delete the Upsert Sample managed solution.</span></span>  

    <span data-ttu-id="a162e-134">If you choose “y”, the managed solution will be deleted including the sample_product entity and all the data in that entity.</span><span class="sxs-lookup"><span data-stu-id="a162e-134">If you choose “y”, the managed solution will be deleted including the sample_product entity and all the data in that entity.</span></span> <span data-ttu-id="a162e-135">Your organization will be left with nothing added to it.</span><span class="sxs-lookup"><span data-stu-id="a162e-135">Your organization will be left with nothing added to it.</span></span>  

    <span data-ttu-id="a162e-136">If you choose “n”, you can inspect the details of the solution including the data created by the sample.</span><span class="sxs-lookup"><span data-stu-id="a162e-136">If you choose “n”, you can inspect the details of the solution including the data created by the sample.</span></span> <span data-ttu-id="a162e-137">But you must manually delete the managed solution to return your organization to the original state.</span><span class="sxs-lookup"><span data-stu-id="a162e-137">But you must manually delete the managed solution to return your organization to the original state.</span></span>  

<a name="BKMK_installNuget"></a>   
## <a name="install-nuget-packages"></a><span data-ttu-id="a162e-138">Install NuGet packages</span><span class="sxs-lookup"><span data-stu-id="a162e-138">Install NuGet packages</span></span>  
 <span data-ttu-id="a162e-139">Use the following steps to install the required assemblies for this sample:</span><span class="sxs-lookup"><span data-stu-id="a162e-139">Use the following steps to install the required assemblies for this sample:</span></span>  

1.  <span data-ttu-id="a162e-140">Download this sample and extract the files.</span><span class="sxs-lookup"><span data-stu-id="a162e-140">Download this sample and extract the files.</span></span>  

2.  <span data-ttu-id="a162e-141">Navigate to the C# folder and open the UpsertSample.sln file using Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a162e-141">Navigate to the C# folder and open the UpsertSample.sln file using Visual Studio.</span></span>  

3.  <span data-ttu-id="a162e-142">In Visual Studio, right-click the UpsertSample project and click **Manage NuGet Packages**.</span><span class="sxs-lookup"><span data-stu-id="a162e-142">In Visual Studio, right-click the UpsertSample project and click **Manage NuGet Packages**.</span></span>  

4.  <span data-ttu-id="a162e-143">For the preview release, make sure to click **Include Prerelease** rather than **Stable Only** in the search criteria.</span><span class="sxs-lookup"><span data-stu-id="a162e-143">For the preview release, make sure to click **Include Prerelease** rather than **Stable Only** in the search criteria.</span></span> <span data-ttu-id="a162e-144">Then search for “Microsoft Dynamics CRM 2016 SDK core assemblies”.</span><span class="sxs-lookup"><span data-stu-id="a162e-144">Then search for “Microsoft Dynamics CRM 2016 SDK core assemblies”.</span></span> <span data-ttu-id="a162e-145">Make sure you select the 8.0.0-preview or later version.</span><span class="sxs-lookup"><span data-stu-id="a162e-145">Make sure you select the 8.0.0-preview or later version.</span></span>  

5.  <span data-ttu-id="a162e-146">Bấm vào **cài đặt**.</span><span class="sxs-lookup"><span data-stu-id="a162e-146">Click **Install**.</span></span> <span data-ttu-id="a162e-147">You’ll need to accept the license terms to complete installing this package.</span><span class="sxs-lookup"><span data-stu-id="a162e-147">You’ll need to accept the license terms to complete installing this package.</span></span>  

<a name="BKMK_runSample"></a>   
## <a name="run-the-sample"></a><span data-ttu-id="a162e-148">Run the sample</span><span class="sxs-lookup"><span data-stu-id="a162e-148">Run the sample</span></span>  

1. <span data-ttu-id="a162e-149">In Visual Studio, with the solution open and the necessary NuGet packages installed, press F5.</span><span class="sxs-lookup"><span data-stu-id="a162e-149">In Visual Studio, with the solution open and the necessary NuGet packages installed, press F5.</span></span>  

2. <span data-ttu-id="a162e-150">If you have not previously run one of the Dynamics 365 for Customer Engagement managed code samples before, you’ll need to enter information to run the code, otherwise enter the number for one of the Dynamics 365 for Customer Engagement servers you have previously set up.</span><span class="sxs-lookup"><span data-stu-id="a162e-150">If you have not previously run one of the Dynamics 365 for Customer Engagement managed code samples before, you’ll need to enter information to run the code, otherwise enter the number for one of the Dynamics 365 for Customer Engagement servers you have previously set up.</span></span>  


   |                                                   <span data-ttu-id="a162e-151">Prompt</span><span class="sxs-lookup"><span data-stu-id="a162e-151">Prompt</span></span>                                                    |                                                                                                                                                                                       <span data-ttu-id="a162e-152">Mô tả</span><span class="sxs-lookup"><span data-stu-id="a162e-152">Description</span></span>                                                                                                                                                                                        |
   |-------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   |                        <span data-ttu-id="a162e-153">Enter a Dynamics 365 for Customer Engagement server name and port [crm.dynamics.com]</span><span class="sxs-lookup"><span data-stu-id="a162e-153">Enter a Dynamics 365 for Customer Engagement server name and port [crm.dynamics.com]</span></span>                         | <span data-ttu-id="a162e-154">Type the name of your Dynamics 365 for Customer Engagement server.</span><span class="sxs-lookup"><span data-stu-id="a162e-154">Type the name of your Dynamics 365 for Customer Engagement server.</span></span> <span data-ttu-id="a162e-155">The default for [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] is crm.dynamics.com in North America.</span><span class="sxs-lookup"><span data-stu-id="a162e-155">The default for [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] is crm.dynamics.com in North America.</span></span><br /><br /> <span data-ttu-id="a162e-156">Ví dụ: </span><span class="sxs-lookup"><span data-stu-id="a162e-156">Example:</span></span> <br /><span data-ttu-id="a162e-157">myservername</span><span class="sxs-lookup"><span data-stu-id="a162e-157">myservername</span></span><br /><span data-ttu-id="a162e-158">myprefix.myservername:5500</span><span class="sxs-lookup"><span data-stu-id="a162e-158">myprefix.myservername:5500</span></span><br /><span data-ttu-id="a162e-159">crm5.dynamics.com</span><span class="sxs-lookup"><span data-stu-id="a162e-159">crm5.dynamics.com</span></span><br /><br /> <span data-ttu-id="a162e-160">Don’t include the name of your organization or Internet protocol (http or https).</span><span class="sxs-lookup"><span data-stu-id="a162e-160">Don’t include the name of your organization or Internet protocol (http or https).</span></span> <span data-ttu-id="a162e-161">You’ll be prompted for that later.</span><span class="sxs-lookup"><span data-stu-id="a162e-161">You’ll be prompted for that later.</span></span> |
   |                    <span data-ttu-id="a162e-162">Is this server configured for Secure Sockets Layer (https) (y/n) [n]</span><span class="sxs-lookup"><span data-stu-id="a162e-162">Is this server configured for Secure Sockets Layer (https) (y/n) [n]</span></span>                     |                                                                                                                                             <span data-ttu-id="a162e-163">Type **y** if the URL you use to access Dynamics 365 for Customer Engagement begins with https://, otherwise type **n**.</span><span class="sxs-lookup"><span data-stu-id="a162e-163">Type **y** if the URL you use to access Dynamics 365 for Customer Engagement begins with https://, otherwise type **n**.</span></span>                                                                                                                                             |
   | <span data-ttu-id="a162e-164">Is this organization provisioned in [!INCLUDE[pn_MS_Office_365](../includes/pn-ms-office-365.md)] (y/n) [n]</span><span class="sxs-lookup"><span data-stu-id="a162e-164">Is this organization provisioned in [!INCLUDE[pn_MS_Office_365](../includes/pn-ms-office-365.md)] (y/n) [n]</span></span> |                                                                                                                          <span data-ttu-id="a162e-165">Type **y** if this is a [!INCLUDE[pn_MS_Office_365](../includes/pn-ms-office-365.md)] provisioned organization.</span><span class="sxs-lookup"><span data-stu-id="a162e-165">Type **y** if this is a [!INCLUDE[pn_MS_Office_365](../includes/pn-ms-office-365.md)] provisioned organization.</span></span> <span data-ttu-id="a162e-166">Otherwise, type **n**.</span><span class="sxs-lookup"><span data-stu-id="a162e-166">Otherwise, type **n**.</span></span>                                                                                                                          |
   |                                            <span data-ttu-id="a162e-167">Enter domain\username</span><span class="sxs-lookup"><span data-stu-id="a162e-167">Enter domain\username</span></span>                                            |                                                                                                                                <span data-ttu-id="a162e-168">Type your Microsoft account.</span><span class="sxs-lookup"><span data-stu-id="a162e-168">Type your Microsoft account.</span></span> <br /><span data-ttu-id="a162e-169">For Dynamics 365 for Customer Engagement, type your network domain and user name separated by a backslash (\\).</span><span class="sxs-lookup"><span data-stu-id="a162e-169">For Dynamics 365 for Customer Engagement, type your network domain and user name separated by a backslash (\\).</span></span>                                                                                                                                |
   |                                               <span data-ttu-id="a162e-170">Enter password</span><span class="sxs-lookup"><span data-stu-id="a162e-170">Enter password</span></span>                                                |                                                                                                                 <span data-ttu-id="a162e-171">Type your password.</span><span class="sxs-lookup"><span data-stu-id="a162e-171">Type your password.</span></span> <span data-ttu-id="a162e-172">The characters will show as “\*” in the window.</span><span class="sxs-lookup"><span data-stu-id="a162e-172">The characters will show as “\*” in the window.</span></span> <span data-ttu-id="a162e-173">Your password is securely saved in the Microsoft Credential Manager for later reuse.</span><span class="sxs-lookup"><span data-stu-id="a162e-173">Your password is securely saved in the Microsoft Credential Manager for later reuse.</span></span>                                                                                                                 |
   |                                  <span data-ttu-id="a162e-174">Specify an organization number (1-n) [1]</span><span class="sxs-lookup"><span data-stu-id="a162e-174">Specify an organization number (1-n) [1]</span></span>                                   |                                                                                                                 <span data-ttu-id="a162e-175">From the list of organizations shown that you belong to, type the corresponding number.</span><span class="sxs-lookup"><span data-stu-id="a162e-175">From the list of organizations shown that you belong to, type the corresponding number.</span></span> <span data-ttu-id="a162e-176">The default is 1, indicating the first organization in the list.</span><span class="sxs-lookup"><span data-stu-id="a162e-176">The default is 1, indicating the first organization in the list.</span></span>                                                                                                                 |


3. <span data-ttu-id="a162e-177">The sample will perform the operations described in [What this sample does](sample-insert-update-record-upsert.md#BKMK_WhatThisSampleDoes) and may prompt you with additional options.</span><span class="sxs-lookup"><span data-stu-id="a162e-177">The sample will perform the operations described in [What this sample does](sample-insert-update-record-upsert.md#BKMK_WhatThisSampleDoes) and may prompt you with additional options.</span></span>  

4. <span data-ttu-id="a162e-178">When the sample is complete, press **Enter** to close the console window.</span><span class="sxs-lookup"><span data-stu-id="a162e-178">When the sample is complete, press **Enter** to close the console window.</span></span>  

### <a name="see-also"></a><span data-ttu-id="a162e-179">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="a162e-179">See also</span></span>  
 [<span data-ttu-id="a162e-180">Use Upsert to insert or update a record</span><span class="sxs-lookup"><span data-stu-id="a162e-180">Use Upsert to insert or update a record</span></span>](use-upsert-insert-update-record.md)
