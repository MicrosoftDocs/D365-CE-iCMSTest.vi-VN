---
title: Define custom claim mapping for SharePoint server-based integration (Developer Guide for Dynamics 365 for Customer Engagement)| MicrosoftDocs
ms.custom: ''
ms.date: 10/31/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
- Dynamics 365 for Customer Engagement (on-premises)
- Dynamics CRM 2016
- Dynamics CRM Online
ms.assetid: f926277d-6820-4ea3-9512-3643da16b94b
caps.latest.revision: 15
author: KumarVivek
ms.author: kvivek
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: a7ec378bcd16d1e5056011e716536a7fc444ab64
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "385717"
---
<!-- jdaly bug 700711 determines whether this page should be removed  -->

# <a name="define-custom-claim-mapping-for-sharepoint-server-based-integration"></a><span data-ttu-id="c6981-102">Define custom claim mapping for SharePoint server-based integration</span><span class="sxs-lookup"><span data-stu-id="c6981-102">Define custom claim mapping for SharePoint server-based integration</span></span>

[!INCLUDE[](../../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="c6981-103">For server-based integration with [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)], [!INCLUDE[pn_microsoftcrm](../../includes/pn-microsoftcrm.md)] apps  uses claims to authenticate and authorize [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] users to access the documents stored in [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-103">For server-based integration with [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)], [!INCLUDE[pn_microsoftcrm](../../includes/pn-microsoftcrm.md)] apps  uses claims to authenticate and authorize [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] users to access the documents stored in [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span></span> <span data-ttu-id="c6981-104">For more information about claims-based authentication, see [Claims-based identity in SharePoint 2013](https://msdn.microsoft.com/library/office/ee535242.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6981-104">For more information about claims-based authentication, see [Claims-based identity in SharePoint 2013](https://msdn.microsoft.com/library/office/ee535242.aspx).</span></span>  

 <span data-ttu-id="c6981-105">By default, [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] apps uses the following claims  to integrate with [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)]:</span><span class="sxs-lookup"><span data-stu-id="c6981-105">By default, [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] apps uses the following claims  to integrate with [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)]:</span></span>  


|                                                                              <span data-ttu-id="c6981-106">Kịch bản</span><span class="sxs-lookup"><span data-stu-id="c6981-106">Scenario</span></span>                                                                               |                                                                                                                                              <span data-ttu-id="c6981-107">Claims</span><span class="sxs-lookup"><span data-stu-id="c6981-107">Claims</span></span>                                                                                                                                              |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|      [!INCLUDE[pn_crm_online_shortest](../../includes/pn-crm-online-shortest.md)] <span data-ttu-id="c6981-108">và [!INCLUDE[pn_sharepoint_online](../../includes/pn-sharepoint-online.md)]</span><span class="sxs-lookup"><span data-stu-id="c6981-108">and [!INCLUDE[pn_sharepoint_online](../../includes/pn-sharepoint-online.md)]</span></span>      |                                                   `NameId (PUID)`<br /><br /> <span data-ttu-id="c6981-109">Both Dynamics 365 for Customer Engagement apps and SharePoint share [!INCLUDE[pn_microsoft_azure_active_directory](../../includes/pn-microsoft-azure-active-directory.md)] for user identity.</span><span class="sxs-lookup"><span data-stu-id="c6981-109">Both Dynamics 365 for Customer Engagement apps and SharePoint share [!INCLUDE[pn_microsoft_azure_active_directory](../../includes/pn-microsoft-azure-active-directory.md)] for user identity.</span></span>                                                   |
| [!INCLUDE[pn_crm_online_shortest](../../includes/pn-crm-online-shortest.md)] <span data-ttu-id="c6981-110">and [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)] on-premises</span><span class="sxs-lookup"><span data-stu-id="c6981-110">and [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)] on-premises</span></span> | `SMTP (email)`<br /><br /> <span data-ttu-id="c6981-111">No shared active directory infrastructure for user identity; claims sent as SMTP address.</span><span class="sxs-lookup"><span data-stu-id="c6981-111">No shared active directory infrastructure for user identity; claims sent as SMTP address.</span></span> <span data-ttu-id="c6981-112">The claims is picked from WindowsLiveID field in Dynamics 365 for Customer Engagement apps and mapped to work email address from [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-112">The claims is picked from WindowsLiveID field in Dynamics 365 for Customer Engagement apps and mapped to work email address from [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span></span> |
|                                <span data-ttu-id="c6981-113">Dynamics 365 for Customer Engagement on-premises and [!INCLUDE[pn_sharepoint_online](../../includes/pn-sharepoint-online.md)]</span><span class="sxs-lookup"><span data-stu-id="c6981-113">Dynamics 365 for Customer Engagement on-premises and [!INCLUDE[pn_sharepoint_online](../../includes/pn-sharepoint-online.md)]</span></span>                                |                            `SMTP (email)`<br /><br /> <span data-ttu-id="c6981-114">No shared active directory infrastructure for user identity; claims sent as SMTP address.</span><span class="sxs-lookup"><span data-stu-id="c6981-114">No shared active directory infrastructure for user identity; claims sent as SMTP address.</span></span> <span data-ttu-id="c6981-115">The claims is picked from PrimaryEmailAddess field in Dynamics 365 for Customer Engagement apps and mapped to work email address from SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c6981-115">The claims is picked from PrimaryEmailAddess field in Dynamics 365 for Customer Engagement apps and mapped to work email address from SharePoint.</span></span>                             |
|                           <span data-ttu-id="c6981-116">Dynamics 365 for Customer Engagement on-premises and [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)] on-premises</span><span class="sxs-lookup"><span data-stu-id="c6981-116">Dynamics 365 for Customer Engagement on-premises and [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)] on-premises</span></span>                           |                                                                           `Security Identifier (SID)`<br /><br /> <span data-ttu-id="c6981-117">Both Dynamics 365 for Customer Engagement apps  and SharePoint share Microsoft Windows Server Active Directory for user identity.</span><span class="sxs-lookup"><span data-stu-id="c6981-117">Both Dynamics 365 for Customer Engagement apps  and SharePoint share Microsoft Windows Server Active Directory for user identity.</span></span>                                                                            |

 <span data-ttu-id="c6981-118">You can use the `UserMapping` entity to specify custom claim mappings in [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] to use a value other than the default value used by [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] to authenticate and authorize [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] users in [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-118">You can use the `UserMapping` entity to specify custom claim mappings in [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] to use a value other than the default value used by [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] to authenticate and authorize [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] users in [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span></span> <span data-ttu-id="c6981-119">For example, you can use the “last name” and “first name” of the user instead of “email” to authenticate [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] users in [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-119">For example, you can use the “last name” and “first name” of the user instead of “email” to authenticate [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] users in [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span></span> <span data-ttu-id="c6981-120">Custom claim mappings override the default claim mappings used by [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-120">Custom claim mappings override the default claim mappings used by [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)].</span></span> <span data-ttu-id="c6981-121">You can define multiple custom claim mappings in [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-121">You can define multiple custom claim mappings in [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)].</span></span> <span data-ttu-id="c6981-122">By default, only users having the System Administrator role have access to the `UserMapping` entity.</span><span class="sxs-lookup"><span data-stu-id="c6981-122">By default, only users having the System Administrator role have access to the `UserMapping` entity.</span></span>  

 <span data-ttu-id="c6981-123">To define a custom claim mapping in [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)], create a `UserMapping` entity record, and specify the attribute values listed in the following table.</span><span class="sxs-lookup"><span data-stu-id="c6981-123">To define a custom claim mapping in [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)], create a `UserMapping` entity record, and specify the attribute values listed in the following table.</span></span>  


|               <span data-ttu-id="c6981-124">Thuộc tính</span><span class="sxs-lookup"><span data-stu-id="c6981-124">Attribute</span></span>               |                                                                     <span data-ttu-id="c6981-125">Value</span><span class="sxs-lookup"><span data-stu-id="c6981-125">Value</span></span>                                                                      |                                                                                                                                                                                                                                                                                <span data-ttu-id="c6981-126">Mô tả</span><span class="sxs-lookup"><span data-stu-id="c6981-126">Description</span></span>                                                                                                                                                                                                                                                                                |
|---------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `UserMapping.PartnerApplicationType`  | <span data-ttu-id="c6981-127">-   `0`: [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)]</span><span class="sxs-lookup"><span data-stu-id="c6981-127">-   `0`: [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)]</span></span><br /><span data-ttu-id="c6981-128">-   `1`: [!INCLUDE[internal](../../includes/internal.md)]</span><span class="sxs-lookup"><span data-stu-id="c6981-128">-   `1`: [!INCLUDE[internal](../../includes/internal.md)]</span></span> |                                                                                                                                                                                     <span data-ttu-id="c6981-129">The partner application type for which this claim mapping is to be used.</span><span class="sxs-lookup"><span data-stu-id="c6981-129">The partner application type for which this claim mapping is to be used.</span></span> <span data-ttu-id="c6981-130">In the current release, only `0` ([!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)]) is supported.</span><span class="sxs-lookup"><span data-stu-id="c6981-130">In the current release, only `0` ([!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)]) is supported.</span></span>                                                                                                                                                                                      |
| `UserMapping.SystemUserAttributeName` |                                                                  <span data-ttu-id="c6981-131">String value</span><span class="sxs-lookup"><span data-stu-id="c6981-131">String value</span></span>                                                                  | <span data-ttu-id="c6981-132">The logical name of the attribute in the `SystemUser` (user) entity from where the value for the claims will be used.</span><span class="sxs-lookup"><span data-stu-id="c6981-132">The logical name of the attribute in the `SystemUser` (user) entity from where the value for the claims will be used.</span></span> <span data-ttu-id="c6981-133">**Note:**  If the attribute used for custom claim mapping doesn’t contain a value, the default claim mapping is used by [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-133">**Note:**  If the attribute used for custom claim mapping doesn’t contain a value, the default claim mapping is used by [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)].</span></span> <span data-ttu-id="c6981-134">For example, if you want to use the first name of the user as the attribute for custom claim mapping and a user’s first name is missing, [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] will use the default claim mapping (PUID or email).</span><span class="sxs-lookup"><span data-stu-id="c6981-134">For example, if you want to use the first name of the user as the attribute for custom claim mapping and a user’s first name is missing, [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)] will use the default claim mapping (PUID or email).</span></span> |
|        `UserMapping.ClaimType`        |                                                                  <span data-ttu-id="c6981-135">String value</span><span class="sxs-lookup"><span data-stu-id="c6981-135">String value</span></span>                                                                  |                     <span data-ttu-id="c6981-136">Specify the claim type to be sent to SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c6981-136">Specify the claim type to be sent to SharePoint.</span></span> <span data-ttu-id="c6981-137">For a list of claim types, see [ClaimTypes Members](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimtypes_members.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6981-137">For a list of claim types, see [ClaimTypes Members](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimtypes_members.aspx).</span></span> <span data-ttu-id="c6981-138">**Note:**  The referred claim type list is just for reference.</span><span class="sxs-lookup"><span data-stu-id="c6981-138">**Note:**  The referred claim type list is just for reference.</span></span> <span data-ttu-id="c6981-139">All the claim types listed there might not be supported by [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)], or might not contain all the claim types supported by [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-139">All the claim types listed there might not be supported by [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)], or might not contain all the claim types supported by [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span></span>                      |

 <span data-ttu-id="c6981-140">The following sample code shows how to define a custom claim mapping using the `UserMapping` entity.</span><span class="sxs-lookup"><span data-stu-id="c6981-140">The following sample code shows how to define a custom claim mapping using the `UserMapping` entity.</span></span>  

```csharp
UserMapping customMapping = new UserMapping  
{  
   PartnerApplicationType = new OptionSetValue(0),  
   SystemUserAttributeName = "personalemailaddress",  
   ClaimType = "smtp"  
};  
_serviceProxy.Create(customMapping);  
```  

> [!NOTE]
>  <span data-ttu-id="c6981-141">Any instance of the `UserMapping` entity with valid values will override the default claim mappings used by [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-141">Any instance of the `UserMapping` entity with valid values will override the default claim mappings used by [!INCLUDE[pn_crm_shortest](../../includes/pn-crm-shortest.md)].</span></span>  

 <span data-ttu-id="c6981-142">By default, [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)] supports the following claim types: NameId (PUID), SMTP (email), and UPN (user principal name).</span><span class="sxs-lookup"><span data-stu-id="c6981-142">By default, [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)] supports the following claim types: NameId (PUID), SMTP (email), and UPN (user principal name).</span></span> <span data-ttu-id="c6981-143">If you’re passing a claim of any other type, you must also create corresponding claim type mappings in [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span><span class="sxs-lookup"><span data-stu-id="c6981-143">If you’re passing a claim of any other type, you must also create corresponding claim type mappings in [!INCLUDE[pn_SharePoint_short](../../includes/pn-sharepoint-short.md)].</span></span> [!INCLUDE[proc_more_information](../../includes/proc-more-information.md)]<span data-ttu-id="c6981-144">[New-SPClaimTypeMapping](https://technet.microsoft.com/library/ff607650.aspx)</span><span class="sxs-lookup"><span data-stu-id="c6981-144">[New-SPClaimTypeMapping](https://technet.microsoft.com/library/ff607650.aspx)</span></span>  

### <a name="see-also"></a><span data-ttu-id="c6981-145">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="c6981-145">See Also</span></span>
 <span data-ttu-id="c6981-146">[UserMapping Entity](../entities/usermapping.md) </span><span class="sxs-lookup"><span data-stu-id="c6981-146">[UserMapping Entity](../entities/usermapping.md) </span></span>  
 [<span data-ttu-id="c6981-147">Integrate Microsoft Dynamics 365 for Customer Engagement apps with SharePoint</span><span class="sxs-lookup"><span data-stu-id="c6981-147">Integrate Microsoft Dynamics 365 for Customer Engagement apps with SharePoint</span></span>](integrate-sharepoint.md)
