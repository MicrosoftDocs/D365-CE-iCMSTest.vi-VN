---
title: Use Multi-Tenant Server-to-server authentication (Developer Guide for Dynamics 365 for Customer Engagement apps)| MicrosoftDocs
description: Learn how to use multi-tenant Server-to-server authentication using an Azure AD tenant
ms.custom: ''
ms.date: 09/27/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: get-started-article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: a77637f4-420a-4686-9084-d0288d9154af
caps.latest.revision: 12
author: paulliew
ms.author: jdaly
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: fc5b6b99a99c54082f3f9475f11947817bb66b7d
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "386127"
---
# <a name="use-multi-tenant-server-to-server-authentication"></a><span data-ttu-id="7df38-103">Use Multi-Tenant Server-to-server authentication</span><span class="sxs-lookup"><span data-stu-id="7df38-103">Use Multi-Tenant Server-to-server authentication</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="7df38-104">This is the most common scenario and the one which is used for apps distributed using [!INCLUDE[pn_microsoft_appsource](../includes/pn-microsoft-appsource.md)], but you can also use multi-tenant without listing your application with [!INCLUDE[pn_microsoft_appsource](../includes/pn-microsoft-appsource.md)].</span><span class="sxs-lookup"><span data-stu-id="7df38-104">This is the most common scenario and the one which is used for apps distributed using [!INCLUDE[pn_microsoft_appsource](../includes/pn-microsoft-appsource.md)], but you can also use multi-tenant without listing your application with [!INCLUDE[pn_microsoft_appsource](../includes/pn-microsoft-appsource.md)].</span></span>  
  
 <span data-ttu-id="7df38-105">Each [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] Customer Engagement organization is associated with an [!INCLUDE[pn_azure_active_directory](../includes/pn-azure-active-directory.md)] (Azure AD) tenant.</span><span class="sxs-lookup"><span data-stu-id="7df38-105">Each [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] Customer Engagement organization is associated with an [!INCLUDE[pn_azure_active_directory](../includes/pn-azure-active-directory.md)] (Azure AD) tenant.</span></span> <span data-ttu-id="7df38-106">Your web application or service is registered with its own Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="7df38-106">Your web application or service is registered with its own Azure AD tenant.</span></span>  
  
 <span data-ttu-id="7df38-107">In this scenario any [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant can potentially use your multi-tenant application after they grant consent for the application to access data.</span><span class="sxs-lookup"><span data-stu-id="7df38-107">In this scenario any [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant can potentially use your multi-tenant application after they grant consent for the application to access data.</span></span>  
  
<a name="bkmk_Requirements"></a>   

## <a name="requirements"></a><span data-ttu-id="7df38-108">Yêu cầu</span><span class="sxs-lookup"><span data-stu-id="7df38-108">Requirements</span></span>  

 <span data-ttu-id="7df38-109">To create and test a multi-tenant application that uses server-to-server (S2S) authentication you will need:</span><span class="sxs-lookup"><span data-stu-id="7df38-109">To create and test a multi-tenant application that uses server-to-server (S2S) authentication you will need:</span></span>  
  
- <span data-ttu-id="7df38-110">An Azure AD tenant you will use to publish your application or service.</span><span class="sxs-lookup"><span data-stu-id="7df38-110">An Azure AD tenant you will use to publish your application or service.</span></span>  
  
- <span data-ttu-id="7df38-111">2 [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] subscriptions</span><span class="sxs-lookup"><span data-stu-id="7df38-111">2 [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] subscriptions</span></span>  
  
  -   <span data-ttu-id="7df38-112">One must be associated with Azure AD tenant you will use to publish your application or service.</span><span class="sxs-lookup"><span data-stu-id="7df38-112">One must be associated with Azure AD tenant you will use to publish your application or service.</span></span>  
  
  -   <span data-ttu-id="7df38-113">The other might be a trial subscription to use for testing how a subscriber will access your application.</span><span class="sxs-lookup"><span data-stu-id="7df38-113">The other might be a trial subscription to use for testing how a subscriber will access your application.</span></span>  
  
<a name="bkmk_DevelopAndTest"></a>  
 
## <a name="overview-develop-and-test-your-application"></a><span data-ttu-id="7df38-114">Overview: Develop and test your application</span><span class="sxs-lookup"><span data-stu-id="7df38-114">Overview: Develop and test your application</span></span>  

 <span data-ttu-id="7df38-115">The application you will create must be registered with the Azure AD tenant you will use when you publish the application.</span><span class="sxs-lookup"><span data-stu-id="7df38-115">The application you will create must be registered with the Azure AD tenant you will use when you publish the application.</span></span>  
  
 <span data-ttu-id="7df38-116">At a high level, the process consists of:</span><span class="sxs-lookup"><span data-stu-id="7df38-116">At a high level, the process consists of:</span></span>  
  
1. <span data-ttu-id="7df38-117">Create a multi-tenant web application registered with your Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="7df38-117">Create a multi-tenant web application registered with your Azure AD tenant.</span></span>  
  
2. <span data-ttu-id="7df38-118">Create an application user associated with the registered application  in your [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant</span><span class="sxs-lookup"><span data-stu-id="7df38-118">Create an application user associated with the registered application  in your [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant</span></span>  
  
3. <span data-ttu-id="7df38-119">Create a custom security role and assign it to the application user in your [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant</span><span class="sxs-lookup"><span data-stu-id="7df38-119">Create a custom security role and assign it to the application user in your [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant</span></span>  
  
4. <span data-ttu-id="7df38-120">Test your application using your [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant</span><span class="sxs-lookup"><span data-stu-id="7df38-120">Test your application using your [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant</span></span>  
  
5. <span data-ttu-id="7df38-121">Test your application using a separate [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant</span><span class="sxs-lookup"><span data-stu-id="7df38-121">Test your application using a separate [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)] tenant</span></span>  
  
   <span data-ttu-id="7df38-122">For a complete example of this process, see [Walkthrough: Multi-tenant server-to-server authentication](walkthrough-multi-tenant-server-server-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="7df38-122">For a complete example of this process, see [Walkthrough: Multi-tenant server-to-server authentication](walkthrough-multi-tenant-server-server-authentication.md).</span></span>  
  
<a name="bkmk_CreateAMultitenantWebApp"></a>
   
## <a name="create-a-multi-tenant-web-application-registered-with-your-azure-ad-tenant"></a><span data-ttu-id="7df38-123">Create a multi-tenant web application registered with your Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="7df38-123">Create a multi-tenant web application registered with your Azure AD tenant</span></span> 
 
 <span data-ttu-id="7df38-124">You will create a multi-tenant web application or service which uses Azure AD as the authentication provider.</span><span class="sxs-lookup"><span data-stu-id="7df38-124">You will create a multi-tenant web application or service which uses Azure AD as the authentication provider.</span></span>  
  
 <span data-ttu-id="7df38-125">Exactly how you do this will not be the focus of this topic.</span><span class="sxs-lookup"><span data-stu-id="7df38-125">Exactly how you do this will not be the focus of this topic.</span></span> <span data-ttu-id="7df38-126">There are a number of ways you can approach this and make choices that fit your requirements or preferences.</span><span class="sxs-lookup"><span data-stu-id="7df38-126">There are a number of ways you can approach this and make choices that fit your requirements or preferences.</span></span> <span data-ttu-id="7df38-127">See the following links for more information and samples:</span><span class="sxs-lookup"><span data-stu-id="7df38-127">See the following links for more information and samples:</span></span>  
  
- [<span data-ttu-id="7df38-128">Build a multi-tenant SaaS web application using Azure AD &amp; OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="7df38-128">Build a multi-tenant SaaS web application using Azure AD &amp; OpenID Connect</span></span>](https://azure.microsoft.com/en-us/documentation/samples/active-directory-dotnet-webapp-multitenant-openidconnect/)  
  
- [<span data-ttu-id="7df38-129">Build a multi-tenant SaaS web application that calls a web API using Azure AD</span><span class="sxs-lookup"><span data-stu-id="7df38-129">Build a multi-tenant SaaS web application that calls a web API using Azure AD</span></span>](https://azure.microsoft.com/en-us/documentation/samples/active-directory-webapp-webapi-multitenant-openidconnect-aspnetcore/)  
  
  <span data-ttu-id="7df38-130">Azure AD requires the following values to register your application:</span><span class="sxs-lookup"><span data-stu-id="7df38-130">Azure AD requires the following values to register your application:</span></span>  
  
|<span data-ttu-id="7df38-131">Value</span><span class="sxs-lookup"><span data-stu-id="7df38-131">Value</span></span>|<span data-ttu-id="7df38-132">Mô tả</span><span class="sxs-lookup"><span data-stu-id="7df38-132">Description</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="7df38-133">**Application ID URI**</span><span class="sxs-lookup"><span data-stu-id="7df38-133">**Application ID URI**</span></span>|<span data-ttu-id="7df38-134">The identifier for an application.</span><span class="sxs-lookup"><span data-stu-id="7df38-134">The identifier for an application.</span></span> <span data-ttu-id="7df38-135">This value is sent to Azure AD during authentication to indicate which application the caller wants a token for.</span><span class="sxs-lookup"><span data-stu-id="7df38-135">This value is sent to Azure AD during authentication to indicate which application the caller wants a token for.</span></span> <span data-ttu-id="7df38-136">Additionally, this value is included in the token so that the application knows it was the intended target.</span><span class="sxs-lookup"><span data-stu-id="7df38-136">Additionally, this value is included in the token so that the application knows it was the intended target.</span></span>|  
|<span data-ttu-id="7df38-137">**Reply URL and Redirect URI**</span><span class="sxs-lookup"><span data-stu-id="7df38-137">**Reply URL and Redirect URI**</span></span>|<span data-ttu-id="7df38-138">In the case of a web API or web application, the Reply URL is the location to which Azure AD will send the authentication response, including a token if authentication was successful.</span><span class="sxs-lookup"><span data-stu-id="7df38-138">In the case of a web API or web application, the Reply URL is the location to which Azure AD will send the authentication response, including a token if authentication was successful.</span></span>|  
|<span data-ttu-id="7df38-139">**Client ID**</span><span class="sxs-lookup"><span data-stu-id="7df38-139">**Client ID**</span></span>|<span data-ttu-id="7df38-140">The ID for an application, which is generated by Azure AD when the application is registered.</span><span class="sxs-lookup"><span data-stu-id="7df38-140">The ID for an application, which is generated by Azure AD when the application is registered.</span></span> <span data-ttu-id="7df38-141">When requesting an authorization code or token, the client ID and key are sent to Azure AD during authentication.</span><span class="sxs-lookup"><span data-stu-id="7df38-141">When requesting an authorization code or token, the client ID and key are sent to Azure AD during authentication.</span></span>|  
|<span data-ttu-id="7df38-142">**Key**</span><span class="sxs-lookup"><span data-stu-id="7df38-142">**Key**</span></span>|<span data-ttu-id="7df38-143">The key that is sent along with a client ID when authenticating to Azure AD to call a web API  .</span><span class="sxs-lookup"><span data-stu-id="7df38-143">The key that is sent along with a client ID when authenticating to Azure AD to call a web API  .</span></span>|  
  
 <span data-ttu-id="7df38-144">When the application is registered it will be assigned an **Azure Active Directory Object Id**, a unique identifier for the registered application.</span><span class="sxs-lookup"><span data-stu-id="7df38-144">When the application is registered it will be assigned an **Azure Active Directory Object Id**, a unique identifier for the registered application.</span></span>  
  
 <span data-ttu-id="7df38-145">If you create a new [!INCLUDE[pn_ASP.NET_short](../includes/pn-asp-net-short.md)] MVC application with [!INCLUDE[pn_visual_studio_2015](../includes/pn-visual-studio-2015.md)] you will have options to specify that the application will support the multi-tenant functionality.</span><span class="sxs-lookup"><span data-stu-id="7df38-145">If you create a new [!INCLUDE[pn_ASP.NET_short](../includes/pn-asp-net-short.md)] MVC application with [!INCLUDE[pn_visual_studio_2015](../includes/pn-visual-studio-2015.md)] you will have options to specify that the application will support the multi-tenant functionality.</span></span> <span data-ttu-id="7df38-146">The template for an MVC application provides the option to specify what kind of authentication occurs.</span><span class="sxs-lookup"><span data-stu-id="7df38-146">The template for an MVC application provides the option to specify what kind of authentication occurs.</span></span> <span data-ttu-id="7df38-147">You will have the option to choose the authentication method by configuring the properties of your project when you create it.</span><span class="sxs-lookup"><span data-stu-id="7df38-147">You will have the option to choose the authentication method by configuring the properties of your project when you create it.</span></span> <span data-ttu-id="7df38-148">The following diagram shows the options available:</span><span class="sxs-lookup"><span data-stu-id="7df38-148">The following diagram shows the options available:</span></span>  
  
 <span data-ttu-id="7df38-149">![ASP.NET  MVC Change Authentication Dialog](media/mvc-change-authentication-dialog.png "ASP.NET  MVC Change Authentication Dialog")</span><span class="sxs-lookup"><span data-stu-id="7df38-149">![ASP.NET  MVC Change Authentication Dialog](media/mvc-change-authentication-dialog.png "ASP.NET  MVC Change Authentication Dialog")</span></span>  
  
 <span data-ttu-id="7df38-150">When you configure a project with these options it will be configured to use OWIN middleware and scaffolding for a basic application that supports this scenario.</span><span class="sxs-lookup"><span data-stu-id="7df38-150">When you configure a project with these options it will be configured to use OWIN middleware and scaffolding for a basic application that supports this scenario.</span></span> <span data-ttu-id="7df38-151">With some basic modifications it can be adapted to work with [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)].</span><span class="sxs-lookup"><span data-stu-id="7df38-151">With some basic modifications it can be adapted to work with [!INCLUDE[pn_dyn_365_online](../includes/pn-crm-online.md)].</span></span> <span data-ttu-id="7df38-152">This is the approach demonstrated in [Walkthrough: Multi-tenant server-to-server authentication](walkthrough-multi-tenant-server-server-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="7df38-152">This is the approach demonstrated in [Walkthrough: Multi-tenant server-to-server authentication](walkthrough-multi-tenant-server-server-authentication.md).</span></span>  
  
 <span data-ttu-id="7df38-153">In the process of creating and registering your application for development you will most likely use `http://localhost` as the **Sign-on URL** and **Reply URL** values so you can test and debug your application locally before publishing.</span><span class="sxs-lookup"><span data-stu-id="7df38-153">In the process of creating and registering your application for development you will most likely use `http://localhost` as the **Sign-on URL** and **Reply URL** values so you can test and debug your application locally before publishing.</span></span> <span data-ttu-id="7df38-154">You will need to change these values before you publish your app.</span><span class="sxs-lookup"><span data-stu-id="7df38-154">You will need to change these values before you publish your app.</span></span>  
  
 <span data-ttu-id="7df38-155">When you register your app you must generate a key, also known as a `ClientSecret`.</span><span class="sxs-lookup"><span data-stu-id="7df38-155">When you register your app you must generate a key, also known as a `ClientSecret`.</span></span> <span data-ttu-id="7df38-156">These keys can be configured for a 1 or 2-year duration.</span><span class="sxs-lookup"><span data-stu-id="7df38-156">These keys can be configured for a 1 or 2-year duration.</span></span> <span data-ttu-id="7df38-157">As the host of the application you must treat this value like a password and it is your responsibility to manage renewal of the keys before they expire.</span><span class="sxs-lookup"><span data-stu-id="7df38-157">As the host of the application you must treat this value like a password and it is your responsibility to manage renewal of the keys before they expire.</span></span> <span data-ttu-id="7df38-158">You may want to use Key Vault.</span><span class="sxs-lookup"><span data-stu-id="7df38-158">You may want to use Key Vault.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="7df38-159">[https://azure.microsoft.com/en-us/services/key-vault/](https://azure.microsoft.com/en-us/services/key-vault/)</span><span class="sxs-lookup"><span data-stu-id="7df38-159">[https://azure.microsoft.com/en-us/services/key-vault/](https://azure.microsoft.com/en-us/services/key-vault/)</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7df38-160">When registering this application you do not need to grant your application rights to access Dynamics 365 for Customer Engagement (online) data as you usually do when creating a client application.</span><span class="sxs-lookup"><span data-stu-id="7df38-160">When registering this application you do not need to grant your application rights to access Dynamics 365 for Customer Engagement (online) data as you usually do when creating a client application.</span></span> <span data-ttu-id="7df38-161">This application is bound to a application user in the system.</span><span class="sxs-lookup"><span data-stu-id="7df38-161">This application is bound to a application user in the system.</span></span>
  
<a name="bkmk_CreateAppUser"></a>
   
## <a name="create-an-application-user--associated-with-the-registered-application--in-includepncrm2016shortestincludespn-crm-2016-shortestmd"></a><span data-ttu-id="7df38-162">Create an application user  associated with the registered application  in [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)]</span><span class="sxs-lookup"><span data-stu-id="7df38-162">Create an application user  associated with the registered application  in [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)]</span></span>  
 <span data-ttu-id="7df38-163">When your application accesses the [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] data of one of the subscribers of your application, it will require an application user in the subscriber’s [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] organization.</span><span class="sxs-lookup"><span data-stu-id="7df38-163">When your application accesses the [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] data of one of the subscribers of your application, it will require an application user in the subscriber’s [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] organization.</span></span> <span data-ttu-id="7df38-164">Like any [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] user, this application user must be associated with at least one security role which defines the data the user is able to access.</span><span class="sxs-lookup"><span data-stu-id="7df38-164">Like any [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] user, this application user must be associated with at least one security role which defines the data the user is able to access.</span></span>  
  
 <span data-ttu-id="7df38-165">The [SystemUser Entity](entities/systemuser.md) has three new attributes to store this data.</span><span class="sxs-lookup"><span data-stu-id="7df38-165">The [SystemUser Entity](entities/systemuser.md) has three new attributes to store this data.</span></span>  
  
|<span data-ttu-id="7df38-166">Tên Sơ đồ</span><span class="sxs-lookup"><span data-stu-id="7df38-166">Schema Name</span></span>|<span data-ttu-id="7df38-167">Tên Hiển thị</span><span class="sxs-lookup"><span data-stu-id="7df38-167">Display Name</span></span>|<span data-ttu-id="7df38-168">Loại</span><span class="sxs-lookup"><span data-stu-id="7df38-168">Type</span></span>|<span data-ttu-id="7df38-169">Mô tả</span><span class="sxs-lookup"><span data-stu-id="7df38-169">Description</span></span>|  
|-----------------|------------------|----------|-----------------|  
|[<span data-ttu-id="7df38-170">Id ứng dụng</span><span class="sxs-lookup"><span data-stu-id="7df38-170">ApplicationId</span></span>](entities/systemuser.md#BKMK_ApplicationId)|<span data-ttu-id="7df38-171">**Application ID**</span><span class="sxs-lookup"><span data-stu-id="7df38-171">**Application ID**</span></span>|<span data-ttu-id="7df38-172">UniqueidentifierType</span><span class="sxs-lookup"><span data-stu-id="7df38-172">UniqueidentifierType</span></span>|<span data-ttu-id="7df38-173">The identifier for the application.</span><span class="sxs-lookup"><span data-stu-id="7df38-173">The identifier for the application.</span></span> <span data-ttu-id="7df38-174">This is used to access data in another application.</span><span class="sxs-lookup"><span data-stu-id="7df38-174">This is used to access data in another application.</span></span>|  
|[<span data-ttu-id="7df38-175">ApplicationIdUri</span><span class="sxs-lookup"><span data-stu-id="7df38-175">ApplicationIdUri</span></span>](entities/systemuser.md#BKMK_ApplicationIdUri)|<span data-ttu-id="7df38-176">**Application ID URI**</span><span class="sxs-lookup"><span data-stu-id="7df38-176">**Application ID URI**</span></span>|<span data-ttu-id="7df38-177">StringType</span><span class="sxs-lookup"><span data-stu-id="7df38-177">StringType</span></span>|<span data-ttu-id="7df38-178">The URI used as a unique logical identifier for the external app.</span><span class="sxs-lookup"><span data-stu-id="7df38-178">The URI used as a unique logical identifier for the external app.</span></span> <span data-ttu-id="7df38-179">This can be used to validate the application</span><span class="sxs-lookup"><span data-stu-id="7df38-179">This can be used to validate the application</span></span>|  
|[<span data-ttu-id="7df38-180">AzureActiveDirectoryObjectId</span><span class="sxs-lookup"><span data-stu-id="7df38-180">AzureActiveDirectoryObjectId</span></span>](entities/systemuser.md#BKMK_AzureActiveDirectoryObjectId)|<span data-ttu-id="7df38-181">**Azure AD Object ID**</span><span class="sxs-lookup"><span data-stu-id="7df38-181">**Azure AD Object ID**</span></span>|<span data-ttu-id="7df38-182">UniqueidentifierType</span><span class="sxs-lookup"><span data-stu-id="7df38-182">UniqueidentifierType</span></span>|<span data-ttu-id="7df38-183">This is the application directory object Id.</span><span class="sxs-lookup"><span data-stu-id="7df38-183">This is the application directory object Id.</span></span>|  
  
 <span data-ttu-id="7df38-184">This `SystemUser.AzureActiveDirectoryObjectId` property value must be a reference to the Azure Active Directory Object Id of your registered application.</span><span class="sxs-lookup"><span data-stu-id="7df38-184">This `SystemUser.AzureActiveDirectoryObjectId` property value must be a reference to the Azure Active Directory Object Id of your registered application.</span></span> <span data-ttu-id="7df38-185">This reference will be set in [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] when the application user is created based on the `ApplicationId` value.</span><span class="sxs-lookup"><span data-stu-id="7df38-185">This reference will be set in [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] when the application user is created based on the `ApplicationId` value.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7df38-186">When you are initially developing your application with your own [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant and the Azure AD tenant associated with it, you can simply create the application user because the registered application is already part of your Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="7df38-186">When you are initially developing your application with your own [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant and the Azure AD tenant associated with it, you can simply create the application user because the registered application is already part of your Azure AD tenant.</span></span>  
> 
>  <span data-ttu-id="7df38-187">However, in order to create the application user in a different organization for testing, or whenever a subscriber will use your application, they must first grant consent for your application, so the steps in the process are different.</span><span class="sxs-lookup"><span data-stu-id="7df38-187">However, in order to create the application user in a different organization for testing, or whenever a subscriber will use your application, they must first grant consent for your application, so the steps in the process are different.</span></span> <span data-ttu-id="7df38-188">See [Test your application using a separate Dynamics 365 for Customer Engagement tenant](#bkmk_TestUsingSeparateTenant) for more information.</span><span class="sxs-lookup"><span data-stu-id="7df38-188">See [Test your application using a separate Dynamics 365 for Customer Engagement tenant](#bkmk_TestUsingSeparateTenant) for more information.</span></span>  
  
<a name="bkmk_CreateSecurityRole"></a>  
 
### <a name="create-a-security-role-for-the-application-user"></a><span data-ttu-id="7df38-189">Create a security role for the application user</span><span class="sxs-lookup"><span data-stu-id="7df38-189">Create a security role for the application user</span></span>  

 <span data-ttu-id="7df38-190">In the next step you will create a [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] application user.</span><span class="sxs-lookup"><span data-stu-id="7df38-190">In the next step you will create a [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] application user.</span></span> <span data-ttu-id="7df38-191">The privileges and access rights for this user will be defined by a custom security role you set.</span><span class="sxs-lookup"><span data-stu-id="7df38-191">The privileges and access rights for this user will be defined by a custom security role you set.</span></span> <span data-ttu-id="7df38-192">Before you create the application user, you must create a custom security role so you can associate the user to it.</span><span class="sxs-lookup"><span data-stu-id="7df38-192">Before you create the application user, you must create a custom security role so you can associate the user to it.</span></span> <span data-ttu-id="7df38-193">More information: [Create or edit a security role](https://technet.microsoft.com/library/dn531130.aspx)</span><span class="sxs-lookup"><span data-stu-id="7df38-193">More information: [Create or edit a security role](https://technet.microsoft.com/library/dn531130.aspx)</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7df38-194">The application user cannot be associated with one of the default [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] security roles.</span><span class="sxs-lookup"><span data-stu-id="7df38-194">The application user cannot be associated with one of the default [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] security roles.</span></span> <span data-ttu-id="7df38-195">You must create a custom security role to associate with the application user.</span><span class="sxs-lookup"><span data-stu-id="7df38-195">You must create a custom security role to associate with the application user.</span></span>  
  
<a name="bkmk_ManuallyCreateUser"></a>   

### <a name="manually-create-a-includepncrm2016shortestincludespn-crm-2016-shortestmd-application-user"></a><span data-ttu-id="7df38-196">Manually create a [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] application user</span><span class="sxs-lookup"><span data-stu-id="7df38-196">Manually create a [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] application user</span></span>  

 <span data-ttu-id="7df38-197">The procedure to create this user is different from creating a licensed user.</span><span class="sxs-lookup"><span data-stu-id="7df38-197">The procedure to create this user is different from creating a licensed user.</span></span> <span data-ttu-id="7df38-198">Use the following steps:</span><span class="sxs-lookup"><span data-stu-id="7df38-198">Use the following steps:</span></span>  
  
1. <span data-ttu-id="7df38-199">Navigate to **Settings** > **Security** > **Users**</span><span class="sxs-lookup"><span data-stu-id="7df38-199">Navigate to **Settings** > **Security** > **Users**</span></span>  
  
2. <span data-ttu-id="7df38-200">In the view drop-down, select **Application Users**.</span><span class="sxs-lookup"><span data-stu-id="7df38-200">In the view drop-down, select **Application Users**.</span></span>  
  
3. <span data-ttu-id="7df38-201">Bấm vào **Mới**.</span><span class="sxs-lookup"><span data-stu-id="7df38-201">Click **New**.</span></span> <span data-ttu-id="7df38-202">Then verify that you are using the **Application user** form.</span><span class="sxs-lookup"><span data-stu-id="7df38-202">Then verify that you are using the **Application user** form.</span></span>  
  
    <span data-ttu-id="7df38-203">If you do not see the **Application ID**, **Application ID URI** and **Azure AD Object ID** fields in the form, you must select the **Application User** form from the list:</span><span class="sxs-lookup"><span data-stu-id="7df38-203">If you do not see the **Application ID**, **Application ID URI** and **Azure AD Object ID** fields in the form, you must select the **Application User** form from the list:</span></span>  
  
   <span data-ttu-id="7df38-204">![Select Application User Form](media/select-application-user-form.PNG "Select Application User Form")</span><span class="sxs-lookup"><span data-stu-id="7df38-204">![Select Application User Form](media/select-application-user-form.PNG "Select Application User Form")</span></span>  
  
4. <span data-ttu-id="7df38-205">Add the appropriate values to the fields:</span><span class="sxs-lookup"><span data-stu-id="7df38-205">Add the appropriate values to the fields:</span></span>  
  
   |<span data-ttu-id="7df38-206">Trường</span><span class="sxs-lookup"><span data-stu-id="7df38-206">Field</span></span>|<span data-ttu-id="7df38-207">Value</span><span class="sxs-lookup"><span data-stu-id="7df38-207">Value</span></span>|  
   |-----------|-----------|  
   |<span data-ttu-id="7df38-208">**Application ID**</span><span class="sxs-lookup"><span data-stu-id="7df38-208">**Application ID**</span></span>|<span data-ttu-id="7df38-209">The Application ID value for the application registered with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7df38-209">The Application ID value for the application registered with Azure AD.</span></span>|  
   |<span data-ttu-id="7df38-210">**Họ tên**</span><span class="sxs-lookup"><span data-stu-id="7df38-210">**Full Name**</span></span>|<span data-ttu-id="7df38-211">The name of your application.</span><span class="sxs-lookup"><span data-stu-id="7df38-211">The name of your application.</span></span>|  
   |<span data-ttu-id="7df38-212">**Email Chính**</span><span class="sxs-lookup"><span data-stu-id="7df38-212">**Primary Email**</span></span>|<span data-ttu-id="7df38-213">The email address you want your subscribers to use to contact you.</span><span class="sxs-lookup"><span data-stu-id="7df38-213">The email address you want your subscribers to use to contact you.</span></span>|  
  
    <span data-ttu-id="7df38-214">The **User Name**, **Application ID URI** and **Azure AD Object ID** fields are locked and you cannot set values for these fields.</span><span class="sxs-lookup"><span data-stu-id="7df38-214">The **User Name**, **Application ID URI** and **Azure AD Object ID** fields are locked and you cannot set values for these fields.</span></span>  
  
    <span data-ttu-id="7df38-215">When you create this user the values for these fields will be retrieved from Azure AD based on the **Application ID** value when you save the user.</span><span class="sxs-lookup"><span data-stu-id="7df38-215">When you create this user the values for these fields will be retrieved from Azure AD based on the **Application ID** value when you save the user.</span></span>  
  
5. <span data-ttu-id="7df38-216">Associate the application user with the custom security role you created in [Create a security role for the application user](#bkmk_CreateSecurityRole).</span><span class="sxs-lookup"><span data-stu-id="7df38-216">Associate the application user with the custom security role you created in [Create a security role for the application user](#bkmk_CreateSecurityRole).</span></span> <span data-ttu-id="7df38-217">More information: [Create users in Dynamics 365 for Customer Engagement (online) and assign security roles](../admin/create-users-assign-online-security-roles.md)</span><span class="sxs-lookup"><span data-stu-id="7df38-217">More information: [Create users in Dynamics 365 for Customer Engagement (online) and assign security roles](../admin/create-users-assign-online-security-roles.md)</span></span>  
  
<a name="bkmk_TestUsingYourTenant"></a>  
 
## <a name="test-your-application-using-your-includepncrm2016shortestincludespn-crm-2016-shortestmd-tenant"></a><span data-ttu-id="7df38-218">Test your application using your [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant</span><span class="sxs-lookup"><span data-stu-id="7df38-218">Test your application using your [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant</span></span> 
 
 <span data-ttu-id="7df38-219">Because the application has been registered with your Azure AD tenant and the application user in your development organization is already configured, you can continue to develop your application against your own [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant.</span><span class="sxs-lookup"><span data-stu-id="7df38-219">Because the application has been registered with your Azure AD tenant and the application user in your development organization is already configured, you can continue to develop your application against your own [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant.</span></span> <span data-ttu-id="7df38-220">But this is not a valid test of the multi-tenant capability.</span><span class="sxs-lookup"><span data-stu-id="7df38-220">But this is not a valid test of the multi-tenant capability.</span></span> <span data-ttu-id="7df38-221">You need to test your application on a separate [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant.</span><span class="sxs-lookup"><span data-stu-id="7df38-221">You need to test your application on a separate [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant.</span></span>  
  
<a name="bkmk_TestUsingSeparateTenant"></a>   

## <a name="test-your-application-using-a-separate-includepncrm2016shortestincludespn-crm-2016-shortestmd-tenant"></a><span data-ttu-id="7df38-222">Test your application using a separate [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant</span><span class="sxs-lookup"><span data-stu-id="7df38-222">Test your application using a separate [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant</span></span>  

 <span data-ttu-id="7df38-223">Before you test your application with a separate [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant, an administrator for the Azure AD tenant must grant consent for the application.</span><span class="sxs-lookup"><span data-stu-id="7df38-223">Before you test your application with a separate [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant, an administrator for the Azure AD tenant must grant consent for the application.</span></span> <span data-ttu-id="7df38-224">The administrator grants consent by navigating to the application using a browser.</span><span class="sxs-lookup"><span data-stu-id="7df38-224">The administrator grants consent by navigating to the application using a browser.</span></span> <span data-ttu-id="7df38-225">The first time they access the application, they will see a dialog like this:</span><span class="sxs-lookup"><span data-stu-id="7df38-225">The first time they access the application, they will see a dialog like this:</span></span>  
  
 <span data-ttu-id="7df38-226">![Grant consent to access Dynamics 365 for Customer Engagement data](media/grant-consent-to-access-crm-data.PNG "Grant consent to access Dynamics 365 for Customer Engagement data")</span><span class="sxs-lookup"><span data-stu-id="7df38-226">![Grant consent to access Dynamics 365 for Customer Engagement data](media/grant-consent-to-access-crm-data.PNG "Grant consent to access Dynamics 365 for Customer Engagement data")</span></span>  
  
 <span data-ttu-id="7df38-227">When they grant consent, your registered application will be added to the  Azure AD Enterprise applications list and it is available to the users of the Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="7df38-227">When they grant consent, your registered application will be added to the  Azure AD Enterprise applications list and it is available to the users of the Azure AD tenant.</span></span>  
  
 <span data-ttu-id="7df38-228">Only after an administrator has granted consent, you must then create the application user in the subscriber’s [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant.</span><span class="sxs-lookup"><span data-stu-id="7df38-228">Only after an administrator has granted consent, you must then create the application user in the subscriber’s [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] tenant.</span></span> <span data-ttu-id="7df38-229">You can manually create the application user using the steps described in [Manually create a Dynamics 365 for Customer Engagement application user](#bkmk_ManuallyCreateUser).</span><span class="sxs-lookup"><span data-stu-id="7df38-229">You can manually create the application user using the steps described in [Manually create a Dynamics 365 for Customer Engagement application user](#bkmk_ManuallyCreateUser).</span></span>  
  
 <span data-ttu-id="7df38-230">For initial tests you may want to manually perform these steps.</span><span class="sxs-lookup"><span data-stu-id="7df38-230">For initial tests you may want to manually perform these steps.</span></span> <span data-ttu-id="7df38-231">When you are ready to make your application or service available to subscribers you will want to have a more efficient procedure.</span><span class="sxs-lookup"><span data-stu-id="7df38-231">When you are ready to make your application or service available to subscribers you will want to have a more efficient procedure.</span></span> <span data-ttu-id="7df38-232">This is covered in the next section.</span><span class="sxs-lookup"><span data-stu-id="7df38-232">This is covered in the next section.</span></span>  
  
<a name="bkmk_PrepareMethodToDeployAppUser"></a>
   
## <a name="prepare-a-method-to-deploy-the-application-user"></a><span data-ttu-id="7df38-233">Prepare a method to deploy the application user</span><span class="sxs-lookup"><span data-stu-id="7df38-233">Prepare a method to deploy the application user</span></span>  

 <span data-ttu-id="7df38-234">After subscribers grant consent to your application or service you will need an easy, reliable way for them to add the application user and any other required components to their [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] organization.</span><span class="sxs-lookup"><span data-stu-id="7df38-234">After subscribers grant consent to your application or service you will need an easy, reliable way for them to add the application user and any other required components to their [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] organization.</span></span>  
  
 <span data-ttu-id="7df38-235">You must include a custom security role which defines what privileges your application requires and then make sure that the application user is associated to that custom security role.</span><span class="sxs-lookup"><span data-stu-id="7df38-235">You must include a custom security role which defines what privileges your application requires and then make sure that the application user is associated to that custom security role.</span></span> <span data-ttu-id="7df38-236">Because a custom security role can be included in a solution, you should prepare a managed solution which contains the definition of the custom security role and any other solution components your application requires.</span><span class="sxs-lookup"><span data-stu-id="7df38-236">Because a custom security role can be included in a solution, you should prepare a managed solution which contains the definition of the custom security role and any other solution components your application requires.</span></span>  
  
 <span data-ttu-id="7df38-237">For information about creating custom security roles, see</span><span class="sxs-lookup"><span data-stu-id="7df38-237">For information about creating custom security roles, see</span></span>  
  
- [<span data-ttu-id="7df38-238">Tạo hoặc chỉnh sửa một vai trò bảo mật</span><span class="sxs-lookup"><span data-stu-id="7df38-238">Create or edit a security role</span></span>](../admin/create-edit-security-role.md)  
- [<span data-ttu-id="7df38-239">Sao chép vai trò bảo mật</span><span class="sxs-lookup"><span data-stu-id="7df38-239">Copy a security role</span></span>](../admin/copy-security-role.md)  
- [<span data-ttu-id="7df38-240">Thêm Thành phần giải pháp</span><span class="sxs-lookup"><span data-stu-id="7df38-240">Add solution components</span></span>](../customize/create-solution.md#add-solution-components)
  
 <span data-ttu-id="7df38-241">For information about creating a [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] solution, see the following topics:</span><span class="sxs-lookup"><span data-stu-id="7df38-241">For information about creating a [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] solution, see the following topics:</span></span>
  
- [<span data-ttu-id="7df38-242">Sử dụng các giải pháp cho các tùy chỉnh của bạn</span><span class="sxs-lookup"><span data-stu-id="7df38-242">Use solutions for your customizations</span></span>](../customize/use-solutions-for-your-customizations.md)  
- [<span data-ttu-id="7df38-243">Package and distribute extensions using solutions</span><span class="sxs-lookup"><span data-stu-id="7df38-243">Package and distribute extensions using solutions</span></span>](package-distribute-extensions-use-solutions.md)  
  
<span data-ttu-id="7df38-244">However, the application user cannot be included with a solution so you will need to provide a way to create this application user and associate it with the custom security role.</span><span class="sxs-lookup"><span data-stu-id="7df38-244">However, the application user cannot be included with a solution so you will need to provide a way to create this application user and associate it with the custom security role.</span></span>  

<span data-ttu-id="7df38-245">There are several ways that you can achieve this, including writing your own program using the [!INCLUDE[cc-dyn365-ce-web-services](../includes/cc-dyn365-ce-web-services.md)] and having the subscriber run the program.</span><span class="sxs-lookup"><span data-stu-id="7df38-245">There are several ways that you can achieve this, including writing your own program using the [!INCLUDE[cc-dyn365-ce-web-services](../includes/cc-dyn365-ce-web-services.md)] and having the subscriber run the program.</span></span>  

<span data-ttu-id="7df38-246">The [!INCLUDE[pn_package_deployer_short](../includes/pn-package-deployer-short.md)] is an application which can be used to prepare a package to automate transferring solutions and data to a different [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] organization.</span><span class="sxs-lookup"><span data-stu-id="7df38-246">The [!INCLUDE[pn_package_deployer_short](../includes/pn-package-deployer-short.md)] is an application which can be used to prepare a package to automate transferring solutions and data to a different [!INCLUDE[pn_crm_2016_shortest](../includes/pn-crm-2016-shortest.md)] organization.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="7df38-247">[Create packages for the Dynamics 365 for Customer Engagement Package Deployer](create-packages-package-deployer.md)</span><span class="sxs-lookup"><span data-stu-id="7df38-247">[Create packages for the Dynamics 365 for Customer Engagement Package Deployer](create-packages-package-deployer.md)</span></span>  
  
### <a name="see-also"></a><span data-ttu-id="7df38-248">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="7df38-248">See also</span></span>  
 <span data-ttu-id="7df38-249">[Walkthrough: Multi-tenant server-to-server authentication](walkthrough-multi-tenant-server-server-authentication.md) </span><span class="sxs-lookup"><span data-stu-id="7df38-249">[Walkthrough: Multi-tenant server-to-server authentication](walkthrough-multi-tenant-server-server-authentication.md) </span></span>  
 <span data-ttu-id="7df38-250">[Use Single-Tenant Server-to-server authentication](use-single-tenant-server-server-authentication.md) </span><span class="sxs-lookup"><span data-stu-id="7df38-250">[Use Single-Tenant Server-to-server authentication](use-single-tenant-server-server-authentication.md) </span></span>  
 <span data-ttu-id="7df38-251">[Build web applications using Server-to-Server (S2S) authentication](build-web-applications-server-server-s2s-authentication.md) </span><span class="sxs-lookup"><span data-stu-id="7df38-251">[Build web applications using Server-to-Server (S2S) authentication](build-web-applications-server-server-s2s-authentication.md) </span></span>  
 [<span data-ttu-id="7df38-252">Connect to Dynamics 365 for Customer Engagement apps</span><span class="sxs-lookup"><span data-stu-id="7df38-252">Connect to Dynamics 365 for Customer Engagement apps</span></span>](connect-customer-engagement.md)
