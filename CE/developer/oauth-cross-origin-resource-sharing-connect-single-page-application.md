---
title: Use OAuth with Cross-Origin Resource Sharing to connect a Single Page Application (Developer Guide for Dynamics 365 for Customer Engagement apps)| MicrosoftDocs
description: Learn how to use OAuth with Cross-Origin Resource Sharing to connect a Single Page Application to Dynamics 365 for Customer Engagement apps
ms.custom: ''
ms.date: 10/31/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: get-started-article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: oauth-cross-origin-resource-sharing-connect-single-page-application
caps.latest.revision: 11
author: JimDaly
ms.author: jdaly
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: f8746045ec707b0c8791463584ae78452e355d1c
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "388143"
---
# <a name="use-oauth-with-cross-origin-resource-sharing--to-connect-a-single-page-application--to-dynamics-365-for-customer-engagement-apps"></a><span data-ttu-id="c9d06-103">Use OAuth with Cross-Origin Resource Sharing  to connect a Single Page Application  to Dynamics 365 for Customer Engagement apps</span><span class="sxs-lookup"><span data-stu-id="c9d06-103">Use OAuth with Cross-Origin Resource Sharing  to connect a Single Page Application  to Dynamics 365 for Customer Engagement apps</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="c9d06-104">You can create a Single Page Apps (SPAs) which uses [!INCLUDE[pn_JavaScript](../includes/pn-javascript.md)] to work with [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps data.</span><span class="sxs-lookup"><span data-stu-id="c9d06-104">You can create a Single Page Apps (SPAs) which uses [!INCLUDE[pn_JavaScript](../includes/pn-javascript.md)] to work with [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps data.</span></span> <span data-ttu-id="c9d06-105">To provide this, Cross-Origin Resource Sharing (CORS) is enabled so that your SPAs can bypass browser restrictions that normally prevent requests that cross domain boundaries.</span><span class="sxs-lookup"><span data-stu-id="c9d06-105">To provide this, Cross-Origin Resource Sharing (CORS) is enabled so that your SPAs can bypass browser restrictions that normally prevent requests that cross domain boundaries.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c9d06-106">CORS support is only provided when using the Web API.</span><span class="sxs-lookup"><span data-stu-id="c9d06-106">CORS support is only provided when using the Web API.</span></span> <span data-ttu-id="c9d06-107">You cannot use the organization service or the deprecated organization data service.</span><span class="sxs-lookup"><span data-stu-id="c9d06-107">You cannot use the organization service or the deprecated organization data service.</span></span>  
  
<a name="bkmk_Spas_and_same_origin_policy"></a>   
## <a name="spas-and-same-origin-policy"></a><span data-ttu-id="c9d06-108">SPAs and Same-Origin policy</span><span class="sxs-lookup"><span data-stu-id="c9d06-108">SPAs and Same-Origin policy</span></span>  
 <span data-ttu-id="c9d06-109">SPAs depend on extensive use of client-side [!INCLUDE[pn_JavaScript](../includes/pn-javascript.md)] to create a single dynamic page which doesn't need to load new pages.</span><span class="sxs-lookup"><span data-stu-id="c9d06-109">SPAs depend on extensive use of client-side [!INCLUDE[pn_JavaScript](../includes/pn-javascript.md)] to create a single dynamic page which doesn't need to load new pages.</span></span> <span data-ttu-id="c9d06-110">Instead they use XMLHTTPRequests to retrieve data and other resources from the server.</span><span class="sxs-lookup"><span data-stu-id="c9d06-110">Instead they use XMLHTTPRequests to retrieve data and other resources from the server.</span></span> <span data-ttu-id="c9d06-111">SPAs work well when the data and resources exist in the same domain as the application.</span><span class="sxs-lookup"><span data-stu-id="c9d06-111">SPAs work well when the data and resources exist in the same domain as the application.</span></span> <span data-ttu-id="c9d06-112">But to protect access to data and resources on other domains, all modern browsers enforce a Same-Origin policy to prevent sites from using data and resources from sites on a different domain.</span><span class="sxs-lookup"><span data-stu-id="c9d06-112">But to protect access to data and resources on other domains, all modern browsers enforce a Same-Origin policy to prevent sites from using data and resources from sites on a different domain.</span></span> <span data-ttu-id="c9d06-113">CORS provides a way to gain access to resources on another domain.</span><span class="sxs-lookup"><span data-stu-id="c9d06-113">CORS provides a way to gain access to resources on another domain.</span></span> <span data-ttu-id="c9d06-114">Creating a SPA to access [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps data without CORS is not a viable option.</span><span class="sxs-lookup"><span data-stu-id="c9d06-114">Creating a SPA to access [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps data without CORS is not a viable option.</span></span>  
  
<a name="bkmk_use_cors"></a>   
## <a name="use-cors-with-includepndynamicscrmonlineincludespn-dynamics-crm-onlinemd-apps"></a><span data-ttu-id="c9d06-115">Use CORS with [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps</span><span class="sxs-lookup"><span data-stu-id="c9d06-115">Use CORS with [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps</span></span>
 <span data-ttu-id="c9d06-116">The [Cross-Origin Resource Sharing specification](http://www.w3.org/TR/cors/) provides a detailed description of how to implement and use CORS.</span><span class="sxs-lookup"><span data-stu-id="c9d06-116">The [Cross-Origin Resource Sharing specification](http://www.w3.org/TR/cors/) provides a detailed description of how to implement and use CORS.</span></span> <span data-ttu-id="c9d06-117">It explains all about the various headers and preflight requests that you need to apply to make CORS work.</span><span class="sxs-lookup"><span data-stu-id="c9d06-117">It explains all about the various headers and preflight requests that you need to apply to make CORS work.</span></span> <span data-ttu-id="c9d06-118">The good news is that you don't need to become an expert in CORS to use it with [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps.</span><span class="sxs-lookup"><span data-stu-id="c9d06-118">The good news is that you don't need to become an expert in CORS to use it with [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps.</span></span> <span data-ttu-id="c9d06-119">The server-side part has been done for you and all you need is to know how to consume it.</span><span class="sxs-lookup"><span data-stu-id="c9d06-119">The server-side part has been done for you and all you need is to know how to consume it.</span></span>  <span data-ttu-id="c9d06-120">You don't need to understand all the inner workings of CORS to use it with [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps.</span><span class="sxs-lookup"><span data-stu-id="c9d06-120">You don't need to understand all the inner workings of CORS to use it with [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps.</span></span> <span data-ttu-id="c9d06-121">Instead you can use the [Azure Active Directory Authentication Library for JavaScript](https://github.com/AzureAD/azure-activedirectory-library-for-js) (adal.js) and it will take care of much of the CORS complexity for you.</span><span class="sxs-lookup"><span data-stu-id="c9d06-121">Instead you can use the [Azure Active Directory Authentication Library for JavaScript](https://github.com/AzureAD/azure-activedirectory-library-for-js) (adal.js) and it will take care of much of the CORS complexity for you.</span></span> <span data-ttu-id="c9d06-122">Since [!INCLUDE[pn_crm_online_shortest](../includes/pn-crm-online-shortest.md)] and Internet-facing deployment (IFD) users are authenticated using Azure Active Directory, ADAL.js is the supported way to authenticate SPA users.</span><span class="sxs-lookup"><span data-stu-id="c9d06-122">Since [!INCLUDE[pn_crm_online_shortest](../includes/pn-crm-online-shortest.md)] and Internet-facing deployment (IFD) users are authenticated using Azure Active Directory, ADAL.js is the supported way to authenticate SPA users.</span></span>  
  
<a name="bkmk_how_adaljs_works"></a>   
## <a name="how-adaljs-works"></a><span data-ttu-id="c9d06-123">How adal.js works</span><span class="sxs-lookup"><span data-stu-id="c9d06-123">How adal.js works</span></span>  
 <span data-ttu-id="c9d06-124">The core library is `adal.js`.</span><span class="sxs-lookup"><span data-stu-id="c9d06-124">The core library is `adal.js`.</span></span> <span data-ttu-id="c9d06-125">You can access the minimized version of this library at [https://secure.aadcdn.microsoftonline-p.com/lib/1.0.0/js/adal.min.js](https://secure.aadcdn.microsoftonline-p.com/lib/1.0.0/js/adal.min.js).</span><span class="sxs-lookup"><span data-stu-id="c9d06-125">You can access the minimized version of this library at [https://secure.aadcdn.microsoftonline-p.com/lib/1.0.0/js/adal.min.js](https://secure.aadcdn.microsoftonline-p.com/lib/1.0.0/js/adal.min.js).</span></span> <span data-ttu-id="c9d06-126">The Github project and documentation is at [https://github.com/AzureAD/azure-activedirectory-library-for-js](https://github.com/AzureAD/azure-activedirectory-library-for-js).</span><span class="sxs-lookup"><span data-stu-id="c9d06-126">The Github project and documentation is at [https://github.com/AzureAD/azure-activedirectory-library-for-js](https://github.com/AzureAD/azure-activedirectory-library-for-js).</span></span>  
  
 <span data-ttu-id="c9d06-127">The adal.js library contains the low-level capabilities to authenticate using OAuth2.</span><span class="sxs-lookup"><span data-stu-id="c9d06-127">The adal.js library contains the low-level capabilities to authenticate using OAuth2.</span></span> <span data-ttu-id="c9d06-128">Adal.js is designed so that it can be used with other frameworks, for example there is an `adal-angular.js` library that is designed to be used with the Angular framework.The way you work with this library is to set certain configuration properties and then it will wait until events occur that trigger the interaction flow.</span><span class="sxs-lookup"><span data-stu-id="c9d06-128">Adal.js is designed so that it can be used with other frameworks, for example there is an `adal-angular.js` library that is designed to be used with the Angular framework.The way you work with this library is to set certain configuration properties and then it will wait until events occur that trigger the interaction flow.</span></span> <span data-ttu-id="c9d06-129">This could be simply calling the `login` function or if your application has routing behaviors, the authentication can be initiated by how the controller for that route is configured.</span><span class="sxs-lookup"><span data-stu-id="c9d06-129">This could be simply calling the `login` function or if your application has routing behaviors, the authentication can be initiated by how the controller for that route is configured.</span></span>  
  
 <span data-ttu-id="c9d06-130">When authentication is required, the user is taken to the sign-in page where they can enter their credentials.</span><span class="sxs-lookup"><span data-stu-id="c9d06-130">When authentication is required, the user is taken to the sign-in page where they can enter their credentials.</span></span> <span data-ttu-id="c9d06-131">After they successfully authenticate, they are re-directed back to the calling page with the token information attached as a fragment (using #) to the URL.</span><span class="sxs-lookup"><span data-stu-id="c9d06-131">After they successfully authenticate, they are re-directed back to the calling page with the token information attached as a fragment (using #) to the URL.</span></span> <span data-ttu-id="c9d06-132">This allows the SPA to acquire the token and cache it in local or session storage in the browser.</span><span class="sxs-lookup"><span data-stu-id="c9d06-132">This allows the SPA to acquire the token and cache it in local or session storage in the browser.</span></span> <span data-ttu-id="c9d06-133">This means that the entire page is re-loaded after authentication, but this time the information about the authorized user is available and the application can proceed to make calls the Dynamics 365 for Customer Engagement Web API or other resources.</span><span class="sxs-lookup"><span data-stu-id="c9d06-133">This means that the entire page is re-loaded after authentication, but this time the information about the authorized user is available and the application can proceed to make calls the Dynamics 365 for Customer Engagement Web API or other resources.</span></span>  
  
 <span data-ttu-id="c9d06-134">When calling the Dynamics 365 for Customer Engagement Web API, you must include the token value in an Authorization header with your XMLHTPPRequest.</span><span class="sxs-lookup"><span data-stu-id="c9d06-134">When calling the Dynamics 365 for Customer Engagement Web API, you must include the token value in an Authorization header with your XMLHTPPRequest.</span></span> <span data-ttu-id="c9d06-135">However, because tokens have an expiration you want to be sure that it doesn't expire while people are using your SPA.</span><span class="sxs-lookup"><span data-stu-id="c9d06-135">However, because tokens have an expiration you want to be sure that it doesn't expire while people are using your SPA.</span></span> <span data-ttu-id="c9d06-136">Remember, entering new credentials requires that the entire content of your SPA page is transferred to the sign-in page.</span><span class="sxs-lookup"><span data-stu-id="c9d06-136">Remember, entering new credentials requires that the entire content of your SPA page is transferred to the sign-in page.</span></span> <span data-ttu-id="c9d06-137">This would cause a very bad user experience if it were to happen while people are in the middle of doing something.</span><span class="sxs-lookup"><span data-stu-id="c9d06-137">This would cause a very bad user experience if it were to happen while people are in the middle of doing something.</span></span> <span data-ttu-id="c9d06-138">In order to ensure this doesn't happen, you wrap your Web API calls within an `acquireToken` function so that the validity of the token can be checked and refreshed if necessary without taking the user to a sign-in page.</span><span class="sxs-lookup"><span data-stu-id="c9d06-138">In order to ensure this doesn't happen, you wrap your Web API calls within an `acquireToken` function so that the validity of the token can be checked and refreshed if necessary without taking the user to a sign-in page.</span></span>  
  
<a name="bkmk_preparing_to_use_adaljs"></a>   
## <a name="preparing-to-use-adaljs-with-a-spa"></a><span data-ttu-id="c9d06-139">Preparing to use ADAL.js with a SPA</span><span class="sxs-lookup"><span data-stu-id="c9d06-139">Preparing to use ADAL.js with a SPA</span></span>  
 <span data-ttu-id="c9d06-140">In order to configure your SPA to work with adal.js you will need to :</span><span class="sxs-lookup"><span data-stu-id="c9d06-140">In order to configure your SPA to work with adal.js you will need to :</span></span>  
  
1. <span data-ttu-id="c9d06-141">Register your application with the Azure Active Directory tenant</span><span class="sxs-lookup"><span data-stu-id="c9d06-141">Register your application with the Azure Active Directory tenant</span></span>  
  
2. <span data-ttu-id="c9d06-142">Export your registered application manifest and edit it to allow OAuth2 Implicit Flow, and then import the JSON file back to your application registration.</span><span class="sxs-lookup"><span data-stu-id="c9d06-142">Export your registered application manifest and edit it to allow OAuth2 Implicit Flow, and then import the JSON file back to your application registration.</span></span>  
  
3. <span data-ttu-id="c9d06-143">Set configuration variables in your SPA with information from that registration.</span><span class="sxs-lookup"><span data-stu-id="c9d06-143">Set configuration variables in your SPA with information from that registration.</span></span>  
  
    <span data-ttu-id="c9d06-144">You will need to include the following:</span><span class="sxs-lookup"><span data-stu-id="c9d06-144">You will need to include the following:</span></span>  
  
   - <span data-ttu-id="c9d06-145">The URL to your [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps organization</span><span class="sxs-lookup"><span data-stu-id="c9d06-145">The URL to your [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps organization</span></span>  
  
   - <span data-ttu-id="c9d06-146">The name of the Active Directory tenant your organization uses to authenticate</span><span class="sxs-lookup"><span data-stu-id="c9d06-146">The name of the Active Directory tenant your organization uses to authenticate</span></span>  
  
   - <span data-ttu-id="c9d06-147">The client ID you get when you register your application</span><span class="sxs-lookup"><span data-stu-id="c9d06-147">The client ID you get when you register your application</span></span>  
  
   - <span data-ttu-id="c9d06-148">The URL to where the SPA will be deployed or debugged during development</span><span class="sxs-lookup"><span data-stu-id="c9d06-148">The URL to where the SPA will be deployed or debugged during development</span></span>  
  
   <span data-ttu-id="c9d06-149">The set of steps required are described in [Walkthrough: Registering and configuring SimpleSPA application with adal.js](walkthrough-registering-configuring-simplespa-application-adal-js.md).</span><span class="sxs-lookup"><span data-stu-id="c9d06-149">The set of steps required are described in [Walkthrough: Registering and configuring SimpleSPA application with adal.js](walkthrough-registering-configuring-simplespa-application-adal-js.md).</span></span>  
  
### <a name="see-also"></a><span data-ttu-id="c9d06-150">Xem thÃªm</span><span class="sxs-lookup"><span data-stu-id="c9d06-150">See also</span></span>  
 <span data-ttu-id="c9d06-151">[Authenticate users in Dynamics 365 for Customer Engagement apps](authenticate-users.md) </span><span class="sxs-lookup"><span data-stu-id="c9d06-151">[Authenticate users in Dynamics 365 for Customer Engagement apps](authenticate-users.md) </span></span>  
 <span data-ttu-id="c9d06-152">[Use OAuth to connect to Dynamics 365 for Customer Engagement web Services](connect-customer-engagement-web-services-using-oauth.md) </span><span class="sxs-lookup"><span data-stu-id="c9d06-152">[Use OAuth to connect to Dynamics 365 for Customer Engagement web Services](connect-customer-engagement-web-services-using-oauth.md) </span></span>  
 [<span data-ttu-id="c9d06-153">Active Directory and Claims-Based Authentication</span><span class="sxs-lookup"><span data-stu-id="c9d06-153">Active Directory and Claims-Based Authentication</span></span>](active-directory-claims-based-authentication.md)
