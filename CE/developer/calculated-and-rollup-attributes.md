---
title: Calculated and rollup attributes (Developer Guide for Dynamics 365 for Customer Engagement) | MicrosoftDocs
ms.custom: ''
ms.date: 10/31/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: 26ada6f7-3e22-465c-90f8-19d326785eb4
caps.latest.revision: 22
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 4b39f6e58c373587410ce728720bb12bdd6987a7
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "385963"
---
# <a name="calculated-and-rollup-attributes"></a><span data-ttu-id="a002a-102">Calculated and rollup attributes</span><span class="sxs-lookup"><span data-stu-id="a002a-102">Calculated and rollup attributes</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="a002a-103">*Calculated* and *rollup* attributes free the user from having to manually perform calculations and focus on their work.</span><span class="sxs-lookup"><span data-stu-id="a002a-103">*Calculated* and *rollup* attributes free the user from having to manually perform calculations and focus on their work.</span></span> <span data-ttu-id="a002a-104">System administrators can now easily define a field to contain the value of many common calculations without having to work with a developer.</span><span class="sxs-lookup"><span data-stu-id="a002a-104">System administrators can now easily define a field to contain the value of many common calculations without having to work with a developer.</span></span> <span data-ttu-id="a002a-105">Developers can also leverage the platform capabilities to perform these calculations rather than within their own code.</span><span class="sxs-lookup"><span data-stu-id="a002a-105">Developers can also leverage the platform capabilities to perform these calculations rather than within their own code.</span></span>  
  
 [<span data-ttu-id="a002a-106">Video: Rollup and Calculated Fields in Microsoft Dynamics CRM 2015</span><span class="sxs-lookup"><span data-stu-id="a002a-106">Video: Rollup and Calculated Fields in Microsoft Dynamics CRM 2015</span></span>](http://youtu.be/RoahCH1p3T8)  
  
<a name="BKMK_CommonElements"></a>   
## <a name="common-elements-and-characteristics"></a><span data-ttu-id="a002a-107">Common elements and characteristics</span><span class="sxs-lookup"><span data-stu-id="a002a-107">Common elements and characteristics</span></span>  
 <span data-ttu-id="a002a-108">Calculated and rollup attributes share some common elements and characteristics, for example:</span><span class="sxs-lookup"><span data-stu-id="a002a-108">Calculated and rollup attributes share some common elements and characteristics, for example:</span></span>  
  
- <span data-ttu-id="a002a-109">They’re read-only.</span><span class="sxs-lookup"><span data-stu-id="a002a-109">They’re read-only.</span></span>  
  
- <span data-ttu-id="a002a-110">They’re not specific to the user.</span><span class="sxs-lookup"><span data-stu-id="a002a-110">They’re not specific to the user.</span></span> <span data-ttu-id="a002a-111">The calculation is performed using a system user account, so the values may be based on records that the user doesn’t otherwise have privileges to view, such as attributes that have field-level security enabled.</span><span class="sxs-lookup"><span data-stu-id="a002a-111">The calculation is performed using a system user account, so the values may be based on records that the user doesn’t otherwise have privileges to view, such as attributes that have field-level security enabled.</span></span>  
  
  <span data-ttu-id="a002a-112">All attributes that inherit from <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata> have a <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.SourceType> property that can contain the values shown in the following table.</span><span class="sxs-lookup"><span data-stu-id="a002a-112">All attributes that inherit from <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata> have a <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.SourceType> property that can contain the values shown in the following table.</span></span>  
  
|                 <span data-ttu-id="a002a-113">Value</span><span class="sxs-lookup"><span data-stu-id="a002a-113">Value</span></span>                 |                                    <span data-ttu-id="a002a-114">Mô tả</span><span class="sxs-lookup"><span data-stu-id="a002a-114">Description</span></span>                                     |
|---------------------------------------|------------------------------------------------------------------------------------|
| [!INCLUDE[null](../includes/null.md)] |       <span data-ttu-id="a002a-115">Not a valid type of attribute to be a calculated or rollup attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-115">Not a valid type of attribute to be a calculated or rollup attribute.</span></span>        |
|                   <span data-ttu-id="a002a-116">0</span><span class="sxs-lookup"><span data-stu-id="a002a-116">0</span></span>                   | <span data-ttu-id="a002a-117">Simple attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-117">Simple attribute.</span></span> <span data-ttu-id="a002a-118">The attribute isn’t defined as a calculated or rollup attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-118">The attribute isn’t defined as a calculated or rollup attribute.</span></span> |
|                   <span data-ttu-id="a002a-119">1</span><span class="sxs-lookup"><span data-stu-id="a002a-119">1</span></span>                   |                                <span data-ttu-id="a002a-120">Calculated attribute</span><span class="sxs-lookup"><span data-stu-id="a002a-120">Calculated attribute</span></span>                                |
|                   <span data-ttu-id="a002a-121">2</span><span class="sxs-lookup"><span data-stu-id="a002a-121">2</span></span>                   |                                  <span data-ttu-id="a002a-122">Rollup attribute</span><span class="sxs-lookup"><span data-stu-id="a002a-122">Rollup attribute</span></span>                                  |
  
 <span data-ttu-id="a002a-123">Calculated and rollup attributes are based on existing attribute types that inherit from <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata>.</span><span class="sxs-lookup"><span data-stu-id="a002a-123">Calculated and rollup attributes are based on existing attribute types that inherit from <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata>.</span></span> <span data-ttu-id="a002a-124">The following types of attributes have new properties:</span><span class="sxs-lookup"><span data-stu-id="a002a-124">The following types of attributes have new properties:</span></span>  
  
- <xref:Microsoft.Xrm.Sdk.Metadata.BooleanAttributeMetadata>  
  
- <xref:Microsoft.Xrm.Sdk.Metadata.DateTimeAttributeMetadata>  
  
- <xref:Microsoft.Xrm.Sdk.Metadata.DecimalAttributeMetadata>  
  
- <xref:Microsoft.Xrm.Sdk.Metadata.IntegerAttributeMetadata>  
  
- <xref:Microsoft.Xrm.Sdk.Metadata.MoneyAttributeMetadata>  
  
- <xref:Microsoft.Xrm.Sdk.Metadata.PicklistAttributeMetadata>  
  
- <xref:Microsoft.Xrm.Sdk.Metadata.StringAttributeMetadata>  
  
  <span data-ttu-id="a002a-125">Each of these types of attributes have the following properties to support calculations and rollups.</span><span class="sxs-lookup"><span data-stu-id="a002a-125">Each of these types of attributes have the following properties to support calculations and rollups.</span></span>  
  
|      <span data-ttu-id="a002a-126">Thuộc tính</span><span class="sxs-lookup"><span data-stu-id="a002a-126">Property</span></span>       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <span data-ttu-id="a002a-127">Định nghĩa</span><span class="sxs-lookup"><span data-stu-id="a002a-127">Definition</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `FormulaDefinition` |                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <span data-ttu-id="a002a-128">Contains the XAML definition of the formula used to perform the calculation or rollup.</span><span class="sxs-lookup"><span data-stu-id="a002a-128">Contains the XAML definition of the formula used to perform the calculation or rollup.</span></span> <span data-ttu-id="a002a-129">The only supported way to change this value is through the application formula editor.</span><span class="sxs-lookup"><span data-stu-id="a002a-129">The only supported way to change this value is through the application formula editor.</span></span><br /><br /> <span data-ttu-id="a002a-130">For information about configuring the formulas for these attributes see the following topics in the customization guide: [Define rollup fields](https://technet.microsoft.com/library/dn832162.aspx) and [Define calculated fields](https://technet.microsoft.com/library/dn832103.aspx).</span><span class="sxs-lookup"><span data-stu-id="a002a-130">For information about configuring the formulas for these attributes see the following topics in the customization guide: [Define rollup fields](https://technet.microsoft.com/library/dn832162.aspx) and [Define calculated fields](https://technet.microsoft.com/library/dn832103.aspx).</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|  `SourceTypeMask`   | <span data-ttu-id="a002a-131">The bitmask value of this read-only property describes the types of sources used in the formula of the calculated attribute or if the formula of a calculated or rollup attribute is not valid.</span><span class="sxs-lookup"><span data-stu-id="a002a-131">The bitmask value of this read-only property describes the types of sources used in the formula of the calculated attribute or if the formula of a calculated or rollup attribute is not valid.</span></span><br /><br /> <span data-ttu-id="a002a-132">-   0: **Undefined**.</span><span class="sxs-lookup"><span data-stu-id="a002a-132">-   0: **Undefined**.</span></span> <span data-ttu-id="a002a-133">The default value for simple and rollup attributes.</span><span class="sxs-lookup"><span data-stu-id="a002a-133">The default value for simple and rollup attributes.</span></span><br /><span data-ttu-id="a002a-134">-   1: **Simple**.</span><span class="sxs-lookup"><span data-stu-id="a002a-134">-   1: **Simple**.</span></span> <span data-ttu-id="a002a-135">The calculated attribute refers to an attribute in the same record.</span><span class="sxs-lookup"><span data-stu-id="a002a-135">The calculated attribute refers to an attribute in the same record.</span></span><br /><span data-ttu-id="a002a-136">-   2: **Related**.</span><span class="sxs-lookup"><span data-stu-id="a002a-136">-   2: **Related**.</span></span> <span data-ttu-id="a002a-137">The calculated attribute refers to an attribute in a related record.</span><span class="sxs-lookup"><span data-stu-id="a002a-137">The calculated attribute refers to an attribute in a related record.</span></span><br /><span data-ttu-id="a002a-138">-   4: `Logical`.</span><span class="sxs-lookup"><span data-stu-id="a002a-138">-   4: `Logical`.</span></span> <span data-ttu-id="a002a-139">The calculated attribute refers to an attribute in the same record which is actually stored in a different database table.</span><span class="sxs-lookup"><span data-stu-id="a002a-139">The calculated attribute refers to an attribute in the same record which is actually stored in a different database table.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="a002a-140">[Logical attributes](introduction-entity-attributes.md#BKMK_LogicalAttributes)</span><span class="sxs-lookup"><span data-stu-id="a002a-140">[Logical attributes](introduction-entity-attributes.md#BKMK_LogicalAttributes)</span></span><br /><span data-ttu-id="a002a-141">-   8: `Calculated`.</span><span class="sxs-lookup"><span data-stu-id="a002a-141">-   8: `Calculated`.</span></span> <span data-ttu-id="a002a-142">The calculated attribute refers to another calculated attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-142">The calculated attribute refers to another calculated attribute.</span></span><br /><span data-ttu-id="a002a-143">-   16: `Rollup`.</span><span class="sxs-lookup"><span data-stu-id="a002a-143">-   16: `Rollup`.</span></span> <span data-ttu-id="a002a-144">The calculated attribute refers a rollup attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-144">The calculated attribute refers a rollup attribute.</span></span><br /><span data-ttu-id="a002a-145">-   32: `Invalid`.</span><span class="sxs-lookup"><span data-stu-id="a002a-145">-   32: `Invalid`.</span></span> <span data-ttu-id="a002a-146">The calculated or rollup field is invalid.</span><span class="sxs-lookup"><span data-stu-id="a002a-146">The calculated or rollup field is invalid.</span></span><br />     <span data-ttu-id="a002a-147">Typically this would be where a field refers to an attribute that no longer exists.</span><span class="sxs-lookup"><span data-stu-id="a002a-147">Typically this would be where a field refers to an attribute that no longer exists.</span></span> <span data-ttu-id="a002a-148">**Note:**  One or more of these conditions may be true for any calculated or rollup field.</span><span class="sxs-lookup"><span data-stu-id="a002a-148">**Note:**  One or more of these conditions may be true for any calculated or rollup field.</span></span> <span data-ttu-id="a002a-149">Because this is a bitmask value, you may find it useful to use the [SourceTypeMasks enumeration](calculated-rollup-attributes.md#BKMK_SourceTypeMasks) when performing bitwise operations.</span><span class="sxs-lookup"><span data-stu-id="a002a-149">Because this is a bitmask value, you may find it useful to use the [SourceTypeMasks enumeration](calculated-rollup-attributes.md#BKMK_SourceTypeMasks) when performing bitwise operations.</span></span> |
  
<a name="BKMK_Calculated"></a>   
## <a name="calculated-attributes"></a><span data-ttu-id="a002a-150">Calculated attributes</span><span class="sxs-lookup"><span data-stu-id="a002a-150">Calculated attributes</span></span>  
 <span data-ttu-id="a002a-151">Calculated attributes are calculated in real-time when they are retrieved.</span><span class="sxs-lookup"><span data-stu-id="a002a-151">Calculated attributes are calculated in real-time when they are retrieved.</span></span> <span data-ttu-id="a002a-152">Calculated attributes can be composed using different data types.</span><span class="sxs-lookup"><span data-stu-id="a002a-152">Calculated attributes can be composed using different data types.</span></span> <span data-ttu-id="a002a-153">For example, an Integer calculated attribute may reference values from Decimal or Currency attributes.</span><span class="sxs-lookup"><span data-stu-id="a002a-153">For example, an Integer calculated attribute may reference values from Decimal or Currency attributes.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="a002a-154">[Define calculated fields](https://technet.microsoft.com/library/dn832103.aspx).</span><span class="sxs-lookup"><span data-stu-id="a002a-154">[Define calculated fields](https://technet.microsoft.com/library/dn832103.aspx).</span></span>  
  
 <span data-ttu-id="a002a-155">Calculated attribute values are available in the retrieve plug-in pipeline.</span><span class="sxs-lookup"><span data-stu-id="a002a-155">Calculated attribute values are available in the retrieve plug-in pipeline.</span></span> <span data-ttu-id="a002a-156">Post image of entity record update or create contains the calculated attribute value in stage 40.</span><span class="sxs-lookup"><span data-stu-id="a002a-156">Post image of entity record update or create contains the calculated attribute value in stage 40.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="a002a-157">[Event Execution Pipeline](event-execution-pipeline.md)</span><span class="sxs-lookup"><span data-stu-id="a002a-157">[Event Execution Pipeline](event-execution-pipeline.md)</span></span>  
  
### <a name="limitations"></a><span data-ttu-id="a002a-158">Giới hạn</span><span class="sxs-lookup"><span data-stu-id="a002a-158">Limitations</span></span>  
 <span data-ttu-id="a002a-159">You can’t use values in calculated attributes that reference a related entity, another calculated attribute, or a *logical value* in the same entity to sort data returned by a query.</span><span class="sxs-lookup"><span data-stu-id="a002a-159">You can’t use values in calculated attributes that reference a related entity, another calculated attribute, or a *logical value* in the same entity to sort data returned by a query.</span></span> <span data-ttu-id="a002a-160">Although your query can specify that the results should be ordered using a calculated attribute, the sort direction will be ignored and will not throw an error.</span><span class="sxs-lookup"><span data-stu-id="a002a-160">Although your query can specify that the results should be ordered using a calculated attribute, the sort direction will be ignored and will not throw an error.</span></span> <span data-ttu-id="a002a-161">If the calculated attribute references only simple values in the same record, sorting works normally.</span><span class="sxs-lookup"><span data-stu-id="a002a-161">If the calculated attribute references only simple values in the same record, sorting works normally.</span></span> <span data-ttu-id="a002a-162">You can determine the sources used in a calculated field using the `SourceTypeMask` property on the attribute metadata.</span><span class="sxs-lookup"><span data-stu-id="a002a-162">You can determine the sources used in a calculated field using the `SourceTypeMask` property on the attribute metadata.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="a002a-163">[Logical attributes](introduction-entity-attributes.md#BKMK_LogicalAttributes)</span><span class="sxs-lookup"><span data-stu-id="a002a-163">[Logical attributes](introduction-entity-attributes.md#BKMK_LogicalAttributes)</span></span>  
  
 <span data-ttu-id="a002a-164">Only attributes from an immediate parent entity can be used in a calculated attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-164">Only attributes from an immediate parent entity can be used in a calculated attribute.</span></span>  
  
 <span data-ttu-id="a002a-165">Saved queries, charts, and visualizations can have a maximum of 10 unique calculated attributes.</span><span class="sxs-lookup"><span data-stu-id="a002a-165">Saved queries, charts, and visualizations can have a maximum of 10 unique calculated attributes.</span></span>  
  
 <span data-ttu-id="a002a-166">Calculated attributes can reference other calculated attributes in their formula, but they can’t reference themselves.</span><span class="sxs-lookup"><span data-stu-id="a002a-166">Calculated attributes can reference other calculated attributes in their formula, but they can’t reference themselves.</span></span>  
  
 <span data-ttu-id="a002a-167">Calculated attributes don’t have values when a user with [!INCLUDE[pn_crm_for_outlook_full](../includes/pn-crm-for-outlook-full.md)] is offline.</span><span class="sxs-lookup"><span data-stu-id="a002a-167">Calculated attributes don’t have values when a user with [!INCLUDE[pn_crm_for_outlook_full](../includes/pn-crm-for-outlook-full.md)] is offline.</span></span>  
  
 <span data-ttu-id="a002a-168">`MaxValue` and `MinValue` metadata properties can’t be set on calculated attributes</span><span class="sxs-lookup"><span data-stu-id="a002a-168">`MaxValue` and `MinValue` metadata properties can’t be set on calculated attributes</span></span>  
  
<a name="BKMK_Rollup"></a>   
## <a name="rollup-attributes"></a><span data-ttu-id="a002a-169">Rollup attributes</span><span class="sxs-lookup"><span data-stu-id="a002a-169">Rollup attributes</span></span>  
 <span data-ttu-id="a002a-170">Because rollup attributes persist in the database, they can be used for filtering or sorting just like regular attributes.</span><span class="sxs-lookup"><span data-stu-id="a002a-170">Because rollup attributes persist in the database, they can be used for filtering or sorting just like regular attributes.</span></span> <span data-ttu-id="a002a-171">Any kind of process or plug-in will use the most recently calculated value of the attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-171">Any kind of process or plug-in will use the most recently calculated value of the attribute.</span></span> <span data-ttu-id="a002a-172">Rollup attribute values are calculated asynchronously by scheduled system jobs.</span><span class="sxs-lookup"><span data-stu-id="a002a-172">Rollup attribute values are calculated asynchronously by scheduled system jobs.</span></span> <span data-ttu-id="a002a-173">Administrators set when a job is run or pause the job.</span><span class="sxs-lookup"><span data-stu-id="a002a-173">Administrators set when a job is run or pause the job.</span></span> <span data-ttu-id="a002a-174">By default, each attribute is updated hourly.</span><span class="sxs-lookup"><span data-stu-id="a002a-174">By default, each attribute is updated hourly.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="a002a-175">[Define rollup fields](https://technet.microsoft.com/library/dn832103.aspx).</span><span class="sxs-lookup"><span data-stu-id="a002a-175">[Define rollup fields](https://technet.microsoft.com/library/dn832103.aspx).</span></span>  
  
 <span data-ttu-id="a002a-176">When a rollup attribute is created or updated a **Mass Calculated Rollup Fields** job is scheduled to run in 12 hours.</span><span class="sxs-lookup"><span data-stu-id="a002a-176">When a rollup attribute is created or updated a **Mass Calculated Rollup Fields** job is scheduled to run in 12 hours.</span></span> <span data-ttu-id="a002a-177">The 12-hour delay is intended to perform this resource intensive operation during a time that will affect users the least.</span><span class="sxs-lookup"><span data-stu-id="a002a-177">The 12-hour delay is intended to perform this resource intensive operation during a time that will affect users the least.</span></span> <span data-ttu-id="a002a-178">After the job completes, the next time it is scheduled to run will be 10 years in the future.</span><span class="sxs-lookup"><span data-stu-id="a002a-178">After the job completes, the next time it is scheduled to run will be 10 years in the future.</span></span> <span data-ttu-id="a002a-179">If there is a problem with the calculation, this will be reported with the system job.</span><span class="sxs-lookup"><span data-stu-id="a002a-179">If there is a problem with the calculation, this will be reported with the system job.</span></span> <span data-ttu-id="a002a-180">Locate the system job in **Settings** > **System Jobs** to find any errors with rollup fields.</span><span class="sxs-lookup"><span data-stu-id="a002a-180">Locate the system job in **Settings** > **System Jobs** to find any errors with rollup fields.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="a002a-181">As a developer testing a solution in a development environment you may not want to wait for 12 hours.</span><span class="sxs-lookup"><span data-stu-id="a002a-181">As a developer testing a solution in a development environment you may not want to wait for 12 hours.</span></span> <span data-ttu-id="a002a-182">You can make it happen faster.</span><span class="sxs-lookup"><span data-stu-id="a002a-182">You can make it happen faster.</span></span> <span data-ttu-id="a002a-183">In the **System Jobs** list, use the **Recurring System Jobs** view to filter the list and locate the **Mass Calculate Rollup Fields** job.</span><span class="sxs-lookup"><span data-stu-id="a002a-183">In the **System Jobs** list, use the **Recurring System Jobs** view to filter the list and locate the **Mass Calculate Rollup Fields** job.</span></span> <span data-ttu-id="a002a-184">With the job selected, use **More Actions** > **Postpone** and set the time to something that occurs sooner.</span><span class="sxs-lookup"><span data-stu-id="a002a-184">With the job selected, use **More Actions** > **Postpone** and set the time to something that occurs sooner.</span></span>  
>   
>  <span data-ttu-id="a002a-185">If you want to trigger the creation of a new **Mass Calculated Rollup Fields** job programmatically, retrieve the <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata> for the rollup attribute using <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAttributeRequest> and use <xref:Microsoft.Xrm.Sdk.Messages.UpdateAttributeRequest> to update the attribute without making any actual changes.</span><span class="sxs-lookup"><span data-stu-id="a002a-185">If you want to trigger the creation of a new **Mass Calculated Rollup Fields** job programmatically, retrieve the <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata> for the rollup attribute using <xref:Microsoft.Xrm.Sdk.Messages.RetrieveAttributeRequest> and use <xref:Microsoft.Xrm.Sdk.Messages.UpdateAttributeRequest> to update the attribute without making any actual changes.</span></span>  
  
 <span data-ttu-id="a002a-186">The **Mass Calculated Rollup Fields** job will occur immediately when a solution containing a rollup attribute is imported.</span><span class="sxs-lookup"><span data-stu-id="a002a-186">The **Mass Calculated Rollup Fields** job will occur immediately when a solution containing a rollup attribute is imported.</span></span> <span data-ttu-id="a002a-187">This assumes that you are installing a solution during a time that won’t adversely impact users.</span><span class="sxs-lookup"><span data-stu-id="a002a-187">This assumes that you are installing a solution during a time that won’t adversely impact users.</span></span>  
  
 <span data-ttu-id="a002a-188">Each rollup attribute for an entity will also include two supporting attributes for the rollup attribute:</span><span class="sxs-lookup"><span data-stu-id="a002a-188">Each rollup attribute for an entity will also include two supporting attributes for the rollup attribute:</span></span>  
  
- <span data-ttu-id="a002a-189">*\<attribute SchemaName>* `_Date`: DateTime – When the rollup was last calculated.</span><span class="sxs-lookup"><span data-stu-id="a002a-189">*\<attribute SchemaName>* `_Date`: DateTime – When the rollup was last calculated.</span></span>  
  
- <span data-ttu-id="a002a-190">*\<attribute SchemaName>* `_State`: Integer – The state of the rollup calculation.</span><span class="sxs-lookup"><span data-stu-id="a002a-190">*\<attribute SchemaName>* `_State`: Integer – The state of the rollup calculation.</span></span> [!INCLUDE[proc_more_information](../includes/proc-more-information.md)] <span data-ttu-id="a002a-191">[Rollup state values](calculated-rollup-attributes.md#BKMK_RollupStateValues)</span><span class="sxs-lookup"><span data-stu-id="a002a-191">[Rollup state values](calculated-rollup-attributes.md#BKMK_RollupStateValues)</span></span>  
  
<a name="BKMK_RollupStateValues"></a>   
### <a name="rollup-state-values"></a><span data-ttu-id="a002a-192">Rollup state values</span><span class="sxs-lookup"><span data-stu-id="a002a-192">Rollup state values</span></span>  
 <span data-ttu-id="a002a-193">The state of a rollup field calculation is available in the corresponding *\<attribute SchemaName>*`_State` attribute and in the <xref:Microsoft.Crm.Sdk.Messages.CalculateRollupFieldResponse>.`FieldState`</span><span class="sxs-lookup"><span data-stu-id="a002a-193">The state of a rollup field calculation is available in the corresponding *\<attribute SchemaName>*`_State` attribute and in the <xref:Microsoft.Crm.Sdk.Messages.CalculateRollupFieldResponse>.`FieldState`</span></span> <span data-ttu-id="a002a-194">property.</span><span class="sxs-lookup"><span data-stu-id="a002a-194">property.</span></span> <span data-ttu-id="a002a-195">Values that indicate the state are shown in the following table.</span><span class="sxs-lookup"><span data-stu-id="a002a-195">Values that indicate the state are shown in the following table.</span></span>  
  
|<span data-ttu-id="a002a-196">State Value</span><span class="sxs-lookup"><span data-stu-id="a002a-196">State Value</span></span>|<span data-ttu-id="a002a-197">Mô tả</span><span class="sxs-lookup"><span data-stu-id="a002a-197">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="a002a-198">0</span><span class="sxs-lookup"><span data-stu-id="a002a-198">0</span></span>|<span data-ttu-id="a002a-199">`NotCalculated`: Attribute value is yet to be calculated.</span><span class="sxs-lookup"><span data-stu-id="a002a-199">`NotCalculated`: Attribute value is yet to be calculated.</span></span>|  
|<span data-ttu-id="a002a-200">1</span><span class="sxs-lookup"><span data-stu-id="a002a-200">1</span></span>|<span data-ttu-id="a002a-201">`Calculated`: Attribute value has been calculated per the last update time in *\<attribute SchemaName>*`_Date` attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-201">`Calculated`: Attribute value has been calculated per the last update time in *\<attribute SchemaName>*`_Date` attribute.</span></span>|  
|<span data-ttu-id="a002a-202">2</span><span class="sxs-lookup"><span data-stu-id="a002a-202">2</span></span>|<span data-ttu-id="a002a-203">`OverflowError`: Attribute value calculation lead to overflow error.</span><span class="sxs-lookup"><span data-stu-id="a002a-203">`OverflowError`: Attribute value calculation lead to overflow error.</span></span>|  
|<span data-ttu-id="a002a-204">3</span><span class="sxs-lookup"><span data-stu-id="a002a-204">3</span></span>|<span data-ttu-id="a002a-205">`OtherError`: Attribute value calculation failed due to an internal error, next run of calculation job will likely fix it.</span><span class="sxs-lookup"><span data-stu-id="a002a-205">`OtherError`: Attribute value calculation failed due to an internal error, next run of calculation job will likely fix it.</span></span>|  
|<span data-ttu-id="a002a-206">4</span><span class="sxs-lookup"><span data-stu-id="a002a-206">4</span></span>|<span data-ttu-id="a002a-207">`RetryLimitExceeded`: Attribute value calculation failed because the maximum number of retry attempts to calculate the value were exceeded likely due to high number of concurrency and locking conflicts.</span><span class="sxs-lookup"><span data-stu-id="a002a-207">`RetryLimitExceeded`: Attribute value calculation failed because the maximum number of retry attempts to calculate the value were exceeded likely due to high number of concurrency and locking conflicts.</span></span>|  
|<span data-ttu-id="a002a-208">5</span><span class="sxs-lookup"><span data-stu-id="a002a-208">5</span></span>|<span data-ttu-id="a002a-209">`HierarchicalRecursionLimitReached`: Attribute value calculation failed because maximum hierarchy depth limit for calculation was reached.</span><span class="sxs-lookup"><span data-stu-id="a002a-209">`HierarchicalRecursionLimitReached`: Attribute value calculation failed because maximum hierarchy depth limit for calculation was reached.</span></span>|  
|<span data-ttu-id="a002a-210">6</span><span class="sxs-lookup"><span data-stu-id="a002a-210">6</span></span>|<span data-ttu-id="a002a-211">`LoopDetected`: Attribute value calculation failed because a recursive loop was detected in the hierarchy of the record.</span><span class="sxs-lookup"><span data-stu-id="a002a-211">`LoopDetected`: Attribute value calculation failed because a recursive loop was detected in the hierarchy of the record.</span></span>|  
  
### <a name="retrieve-a-calculated-rollup-field-value-immediately"></a><span data-ttu-id="a002a-212">Retrieve a calculated rollup field value immediately</span><span class="sxs-lookup"><span data-stu-id="a002a-212">Retrieve a calculated rollup field value immediately</span></span>  
 <span data-ttu-id="a002a-213">Rollup attributes support a `CalculateRollupField` message that developers can use to calculate a rollup attribute value on demand.</span><span class="sxs-lookup"><span data-stu-id="a002a-213">Rollup attributes support a `CalculateRollupField` message that developers can use to calculate a rollup attribute value on demand.</span></span> <span data-ttu-id="a002a-214">The request and response, along with the members, are shown in the following table.</span><span class="sxs-lookup"><span data-stu-id="a002a-214">The request and response, along with the members, are shown in the following table.</span></span>  
  
|<span data-ttu-id="a002a-215">Request/Response</span><span class="sxs-lookup"><span data-stu-id="a002a-215">Request/Response</span></span>|<span data-ttu-id="a002a-216">Thành viên</span><span class="sxs-lookup"><span data-stu-id="a002a-216">Members</span></span>|  
|-----------------------|-------------|  
|<xref:Microsoft.Crm.Sdk.Messages.CalculateRollupFieldRequest>|<span data-ttu-id="a002a-217">`Target`: <xref:Microsoft.Xrm.Sdk.EntityReference> for the record.</span><span class="sxs-lookup"><span data-stu-id="a002a-217">`Target`: <xref:Microsoft.Xrm.Sdk.EntityReference> for the record.</span></span><br /><br /> <span data-ttu-id="a002a-218">`FieldName`: String representing the logical name of the attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-218">`FieldName`: String representing the logical name of the attribute.</span></span>|  
|<xref:Microsoft.Crm.Sdk.Messages.CalculateRollupFieldResponse>|<span data-ttu-id="a002a-219">`Entity`: <xref:Microsoft.Xrm.Sdk.Entity> containing the rollup attribute and the supporting *\<attribute SchemaName>*`_Date` and *\<attribute SchemaName>*`_State` attributes.</span><span class="sxs-lookup"><span data-stu-id="a002a-219">`Entity`: <xref:Microsoft.Xrm.Sdk.Entity> containing the rollup attribute and the supporting *\<attribute SchemaName>*`_Date` and *\<attribute SchemaName>*`_State` attributes.</span></span>|  
  
 <span data-ttu-id="a002a-220">This message is a synchronous operation for just the attribute identified in the request.</span><span class="sxs-lookup"><span data-stu-id="a002a-220">This message is a synchronous operation for just the attribute identified in the request.</span></span> <span data-ttu-id="a002a-221">If the value of that record is included as part of other rollup fields, the values of those fields won’t take the possible value change caused by calling this method into consideration until the regularly scheduled asynchronous jobs that perform those calculations occur.</span><span class="sxs-lookup"><span data-stu-id="a002a-221">If the value of that record is included as part of other rollup fields, the values of those fields won’t take the possible value change caused by calling this method into consideration until the regularly scheduled asynchronous jobs that perform those calculations occur.</span></span>  
  
### <a name="limitations"></a><span data-ttu-id="a002a-222">Giới hạn</span><span class="sxs-lookup"><span data-stu-id="a002a-222">Limitations</span></span>  
 <span data-ttu-id="a002a-223">Rollup attributes can’t be used as a workflow event or wait condition.</span><span class="sxs-lookup"><span data-stu-id="a002a-223">Rollup attributes can’t be used as a workflow event or wait condition.</span></span> <span data-ttu-id="a002a-224">These attributes don’t raise the event to trigger workflows.</span><span class="sxs-lookup"><span data-stu-id="a002a-224">These attributes don’t raise the event to trigger workflows.</span></span>  
  
 <span data-ttu-id="a002a-225">The ModifiedBy and ModifiedOn attributes for the entity aren’t updated when the rollup attribute is updated.</span><span class="sxs-lookup"><span data-stu-id="a002a-225">The ModifiedBy and ModifiedOn attributes for the entity aren’t updated when the rollup attribute is updated.</span></span>  
  
 <span data-ttu-id="a002a-226">A maximum of 100 rollup attributes can be defined within an organization.</span><span class="sxs-lookup"><span data-stu-id="a002a-226">A maximum of 100 rollup attributes can be defined within an organization.</span></span> <span data-ttu-id="a002a-227">Each entity can have no more than 10 rollup attributes.</span><span class="sxs-lookup"><span data-stu-id="a002a-227">Each entity can have no more than 10 rollup attributes.</span></span>  
  
 <span data-ttu-id="a002a-228">A rollup attribute formula can’t reference another rollup attribute.</span><span class="sxs-lookup"><span data-stu-id="a002a-228">A rollup attribute formula can’t reference another rollup attribute.</span></span>  
  
 <span data-ttu-id="a002a-229">A rollup attribute formula can’t reference complex calculated attributes.</span><span class="sxs-lookup"><span data-stu-id="a002a-229">A rollup attribute formula can’t reference complex calculated attributes.</span></span> <span data-ttu-id="a002a-230">Only calculated attributes that reference simple attributes in the same record can be used with rollups.</span><span class="sxs-lookup"><span data-stu-id="a002a-230">Only calculated attributes that reference simple attributes in the same record can be used with rollups.</span></span>  
  
 <span data-ttu-id="a002a-231">A rollup attribute formula can’t include records in many-to-many (N:N) relationships.</span><span class="sxs-lookup"><span data-stu-id="a002a-231">A rollup attribute formula can’t include records in many-to-many (N:N) relationships.</span></span> <span data-ttu-id="a002a-232">It can only include records in one-to-many (1:N) relationships.</span><span class="sxs-lookup"><span data-stu-id="a002a-232">It can only include records in one-to-many (1:N) relationships.</span></span>  
  
 <span data-ttu-id="a002a-233">Rollup attribute formulas can’t use one-to-many (1:N) relationships with the `ActivityPointer` or `ActivityParty` entity.</span><span class="sxs-lookup"><span data-stu-id="a002a-233">Rollup attribute formulas can’t use one-to-many (1:N) relationships with the `ActivityPointer` or `ActivityParty` entity.</span></span>  
  
<a name="BKMK_SourceTypeMasks"></a>   
## <a name="sourcetypemasks-enumeration"></a><span data-ttu-id="a002a-234">SourceTypeMasks enumeration</span><span class="sxs-lookup"><span data-stu-id="a002a-234">SourceTypeMasks enumeration</span></span>  
 <span data-ttu-id="a002a-235">The `SourceTypeMask` property for those attributes that support calculated and rollup fields contains a bitmask value.</span><span class="sxs-lookup"><span data-stu-id="a002a-235">The `SourceTypeMask` property for those attributes that support calculated and rollup fields contains a bitmask value.</span></span> <span data-ttu-id="a002a-236">To extract the relevant information from the value, it helps to have an enumeration when performing bitwise operations.</span><span class="sxs-lookup"><span data-stu-id="a002a-236">To extract the relevant information from the value, it helps to have an enumeration when performing bitwise operations.</span></span> <span data-ttu-id="a002a-237">Use the following `SourceTypeMasks` enumeration when comparing the `SourceTypeMask` property value.</span><span class="sxs-lookup"><span data-stu-id="a002a-237">Use the following `SourceTypeMasks` enumeration when comparing the `SourceTypeMask` property value.</span></span>  
  
```csharp  
 public enum SourceTypeMasks  
{  
    /// <summary>  
    /// Undefined: 0 - The default value for simple and rollup attributes.  
    /// </summary>  
    Undefined = 0,  
    /// <summary>  
    /// Simple: 1 - The calculated attribute refers to an attribute in the same record.  
    /// </summary>  
    Simple = 1,  
    /// <summary>  
    /// Related: 2 - The calculated attribute refers to an attribute in a related record.  
    /// </summary>  
    Related = 2,  
    /// <summary>  
    /// Logical: 4 - The calculated attribute refers to a logical attribute.  
    /// </summary>  
    Logical = 4,  
    /// <summary>  
    /// Calculated: 8 - The calculated attribute refers to another calculated attribute.  
    /// </summary>  
    Calculated = 8,  
    /// <summary>  
    /// Rollup: 16 - The calculated attribute refers a rollup attribute.   
    /// </summary>  
    Rollup = 16,  
    /// <summary>  
    /// Invalid: 32 - The calculated or rollup attribute is invalid.  
    /// Typically this would be where a field refers to an attribute that no longer exists.   
    /// </summary>  
    Invalid = 32  
}  
```  
  
### <a name="see-also"></a><span data-ttu-id="a002a-238">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="a002a-238">See also</span></span>  
 <span data-ttu-id="a002a-239">[Video: Rollup and Calculated Fields in Microsoft Dynamics CRM 2015](http://youtu.be/RoahCH1p3T8) </span><span class="sxs-lookup"><span data-stu-id="a002a-239">[Video: Rollup and Calculated Fields in Microsoft Dynamics CRM 2015](http://youtu.be/RoahCH1p3T8) </span></span>  
 <span data-ttu-id="a002a-240">[Introduction to entity attributes](introduction-entity-attributes.md) </span><span class="sxs-lookup"><span data-stu-id="a002a-240">[Introduction to entity attributes](introduction-entity-attributes.md) </span></span>  
 <span data-ttu-id="a002a-241">[Xác định trường tính toán](https://technet.microsoft.com/library/dn832103.aspx) </span><span class="sxs-lookup"><span data-stu-id="a002a-241">[Define calculated fields](https://technet.microsoft.com/library/dn832103.aspx) </span></span>  
 [<span data-ttu-id="a002a-242">Xác định Trường tổng số</span><span class="sxs-lookup"><span data-stu-id="a002a-242">Define rollup fields</span></span>](https://technet.microsoft.com/library/dn832103.aspx)
