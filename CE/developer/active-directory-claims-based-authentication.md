---
title: Active Directory and claims-based authentication (Developer Guide for Dynamics 365 for Customer Engagement)| MicrosoftDocs
description: Learn how claims based authentication works using a security token service(STS) server and how Active Directory authentication works
ms.custom: ''
ms.date: 10/31/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: get-started-article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: dc81b2ec-c4db-44b9-8fe6-db108b196a96
caps.latest.revision: 85
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 2ba9de6204b18435896afecdd43d5be45d624a06
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "388343"
---
# <a name="active-directory-and-claims-based-authentication"></a><span data-ttu-id="93658-103">Active Directory and claims-based authentication</span><span class="sxs-lookup"><span data-stu-id="93658-103">Active Directory and claims-based authentication</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="93658-104">Claims-based authentication provides an industry standard security protocol to authenticate a user on a host computer.</span><span class="sxs-lookup"><span data-stu-id="93658-104">Claims-based authentication provides an industry standard security protocol to authenticate a user on a host computer.</span></span> <span data-ttu-id="93658-105">Claims-based authentication is a set of WS-\* standards describing the use of a Security Assertion Markup Language (SAML) token in either passive mode (when WS-Federation is used with the [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] web application) or active mode (where WS-Trust in used with [!INCLUDE[pn_WCF_long](../includes/pn-wcf-long.md)] clients).</span><span class="sxs-lookup"><span data-stu-id="93658-105">Claims-based authentication is a set of WS-\* standards describing the use of a Security Assertion Markup Language (SAML) token in either passive mode (when WS-Federation is used with the [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] web application) or active mode (where WS-Trust in used with [!INCLUDE[pn_WCF_long](../includes/pn-wcf-long.md)] clients).</span></span> <span data-ttu-id="93658-106">This authentication works together with WCF to provide secure user authentication and a communication channel with a [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps server.</span><span class="sxs-lookup"><span data-stu-id="93658-106">This authentication works together with WCF to provide secure user authentication and a communication channel with a [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps server.</span></span> <span data-ttu-id="93658-107">All [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)]apps edition support claims-based authentication.</span><span class="sxs-lookup"><span data-stu-id="93658-107">All [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)]apps edition support claims-based authentication.</span></span>

 <span data-ttu-id="93658-108">Claims-based authentication requires the availability of a security token service (STS) running on a server.</span><span class="sxs-lookup"><span data-stu-id="93658-108">Claims-based authentication requires the availability of a security token service (STS) running on a server.</span></span> <span data-ttu-id="93658-109">An STS server can be based on [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] Federation Services (AD FS) V2, or any platform that provides the official STS protocol.</span><span class="sxs-lookup"><span data-stu-id="93658-109">An STS server can be based on [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] Federation Services (AD FS) V2, or any platform that provides the official STS protocol.</span></span> <span data-ttu-id="93658-110">More information: [TechNet: Configure IFD for Dynamics 365 for Customer Engagement (on-premises)](https://technet.microsoft.com/library/dn609803.aspx).</span><span class="sxs-lookup"><span data-stu-id="93658-110">More information: [TechNet: Configure IFD for Dynamics 365 for Customer Engagement (on-premises)](https://technet.microsoft.com/library/dn609803.aspx).</span></span>   

<a name="bkmk_scenarios"></a>

## <a name="supported-authentication-scenarios"></a><span data-ttu-id="93658-111">Supported authentication scenarios</span><span class="sxs-lookup"><span data-stu-id="93658-111">Supported authentication scenarios</span></span> 

 [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] <span data-ttu-id="93658-112">apps support the following authentication scenarios for each deployment type.</span><span class="sxs-lookup"><span data-stu-id="93658-112">apps support the following authentication scenarios for each deployment type.</span></span>  

[!INCLUDE[cc_sdk_onpremises_note](../includes/cc-sdk-onpremises-note.md)]

|                                                 <span data-ttu-id="93658-113">Triển khai</span><span class="sxs-lookup"><span data-stu-id="93658-113">Deployment</span></span>                                                 |                                                  <span data-ttu-id="93658-114">Authentication model</span><span class="sxs-lookup"><span data-stu-id="93658-114">Authentication model</span></span>                                                   |
|------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
|                          <span data-ttu-id="93658-115">Ứng dụng [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)]</span><span class="sxs-lookup"><span data-stu-id="93658-115">[!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps</span></span>                           | <span data-ttu-id="93658-116">Claims-based or [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] (through federation) authentication</span><span class="sxs-lookup"><span data-stu-id="93658-116">Claims-based or [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] (through federation) authentication</span></span> |
|           [!INCLUDE[pn-crm-onprem](../includes/pn-crm-onprem.md)]          |           <span data-ttu-id="93658-117">Claims-based or [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] authentication</span><span class="sxs-lookup"><span data-stu-id="93658-117">Claims-based or [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] authentication</span></span>            |
| [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] <span data-ttu-id="93658-118">apps Internet-facing deployment (IFD)</span><span class="sxs-lookup"><span data-stu-id="93658-118">apps Internet-facing deployment (IFD)</span></span> |           <span data-ttu-id="93658-119">Claims-based or [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] authentication</span><span class="sxs-lookup"><span data-stu-id="93658-119">Claims-based or [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] authentication</span></span>            |

### <a name="how-claims-based-authentication-works"></a><span data-ttu-id="93658-120">How claims-based authentication works</span><span class="sxs-lookup"><span data-stu-id="93658-120">How claims-based authentication works</span></span>  
 <span data-ttu-id="93658-121">A request to authenticate a user is sent from [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps or a custom application to the STS server.</span><span class="sxs-lookup"><span data-stu-id="93658-121">A request to authenticate a user is sent from [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps or a custom application to the STS server.</span></span> <span data-ttu-id="93658-122">The STS server determines whether the user should be authenticated, and if so, issues a signed and encrypted SAML token that contains user authentication information.</span><span class="sxs-lookup"><span data-stu-id="93658-122">The STS server determines whether the user should be authenticated, and if so, issues a signed and encrypted SAML token that contains user authentication information.</span></span> <span data-ttu-id="93658-123">The token has a finite life span and may have to be periodically refreshed depending on how long your application is using the token.</span><span class="sxs-lookup"><span data-stu-id="93658-123">The token has a finite life span and may have to be periodically refreshed depending on how long your application is using the token.</span></span> <span data-ttu-id="93658-124">This is discussed in more detail later in this topic.</span><span class="sxs-lookup"><span data-stu-id="93658-124">This is discussed in more detail later in this topic.</span></span>  

### <a name="how-active-directory-authentication-works"></a><span data-ttu-id="93658-125">How Active Directory authentication works</span><span class="sxs-lookup"><span data-stu-id="93658-125">How Active Directory authentication works</span></span>  
 <span data-ttu-id="93658-126">A request to authenticate a user is sent from [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps or a custom application to [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)].</span><span class="sxs-lookup"><span data-stu-id="93658-126">A request to authenticate a user is sent from [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps or a custom application to [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)].</span></span> <span data-ttu-id="93658-127">The WCF stack manages the authentication process for Organization Service calls from an application, whereas [!INCLUDE[pn_Internet_Information_Services](../includes/pn-internet-information-services.md)] manages authentication for a web application.</span><span class="sxs-lookup"><span data-stu-id="93658-127">The WCF stack manages the authentication process for Organization Service calls from an application, whereas [!INCLUDE[pn_Internet_Information_Services](../includes/pn-internet-information-services.md)] manages authentication for a web application.</span></span>  

<a name="bkmk_unsupported"></a>   

## <a name="unsupported-authentication-scenarios"></a><span data-ttu-id="93658-128">Unsupported authentication scenarios</span><span class="sxs-lookup"><span data-stu-id="93658-128">Unsupported authentication scenarios</span></span>

 <span data-ttu-id="93658-129">Use of client certificates is not supported.</span><span class="sxs-lookup"><span data-stu-id="93658-129">Use of client certificates is not supported.</span></span> <span data-ttu-id="93658-130">If you configure the Dynamics 365 for Customer Engagement website to require IIS client certificates, you will get authentication failures for any applications that were built using the SDK.</span><span class="sxs-lookup"><span data-stu-id="93658-130">If you configure the Dynamics 365 for Customer Engagement website to require IIS client certificates, you will get authentication failures for any applications that were built using the SDK.</span></span>  

 <span data-ttu-id="93658-131">For more information about additional unsupported programming methods see [Unsupported Customizations](supported-extensions.md#Unsupported).</span><span class="sxs-lookup"><span data-stu-id="93658-131">For more information about additional unsupported programming methods see [Unsupported Customizations](supported-extensions.md#Unsupported).</span></span>  

<a name="bkmk_classes"></a> 

## <a name="authentication-classes"></a><span data-ttu-id="93658-132">Authentication classes</span><span class="sxs-lookup"><span data-stu-id="93658-132">Authentication classes</span></span>

 <span data-ttu-id="93658-133">The following table lists the primary authentication classes available in the SDK, describes when to use them, and provides links to additional relevant documentation.</span><span class="sxs-lookup"><span data-stu-id="93658-133">The following table lists the primary authentication classes available in the SDK, describes when to use them, and provides links to additional relevant documentation.</span></span>  


|                                                     <span data-ttu-id="93658-134">Các lớp</span><span class="sxs-lookup"><span data-stu-id="93658-134">Classes</span></span>                                                     |                                                                                                                                                                                                          <span data-ttu-id="93658-135">Sử dụng</span><span class="sxs-lookup"><span data-stu-id="93658-135">Usage</span></span>                                                                                                                                                                                                           |                                                                                                                                                                   <span data-ttu-id="93658-136">Related Documentation</span><span class="sxs-lookup"><span data-stu-id="93658-136">Related Documentation</span></span>                                                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  <span data-ttu-id="93658-137"><xref:Microsoft.Xrm.Sdk.Client.IServiceConfiguration`1>, <xref:Microsoft.Xrm.Sdk.Client.IServiceManagement`1></span><span class="sxs-lookup"><span data-stu-id="93658-137"><xref:Microsoft.Xrm.Sdk.Client.IServiceConfiguration`1>, <xref:Microsoft.Xrm.Sdk.Client.IServiceManagement`1></span></span>  |                                                                                  <span data-ttu-id="93658-138">All deployment types: on-premises/IFD, online ([!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] and [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS<sup>\*</sup>)</span><span class="sxs-lookup"><span data-stu-id="93658-138">All deployment types: on-premises/IFD, online ([!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] and [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS<sup>\*</sup>)</span></span><br /><br /> <span data-ttu-id="93658-139">Best choice for multi-threaded applications</span><span class="sxs-lookup"><span data-stu-id="93658-139">Best choice for multi-threaded applications</span></span>                                                                                  | [<span data-ttu-id="93658-140">Authenticate Office 365 Users with Dynamics 365 for Customer Engagement Web Services</span><span class="sxs-lookup"><span data-stu-id="93658-140">Authenticate Office 365 Users with Dynamics 365 for Customer Engagement Web Services</span></span>](authenticate-office-365-users-customer-engagement-web-services.md)<br /><br /> [<span data-ttu-id="93658-141">Sample: Authenticate Users with Dynamics 365 for Customer Engagement Web Services</span><span class="sxs-lookup"><span data-stu-id="93658-141">Sample: Authenticate Users with Dynamics 365 for Customer Engagement Web Services</span></span>](sample-authenticate-users-web-services.md)<br /><br /> [<span data-ttu-id="93658-142">Improve service channel allocation performance</span><span class="sxs-lookup"><span data-stu-id="93658-142">Improve service channel allocation performance</span></span>](best-practices-sdk.md#caching) |
| <span data-ttu-id="93658-143"><xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy>, <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy></span><span class="sxs-lookup"><span data-stu-id="93658-143"><xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy>, <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy></span></span> |                                                                                                              <span data-ttu-id="93658-144">All deployment types: on-premises/IFD, online ([!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] and [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS<sup>\*</sup>)</span><span class="sxs-lookup"><span data-stu-id="93658-144">All deployment types: on-premises/IFD, online ([!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] and [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS<sup>\*</sup>)</span></span>                                                                                                              |                    [<span data-ttu-id="93658-145">Authentication by Using the Client Proxy Classes</span><span class="sxs-lookup"><span data-stu-id="93658-145">Authentication by Using the Client Proxy Classes</span></span>](active-directory-claims-based-authentication.md#bkmk_clientproxy)<br /><br /> [<span data-ttu-id="93658-146">Sample: Access the Discovery Service</span><span class="sxs-lookup"><span data-stu-id="93658-146">Sample: Access the Discovery Service</span></span>](org-service/sample-access-discovery-service.md)<br /><br /> [<span data-ttu-id="93658-147">Improve service channel allocation performance</span><span class="sxs-lookup"><span data-stu-id="93658-147">Improve service channel allocation performance</span></span>](best-practices-sdk.md#caching)                    |
|        [<span data-ttu-id="93658-148">CrmConnection Class</span><span class="sxs-lookup"><span data-stu-id="93658-148">CrmConnection Class</span></span>](https://msdn.microsoft.com/library/microsoft.xrm.client.crmconnection.aspx)        |                                                                                                              <span data-ttu-id="93658-149">All deployment types: on-premises/IFD, online ([!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] and [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS<sup>\*</sup>)</span><span class="sxs-lookup"><span data-stu-id="93658-149">All deployment types: on-premises/IFD, online ([!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] and [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS<sup>\*</sup>)</span></span>                                                                                                              |                                             [<span data-ttu-id="93658-150">Simplified Connection to Microsoft Dynamics CRM</span><span class="sxs-lookup"><span data-stu-id="93658-150">Simplified Connection to Microsoft Dynamics CRM</span></span>](https://msdn.microsoft.com/en-us/library/gg695810.aspx)<br /><br /> [<span data-ttu-id="93658-151">Sample: Simplified Connection Quick Start using Dynamics 365 for Customer Engagement</span><span class="sxs-lookup"><span data-stu-id="93658-151">Sample: Simplified Connection Quick Start using Dynamics 365 for Customer Engagement</span></span>](xrm-tooling/sample-simplified-connection-quick-start.md)                                             |
|                                              <span data-ttu-id="93658-152">**ServerConnection**</span><span class="sxs-lookup"><span data-stu-id="93658-152">**ServerConnection**</span></span>                                               | <span data-ttu-id="93658-153">All deployment types: on-premises/IFD, online ([!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] and [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS<sup>\*</sup>)</span><span class="sxs-lookup"><span data-stu-id="93658-153">All deployment types: on-premises/IFD, online ([!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] and [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS<sup>\*</sup>)</span></span><br /><br /> <span data-ttu-id="93658-154">Use for console test applications and sample code.</span><span class="sxs-lookup"><span data-stu-id="93658-154">Use for console test applications and sample code.</span></span><br /><br /> <span data-ttu-id="93658-155">Designed to improve usability when running SDK sample code and to demonstrate use of the authentication classes.</span><span class="sxs-lookup"><span data-stu-id="93658-155">Designed to improve usability when running SDK sample code and to demonstrate use of the authentication classes.</span></span> <span data-ttu-id="93658-156">Contains console output code.</span><span class="sxs-lookup"><span data-stu-id="93658-156">Contains console output code.</span></span> |                                                                                  [<span data-ttu-id="93658-157">Helper Code: ServerConnection Class</span><span class="sxs-lookup"><span data-stu-id="93658-157">Helper Code: ServerConnection Class</span></span>](org-service/helper-code-serverconnection-class.md)<br /><br /> [<span data-ttu-id="93658-158">Sample: Quick Start for Dynamics 365 for Customer Engagement</span><span class="sxs-lookup"><span data-stu-id="93658-158">Sample: Quick Start for Dynamics 365 for Customer Engagement</span></span>](sample-quick-start.md)                                                                                   |

 <span data-ttu-id="93658-159"><sup>\*</sup> [!INCLUDE[pn_ms_online_services_environment](../includes/pn-ms-online-services-environment.md)]</span><span class="sxs-lookup"><span data-stu-id="93658-159"><sup>\*</sup> [!INCLUDE[pn_ms_online_services_environment](../includes/pn-ms-online-services-environment.md)]</span></span>  

<a name="bkmk_clientproxy"></a>   
## <a name="authentication-by-using-the-client-proxy-classes"></a><span data-ttu-id="93658-160">Authentication by using the client proxy classes</span><span class="sxs-lookup"><span data-stu-id="93658-160">Authentication by using the client proxy classes</span></span>  
 <span data-ttu-id="93658-161">One way to authenticate with the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] web services is by using the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy> and <xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy> classes in the applications that you write.</span><span class="sxs-lookup"><span data-stu-id="93658-161">One way to authenticate with the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] web services is by using the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy> and <xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy> classes in the applications that you write.</span></span> <span data-ttu-id="93658-162">The four-parameter constructor of these classes supports [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps deployment.</span><span class="sxs-lookup"><span data-stu-id="93658-162">The four-parameter constructor of these classes supports [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps deployment.</span></span> <span data-ttu-id="93658-163">These proxy classes automatically handle claims or [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] authentication and also manage resource limits on the WCF channel endpoint.</span><span class="sxs-lookup"><span data-stu-id="93658-163">These proxy classes automatically handle claims or [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] authentication and also manage resource limits on the WCF channel endpoint.</span></span>  

 <span data-ttu-id="93658-164">The following code shows how to instantiate the organization service proxy:</span><span class="sxs-lookup"><span data-stu-id="93658-164">The following code shows how to instantiate the organization service proxy:</span></span>  

```csharp  
using (OrganizationServiceProxy _serviceProxy = new OrganizationServiceProxy(organizationUri, homeRealmUri, userCredentials, deviceCredentials))  
```  

 <span data-ttu-id="93658-165">The following code shows how to instantiate the discovery service proxy:</span><span class="sxs-lookup"><span data-stu-id="93658-165">The following code shows how to instantiate the discovery service proxy:</span></span>  

```csharp  
using (DiscoveryServiceProxy _discProxy = new DiscoveryServiceProxy(organizationUri, homeRealmUri, userCredentials, deviceCredentials))  
```  

 <span data-ttu-id="93658-166">It is important to properly dispose of the service proxy instance in your application before the application terminates.</span><span class="sxs-lookup"><span data-stu-id="93658-166">It is important to properly dispose of the service proxy instance in your application before the application terminates.</span></span> <span data-ttu-id="93658-167">The `using` statement makes sure that the service proxy is correctly disposed by automatically calling `Dispose` on the service proxy when it goes out of scope.</span><span class="sxs-lookup"><span data-stu-id="93658-167">The `using` statement makes sure that the service proxy is correctly disposed by automatically calling `Dispose` on the service proxy when it goes out of scope.</span></span> <span data-ttu-id="93658-168">However, for improved application performance, it is a best practice to keep the service proxy instance available in your application for the entire application session instead of disposing it and allocating it again somewhere else in the application code when needed.</span><span class="sxs-lookup"><span data-stu-id="93658-168">However, for improved application performance, it is a best practice to keep the service proxy instance available in your application for the entire application session instead of disposing it and allocating it again somewhere else in the application code when needed.</span></span> <span data-ttu-id="93658-169">The reason being that creating and authenticating a service channel is an expensive operation (in time).</span><span class="sxs-lookup"><span data-stu-id="93658-169">The reason being that creating and authenticating a service channel is an expensive operation (in time).</span></span> <span data-ttu-id="93658-170">In this case, when you are done with the service proxy instance, you must directly call the **Dispose** method on the proxy before the application terminates.</span><span class="sxs-lookup"><span data-stu-id="93658-170">In this case, when you are done with the service proxy instance, you must directly call the **Dispose** method on the proxy before the application terminates.</span></span>  

 <span data-ttu-id="93658-171">The device credentials of the registered computing device are only used when authenticating with [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] through the [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] identity provider.</span><span class="sxs-lookup"><span data-stu-id="93658-171">The device credentials of the registered computing device are only used when authenticating with [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] through the [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] identity provider.</span></span> <span data-ttu-id="93658-172">For sample code that shows how to populate the proxy constructor parameters, see [Sample: Access the Discovery Service](org-service/sample-access-discovery-service.md).</span><span class="sxs-lookup"><span data-stu-id="93658-172">For sample code that shows how to populate the proxy constructor parameters, see [Sample: Access the Discovery Service](org-service/sample-access-discovery-service.md).</span></span>  

> [!IMPORTANT]
>  <span data-ttu-id="93658-173">For an on-premises or an Internet-facing deployment (IFD) installation of [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)], the client proxy classes use claims-based authentication if an STS server is available.</span><span class="sxs-lookup"><span data-stu-id="93658-173">For an on-premises or an Internet-facing deployment (IFD) installation of [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)], the client proxy classes use claims-based authentication if an STS server is available.</span></span> <span data-ttu-id="93658-174">Otherwise, [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] authentication is used.</span><span class="sxs-lookup"><span data-stu-id="93658-174">Otherwise, [!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)] authentication is used.</span></span>  

 <span data-ttu-id="93658-175">If you want to use [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] early-bound entity types in your code, you must add the following line of code after the organization service proxy is instantiated, but before you make web service method calls:</span><span class="sxs-lookup"><span data-stu-id="93658-175">If you want to use [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] early-bound entity types in your code, you must add the following line of code after the organization service proxy is instantiated, but before you make web service method calls:</span></span>  

```csharp  
_serviceProxy.EnableProxyTypes()  
```  

> [!IMPORTANT]
>  <span data-ttu-id="93658-176">WCF supports a feature where it can interactively prompt the user for logon credentials when it is necessary.</span><span class="sxs-lookup"><span data-stu-id="93658-176">WCF supports a feature where it can interactively prompt the user for logon credentials when it is necessary.</span></span> <span data-ttu-id="93658-177">This feature is enabled by setting the [SupportInteractive](https://msdn.microsoft.com/library/system.servicemodel.description.clientcredentials.supportinteractive.aspx) property of the `ClientCredentials` class.</span><span class="sxs-lookup"><span data-stu-id="93658-177">This feature is enabled by setting the [SupportInteractive](https://msdn.microsoft.com/library/system.servicemodel.description.clientcredentials.supportinteractive.aspx) property of the `ClientCredentials` class.</span></span> <span data-ttu-id="93658-178">These credentials are used in the `userCredentials` parameter shown in the previous code snippet.</span><span class="sxs-lookup"><span data-stu-id="93658-178">These credentials are used in the `userCredentials` parameter shown in the previous code snippet.</span></span>  
> 
>  <span data-ttu-id="93658-179">When making SDK calls to the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] web services, the ownership of the operation and entity data changes performed by the SDK call can be changed by this WCF feature independent of your code.</span><span class="sxs-lookup"><span data-stu-id="93658-179">When making SDK calls to the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] web services, the ownership of the operation and entity data changes performed by the SDK call can be changed by this WCF feature independent of your code.</span></span>  
> 
> [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] <span data-ttu-id="93658-180">apps handle supplied credentials in web service calls as follows:</span><span class="sxs-lookup"><span data-stu-id="93658-180">apps handle supplied credentials in web service calls as follows:</span></span>  
> 
> - <span data-ttu-id="93658-181">If credentials are not supplied in the web service call, the WCF stack determines which credentials to use.</span><span class="sxs-lookup"><span data-stu-id="93658-181">If credentials are not supplied in the web service call, the WCF stack determines which credentials to use.</span></span> <span data-ttu-id="93658-182">In that case, the `SupportInteractive` property value is automatically set to `false`.</span><span class="sxs-lookup"><span data-stu-id="93658-182">In that case, the `SupportInteractive` property value is automatically set to `false`.</span></span>  
>   -   <span data-ttu-id="93658-183">If credentials are explicitly supplied by your code, the current `SupportInteractive` value is passed to the WCF channel factory.</span><span class="sxs-lookup"><span data-stu-id="93658-183">If credentials are explicitly supplied by your code, the current `SupportInteractive` value is passed to the WCF channel factory.</span></span> <span data-ttu-id="93658-184">`SupportInteractive` is set to `true` by default unless you explicitly change it.</span><span class="sxs-lookup"><span data-stu-id="93658-184">`SupportInteractive` is set to `true` by default unless you explicitly change it.</span></span>  
>   -   <span data-ttu-id="93658-185">If `SupportInteractive` is set to `true` and the provided credentials fail, a WCF dialog box may be displayed.</span><span class="sxs-lookup"><span data-stu-id="93658-185">If `SupportInteractive` is set to `true` and the provided credentials fail, a WCF dialog box may be displayed.</span></span> <span data-ttu-id="93658-186">Any credentials entered by the user into the dialog box will be used instead of those supplied in the web service calls that your application invokes.</span><span class="sxs-lookup"><span data-stu-id="93658-186">Any credentials entered by the user into the dialog box will be used instead of those supplied in the web service calls that your application invokes.</span></span>  

<a name="bkmk_faults"></a>   
## <a name="handling-channel-exceptions-and-faults"></a><span data-ttu-id="93658-187">Handling channel exceptions and faults</span><span class="sxs-lookup"><span data-stu-id="93658-187">Handling channel exceptions and faults</span></span>  
 <span data-ttu-id="93658-188">Your code should catch the following exceptions and faults.</span><span class="sxs-lookup"><span data-stu-id="93658-188">Your code should catch the following exceptions and faults.</span></span> <span data-ttu-id="93658-189">See the C# samples in the developer documentation for a list of additional exceptions to catch:</span><span class="sxs-lookup"><span data-stu-id="93658-189">See the C# samples in the developer documentation for a list of additional exceptions to catch:</span></span>  

- [<span data-ttu-id="93658-190">System.TimeoutException</span><span class="sxs-lookup"><span data-stu-id="93658-190">System.TimeoutException</span></span>](https://msdn.microsoft.com/library/system.timeoutexception.aspx)  

- <span data-ttu-id="93658-191">[FaultException](https://msdn.microsoft.com/library/system.servicemodel.faultexception.aspx) \<<xref:Microsoft.Xrm.Sdk.OrganizationServiceFault>></span><span class="sxs-lookup"><span data-stu-id="93658-191">[FaultException](https://msdn.microsoft.com/library/system.servicemodel.faultexception.aspx) \<<xref:Microsoft.Xrm.Sdk.OrganizationServiceFault>></span></span>  

- <span data-ttu-id="93658-192">[FaultException](https://msdn.microsoft.com/library/system.servicemodel.faultexception.aspx) \<<xref:Microsoft.Xrm.Sdk.DiscoveryServiceFault>></span><span class="sxs-lookup"><span data-stu-id="93658-192">[FaultException](https://msdn.microsoft.com/library/system.servicemodel.faultexception.aspx) \<<xref:Microsoft.Xrm.Sdk.DiscoveryServiceFault>></span></span>  

  <span data-ttu-id="93658-193">For more information, see the [!INCLUDE[pn_NET_Framework](../includes/pn-net-framework.md)][WCF documentation](https://msdn.microsoft.com/library/ms789039.aspx) about how to handle WCF faults and exceptions.</span><span class="sxs-lookup"><span data-stu-id="93658-193">For more information, see the [!INCLUDE[pn_NET_Framework](../includes/pn-net-framework.md)][WCF documentation](https://msdn.microsoft.com/library/ms789039.aspx) about how to handle WCF faults and exceptions.</span></span> <span data-ttu-id="93658-194">See [Use the IOrganizationService Sample and Helper Code](org-service/use-sample-helper-code.md) for additional sample code.</span><span class="sxs-lookup"><span data-stu-id="93658-194">See [Use the IOrganizationService Sample and Helper Code](org-service/use-sample-helper-code.md) for additional sample code.</span></span>  

<a name="bkmk_saml"></a>   
## <a name="additional-information-about-the-security-saml-token"></a><span data-ttu-id="93658-195">Additional information about the security (SAML) token</span><span class="sxs-lookup"><span data-stu-id="93658-195">Additional information about the security (SAML) token</span></span>  
 <span data-ttu-id="93658-196">The SAML token used during user authentication is described below.</span><span class="sxs-lookup"><span data-stu-id="93658-196">The SAML token used during user authentication is described below.</span></span>  

### <a name="contents-of-the-saml-token"></a><span data-ttu-id="93658-197">Contents of the SAML token</span><span class="sxs-lookup"><span data-stu-id="93658-197">Contents of the SAML token</span></span>  
 <span data-ttu-id="93658-198">The XML-based SAML 2.0 token contains an identity that defines one or more claims about a user.</span><span class="sxs-lookup"><span data-stu-id="93658-198">The XML-based SAML 2.0 token contains an identity that defines one or more claims about a user.</span></span> <span data-ttu-id="93658-199">This token is passed between an identity provider (STS) server and [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps for claims-based authentication.</span><span class="sxs-lookup"><span data-stu-id="93658-199">This token is passed between an identity provider (STS) server and [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps for claims-based authentication.</span></span> <span data-ttu-id="93658-200">The claims in the identity have been defined as follows.</span><span class="sxs-lookup"><span data-stu-id="93658-200">The claims in the identity have been defined as follows.</span></span>  


|             <span data-ttu-id="93658-201">Claim</span><span class="sxs-lookup"><span data-stu-id="93658-201">Claim</span></span>              |                                                                                                                                                                                                                     <span data-ttu-id="93658-202">Sử dụng</span><span class="sxs-lookup"><span data-stu-id="93658-202">Use</span></span>                                                                                                                                                                                                                      |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="93658-203">Universal Principal Name (UPN)</span><span class="sxs-lookup"><span data-stu-id="93658-203">Universal Principal Name (UPN)</span></span> |                                                                                                                                                       <span data-ttu-id="93658-204">Contains the user’s ID in domain\alias format on the target [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] server.</span><span class="sxs-lookup"><span data-stu-id="93658-204">Contains the user’s ID in domain\alias format on the target [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] server.</span></span>                                                                                                                                                        |
|              <span data-ttu-id="93658-205">Tên</span><span class="sxs-lookup"><span data-stu-id="93658-205">Name</span></span>              | <span data-ttu-id="93658-206">If the authenticated user is also a Deployment Administrator in [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)], this claim contains the deployment administrator’s ID in domain\alias format on the target [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] server.</span><span class="sxs-lookup"><span data-stu-id="93658-206">If the authenticated user is also a Deployment Administrator in [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)], this claim contains the deployment administrator’s ID in domain\alias format on the target [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] server.</span></span> [!INCLUDE[pn_Windows_Identity_Foundation](../includes/pn-windows-identity-foundation.md)] <span data-ttu-id="93658-207">maps the `Name` claim to the `Identity.name` property.</span><span class="sxs-lookup"><span data-stu-id="93658-207">maps the `Name` claim to the `Identity.name` property.</span></span> |
|        <span data-ttu-id="93658-208">Any other claims</span><span class="sxs-lookup"><span data-stu-id="93658-208">Any other claims</span></span>        |                                                                                                                                                                                   <span data-ttu-id="93658-209">Not used by [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps.</span><span class="sxs-lookup"><span data-stu-id="93658-209">Not used by [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps.</span></span>                                                                                                                                                                                   |

### <a name="supported-security-token-types"></a><span data-ttu-id="93658-210">Supported security token types</span><span class="sxs-lookup"><span data-stu-id="93658-210">Supported security token types</span></span>  
 [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] <span data-ttu-id="93658-211">support two types of SAML tokens:</span><span class="sxs-lookup"><span data-stu-id="93658-211">support two types of SAML tokens:</span></span>  

- <span data-ttu-id="93658-212">**Web application** - The [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] web application receives a bearer token from STS.</span><span class="sxs-lookup"><span data-stu-id="93658-212">**Web application** - The [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] web application receives a bearer token from STS.</span></span> <span data-ttu-id="93658-213">This token is missing some required information so a Transport Layer Security (TLS) or Secure Sockets Layer (SSL)-based URL (https://) is used for security protection when you access the WCF endpoint.</span><span class="sxs-lookup"><span data-stu-id="93658-213">This token is missing some required information so a Transport Layer Security (TLS) or Secure Sockets Layer (SSL)-based URL (https://) is used for security protection when you access the WCF endpoint.</span></span>  

- <span data-ttu-id="93658-214">**SDK** - A custom application receives an active token with a proof key that contains the required information.</span><span class="sxs-lookup"><span data-stu-id="93658-214">**SDK** - A custom application receives an active token with a proof key that contains the required information.</span></span>  

### <a name="lifecycle-of-the-security-token"></a><span data-ttu-id="93658-215">Lifecycle of the security token</span><span class="sxs-lookup"><span data-stu-id="93658-215">Lifecycle of the security token</span></span>  
 <span data-ttu-id="93658-216">A [SecurityToken](https://msdn.microsoft.com/library/system.identitymodel.tokens.securitytoken.aspx) has a life span identified by its `ValidFrom` and `ValidTo` properties.</span><span class="sxs-lookup"><span data-stu-id="93658-216">A [SecurityToken](https://msdn.microsoft.com/library/system.identitymodel.tokens.securitytoken.aspx) has a life span identified by its `ValidFrom` and `ValidTo` properties.</span></span> <span data-ttu-id="93658-217">Your application design should consider the possibility that the token could expire, resulting in an [ExpiredSecurityTokenException](https://msdn.microsoft.com/library/system.servicemodel.security.expiredsecuritytokenexception\(VS.85\).aspx) being thrown by the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] web services when the next message request from your application is processed.</span><span class="sxs-lookup"><span data-stu-id="93658-217">Your application design should consider the possibility that the token could expire, resulting in an [ExpiredSecurityTokenException](https://msdn.microsoft.com/library/system.servicemodel.security.expiredsecuritytokenexception\(VS.85\).aspx) being thrown by the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] web services when the next message request from your application is processed.</span></span>  

### <a name="see-also"></a><span data-ttu-id="93658-218">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="93658-218">See also</span></span>  
 <span data-ttu-id="93658-219">[Walkthrough: Register a Dynamics 365 for Customer Engagement apps with Active Directory](walkthrough-register-app-active-directory.md) </span><span class="sxs-lookup"><span data-stu-id="93658-219">[Walkthrough: Register a Dynamics 365 for Customer Engagement apps with Active Directory](walkthrough-register-app-active-directory.md) </span></span>  
 <span data-ttu-id="93658-220">[Connect with Microsoft Office 365 and Dynamics 365 for Customer Engagement apps](connect-microsoft-office-365.md) </span><span class="sxs-lookup"><span data-stu-id="93658-220">[Connect with Microsoft Office 365 and Dynamics 365 for Customer Engagement apps](connect-microsoft-office-365.md) </span></span>  
 <span data-ttu-id="93658-221">[Implement Single Sign-on from an ASPX Webpage or IFRAME](implement-single-sign-aspx-webpage-iframe.md) </span><span class="sxs-lookup"><span data-stu-id="93658-221">[Implement Single Sign-on from an ASPX Webpage or IFRAME](implement-single-sign-aspx-webpage-iframe.md) </span></span>  
 [<span data-ttu-id="93658-222">Sample: Authenticate Users with Dynamics 365 for Customer Engagement Web Services</span><span class="sxs-lookup"><span data-stu-id="93658-222">Sample: Authenticate Users with Dynamics 365 for Customer Engagement Web Services</span></span>](sample-authenticate-users-web-services.md)
