---
title: Define alternate keys for an entity (Developer Guide for Dynamics 365 for Customer Engagement apps) | MicrosoftDocs
description: The topic explains about how to create alternate keys for an entity. Alternate keys can be created programmatically or by using the customization tools
ms.custom: ''
ms.date: 10/22/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: fb4a93d6-590b-4913-96f7-25d351dc52ab
caps.latest.revision: 23
author: mayadumesh
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 7dee1f35b69ee630e4367d30b9b1ff9ef15c24c6
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "386616"
---
# <a name="define-alternate-keys-for-an-entity"></a><span data-ttu-id="eb09c-104">Define alternate keys for an entity</span><span class="sxs-lookup"><span data-stu-id="eb09c-104">Define alternate keys for an entity</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="eb09c-105">All [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps records have unique identifiers defined as GUIDs.</span><span class="sxs-lookup"><span data-stu-id="eb09c-105">All [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps records have unique identifiers defined as GUIDs.</span></span> <span data-ttu-id="eb09c-106">These are the primary key for each entity.</span><span class="sxs-lookup"><span data-stu-id="eb09c-106">These are the primary key for each entity.</span></span> <span data-ttu-id="eb09c-107">When you need to integrate with an external data store, you might be able to add a column to the external database tables to contain a reference to the unique identifier in [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps.</span><span class="sxs-lookup"><span data-stu-id="eb09c-107">When you need to integrate with an external data store, you might be able to add a column to the external database tables to contain a reference to the unique identifier in [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps.</span></span> <span data-ttu-id="eb09c-108">This allows you to have a local reference to link to the [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps record.</span><span class="sxs-lookup"><span data-stu-id="eb09c-108">This allows you to have a local reference to link to the [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps record.</span></span> <span data-ttu-id="eb09c-109">However, sometimes you can’t modify the external database.</span><span class="sxs-lookup"><span data-stu-id="eb09c-109">However, sometimes you can’t modify the external database.</span></span> <span data-ttu-id="eb09c-110">With alternate keys you can now define an attribute in a [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps entity to correspond to a unique identifier (or unique combination of columns) used by the external data store.</span><span class="sxs-lookup"><span data-stu-id="eb09c-110">With alternate keys you can now define an attribute in a [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps entity to correspond to a unique identifier (or unique combination of columns) used by the external data store.</span></span> <span data-ttu-id="eb09c-111">This alternate key can be used to uniquely identify a record in [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps in place of the primary key.</span><span class="sxs-lookup"><span data-stu-id="eb09c-111">This alternate key can be used to uniquely identify a record in [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] apps in place of the primary key.</span></span> <span data-ttu-id="eb09c-112">You must be able to define which attributes represent a unique identity for your records.</span><span class="sxs-lookup"><span data-stu-id="eb09c-112">You must be able to define which attributes represent a unique identity for your records.</span></span> <span data-ttu-id="eb09c-113">Once you identify the attributes that are unique to the entity, you can declare them as alternate keys through the customization user interface (UI) or in the code.</span><span class="sxs-lookup"><span data-stu-id="eb09c-113">Once you identify the attributes that are unique to the entity, you can declare them as alternate keys through the customization user interface (UI) or in the code.</span></span> <span data-ttu-id="eb09c-114">This topic provides information about defining alternate keys in the data model.</span><span class="sxs-lookup"><span data-stu-id="eb09c-114">This topic provides information about defining alternate keys in the data model.</span></span>  

<a name="BKMK_Declare"></a>

## <a name="create-alternate-keys"></a><span data-ttu-id="eb09c-115">Create alternate keys</span><span class="sxs-lookup"><span data-stu-id="eb09c-115">Create alternate keys</span></span>  

<span data-ttu-id="eb09c-116">You can create alternate keys programmatically or by using the customizations tools.</span><span class="sxs-lookup"><span data-stu-id="eb09c-116">You can create alternate keys programmatically or by using the customizations tools.</span></span> <span data-ttu-id="eb09c-117">For more information about using the customization tools, see [Define alternate keys to reference CRM records](https://technet.microsoft.com/library/29e53691-0b18-4fde-a1d0-7490aa227898.aspx).</span><span class="sxs-lookup"><span data-stu-id="eb09c-117">For more information about using the customization tools, see [Define alternate keys to reference CRM records](https://technet.microsoft.com/library/29e53691-0b18-4fde-a1d0-7490aa227898.aspx).</span></span>  

<span data-ttu-id="eb09c-118">To define alternate keys programmatically, you first have to create an object of type <xref:Microsoft.Xrm.Sdk.Metadata.EntityKeyMetadata> (or use <xref href="Microsoft.Dynamics.CRM.EntityKeyMetadata?text=EntityKeyMetadata EntityType" /> if working with Web API).</span><span class="sxs-lookup"><span data-stu-id="eb09c-118">To define alternate keys programmatically, you first have to create an object of type <xref:Microsoft.Xrm.Sdk.Metadata.EntityKeyMetadata> (or use <xref href="Microsoft.Dynamics.CRM.EntityKeyMetadata?text=EntityKeyMetadata EntityType" /> if working with Web API).</span></span> <span data-ttu-id="eb09c-119">This class contains the key attributes.</span><span class="sxs-lookup"><span data-stu-id="eb09c-119">This class contains the key attributes.</span></span> <span data-ttu-id="eb09c-120">Once the key attributes are set, you can use `CreateEntityKey` to create the keys for an entity.</span><span class="sxs-lookup"><span data-stu-id="eb09c-120">Once the key attributes are set, you can use `CreateEntityKey` to create the keys for an entity.</span></span> <span data-ttu-id="eb09c-121">This message takes the entity name and `EntityKeyMetadata` values as input to create the key.</span><span class="sxs-lookup"><span data-stu-id="eb09c-121">This message takes the entity name and `EntityKeyMetadata` values as input to create the key.</span></span>  

<span data-ttu-id="eb09c-122">You should be aware of the following constraints when creating alternate keys:</span><span class="sxs-lookup"><span data-stu-id="eb09c-122">You should be aware of the following constraints when creating alternate keys:</span></span>  

- <span data-ttu-id="eb09c-123">**Valid attribute types in key definitions**</span><span class="sxs-lookup"><span data-stu-id="eb09c-123">**Valid attribute types in key definitions**</span></span>  

   <span data-ttu-id="eb09c-124">Only attributes of the following types can be included in alternate key definitions:</span><span class="sxs-lookup"><span data-stu-id="eb09c-124">Only attributes of the following types can be included in alternate key definitions:</span></span>  


  |      <span data-ttu-id="eb09c-125">Attribute Type</span><span class="sxs-lookup"><span data-stu-id="eb09c-125">Attribute Type</span></span>         |    <span data-ttu-id="eb09c-126">Tên Hiển thị</span><span class="sxs-lookup"><span data-stu-id="eb09c-126">Display Name</span></span>     |
  |-----------------------------|---------------------|
  | <span data-ttu-id="eb09c-127">DecimalAttributeMetadata</span><span class="sxs-lookup"><span data-stu-id="eb09c-127">DecimalAttributeMetadata</span></span>    |   <span data-ttu-id="eb09c-128">Số Thập phân</span><span class="sxs-lookup"><span data-stu-id="eb09c-128">Decimal Number</span></span>    |
  | <span data-ttu-id="eb09c-129">IntegerAttributeMetadata</span><span class="sxs-lookup"><span data-stu-id="eb09c-129">IntegerAttributeMetadata</span></span>    |    <span data-ttu-id="eb09c-130">Số Nguyên</span><span class="sxs-lookup"><span data-stu-id="eb09c-130">Whole Number</span></span>     |
  | <span data-ttu-id="eb09c-131">StringAttributeMetadata</span><span class="sxs-lookup"><span data-stu-id="eb09c-131">StringAttributeMetadata</span></span>     | <span data-ttu-id="eb09c-132">Một dòng văn bản</span><span class="sxs-lookup"><span data-stu-id="eb09c-132">Single line of text</span></span> |
  | <span data-ttu-id="eb09c-133">DateTimeAttributeMetadata</span><span class="sxs-lookup"><span data-stu-id="eb09c-133">DateTimeAttributeMetadata</span></span>   |      <span data-ttu-id="eb09c-134">Thời gian ngày</span><span class="sxs-lookup"><span data-stu-id="eb09c-134">Date Time</span></span>      |
  | <span data-ttu-id="eb09c-135">LookupAttributeMetadata</span><span class="sxs-lookup"><span data-stu-id="eb09c-135">LookupAttributeMetadata</span></span>     |       <span data-ttu-id="eb09c-136">Tra cứu</span><span class="sxs-lookup"><span data-stu-id="eb09c-136">Lookup</span></span>        |
  | <span data-ttu-id="eb09c-137">PicklistAttributeMetadata</span><span class="sxs-lookup"><span data-stu-id="eb09c-137">PicklistAttributeMetadata</span></span>   |      <span data-ttu-id="eb09c-138">Danh sách chọn</span><span class="sxs-lookup"><span data-stu-id="eb09c-138">Picklist</span></span>       |
  
 - <span data-ttu-id="eb09c-139">**Attributes must be valid for create and update**</span><span class="sxs-lookup"><span data-stu-id="eb09c-139">**Attributes must be valid for create and update**</span></span>  

   <span data-ttu-id="eb09c-140">Each attribute used in a key must support both create and update.</span><span class="sxs-lookup"><span data-stu-id="eb09c-140">Each attribute used in a key must support both create and update.</span></span> <span data-ttu-id="eb09c-141">More information: [Valid operations on attributes](introduction-entity-attributes.md#valid-operations-on-attributes)</span><span class="sxs-lookup"><span data-stu-id="eb09c-141">More information: [Valid operations on attributes](introduction-entity-attributes.md#valid-operations-on-attributes)</span></span>
   
- <span data-ttu-id="eb09c-142">**Attributes must not have Field-level security applied**</span><span class="sxs-lookup"><span data-stu-id="eb09c-142">**Attributes must not have Field-level security applied**</span></span>  

- <span data-ttu-id="eb09c-143">**Attributes must not be logical or inherited**</span><span class="sxs-lookup"><span data-stu-id="eb09c-143">**Attributes must not be logical or inherited**</span></span>  

   <span data-ttu-id="eb09c-144">Most logical and inherited attributes are configured as read-only.</span><span class="sxs-lookup"><span data-stu-id="eb09c-144">Most logical and inherited attributes are configured as read-only.</span></span> <span data-ttu-id="eb09c-145">However, many of the attributes that contain address information in entities such as Account and Contact are logical and cannot be used in a key, even though they are writable.</span><span class="sxs-lookup"><span data-stu-id="eb09c-145">However, many of the attributes that contain address information in entities such as Account and Contact are logical and cannot be used in a key, even though they are writable.</span></span> <span data-ttu-id="eb09c-146">More information: [Logical attributes](introduction-entity-attributes.md#logical-attributes)</span><span class="sxs-lookup"><span data-stu-id="eb09c-146">More information: [Logical attributes](introduction-entity-attributes.md#logical-attributes)</span></span>
   
- <span data-ttu-id="eb09c-147">**Kích thước khóa hợp lệ**</span><span class="sxs-lookup"><span data-stu-id="eb09c-147">**Valid key size**</span></span>  

   <span data-ttu-id="eb09c-148">Khi một khóa được tạo, hệ thống xác thực rằng nền tảng có thể hỗ trợ khóa đó, trong đó tổng kích thước khóa không vi phạm giới hạn chỉ mục dựa trên SQL như 900 byte/khóa và 16 cột/khóa.</span><span class="sxs-lookup"><span data-stu-id="eb09c-148">When a key is created, the system validates that the key can be supported by the platform, including that the total key size does not violate SQL-based index constraints like 900 bytes per key and 16 columns per key.</span></span> <span data-ttu-id="eb09c-149">Nếu kích thước khóa không thỏa mãn giới hạn, thông báo lỗi sẽ hiển thị.</span><span class="sxs-lookup"><span data-stu-id="eb09c-149">If the key size doesn’t meet the constraints, an error message will be displayed.</span></span> 

- <span data-ttu-id="eb09c-150">**Maximum number of alternate key definitions for an entity**</span><span class="sxs-lookup"><span data-stu-id="eb09c-150">**Maximum number of alternate key definitions for an entity**</span></span>  

   <span data-ttu-id="eb09c-151">There can be a maximum of 5 alternate key definitions for an entity in a [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] instance.</span><span class="sxs-lookup"><span data-stu-id="eb09c-151">There can be a maximum of 5 alternate key definitions for an entity in a [!INCLUDE[pn_crm_shortest](../includes/pn-crm-shortest.md)] instance.</span></span>  

- <span data-ttu-id="eb09c-152">**Special characters in key value**</span><span class="sxs-lookup"><span data-stu-id="eb09c-152">**Special characters in key value**</span></span>

  <span data-ttu-id="eb09c-153">Nếu dữ liệu trong một trường được sử dụng trong một khóa thay thế chứa một trong các ký tự sau `<`,`>`,`*`,`%`,`&`,`:`,`\\` thì bản vá hoặc hành động upsert sẽ không hoạt động.</span><span class="sxs-lookup"><span data-stu-id="eb09c-153">If the data within a field that is used in an alternate key will contain one of the following characters `<`,`>`,`*`,`%`,`&`,`:`,`\\` then patch or upsert actions will not work.</span></span>  <span data-ttu-id="eb09c-154">If you only need uniqueness then this approach will work, but if you need to use these keys as part of data integration then it is best to create the key on fields that won't have data with those characters.</span><span class="sxs-lookup"><span data-stu-id="eb09c-154">If you only need uniqueness then this approach will work, but if you need to use these keys as part of data integration then it is best to create the key on fields that won't have data with those characters.</span></span>

<a name="BKMK_crud"></a>   

## <a name="retrieve-and-delete-alternate-keys"></a><span data-ttu-id="eb09c-155">Retrieve and delete alternate keys</span><span class="sxs-lookup"><span data-stu-id="eb09c-155">Retrieve and delete alternate keys</span></span>  

<span data-ttu-id="eb09c-156">If you need to retrieve or delete alternate keys, you can use the customization UI to do this, without writing any code.</span><span class="sxs-lookup"><span data-stu-id="eb09c-156">If you need to retrieve or delete alternate keys, you can use the customization UI to do this, without writing any code.</span></span> <span data-ttu-id="eb09c-157">However, the SDK provides the following two messages to programmatically retrieve and delete alternate keys.</span><span class="sxs-lookup"><span data-stu-id="eb09c-157">However, the SDK provides the following two messages to programmatically retrieve and delete alternate keys.</span></span>  

|<span data-ttu-id="eb09c-158">Message request class</span><span class="sxs-lookup"><span data-stu-id="eb09c-158">Message request class</span></span>|<span data-ttu-id="eb09c-159">Mô tả</span><span class="sxs-lookup"><span data-stu-id="eb09c-159">Description</span></span>|  
|---------------------------|-----------------|  
|<xref:Microsoft.Xrm.Sdk.Messages.RetrieveEntityKeyRequest>|<span data-ttu-id="eb09c-160">Retrieves the specified alternate key.</span><span class="sxs-lookup"><span data-stu-id="eb09c-160">Retrieves the specified alternate key.</span></span>|  
|<xref:Microsoft.Xrm.Sdk.Messages.DeleteEntityKeyRequest>|<span data-ttu-id="eb09c-161">Deletes the specified alternate key.</span><span class="sxs-lookup"><span data-stu-id="eb09c-161">Deletes the specified alternate key.</span></span>|  

<span data-ttu-id="eb09c-162">To retrieve all the keys for an entity, use the new <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Keys> property of `EntityMetadata` (<xref href="Microsoft.Dynamics.CRM.EntityMetadata?text=EntityMetadata EntityType" /> or <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata> class).</span><span class="sxs-lookup"><span data-stu-id="eb09c-162">To retrieve all the keys for an entity, use the new <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.Keys> property of `EntityMetadata` (<xref href="Microsoft.Dynamics.CRM.EntityMetadata?text=EntityMetadata EntityType" /> or <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata> class).</span></span> <span data-ttu-id="eb09c-163">It gets an array of keys for an entity.</span><span class="sxs-lookup"><span data-stu-id="eb09c-163">It gets an array of keys for an entity.</span></span>  

<a name="BKMK_index"></a>   

## <a name="monitor-index-creation-for-alternate-keys"></a><span data-ttu-id="eb09c-164">Monitor index creation for alternate keys</span><span class="sxs-lookup"><span data-stu-id="eb09c-164">Monitor index creation for alternate keys</span></span>  

<span data-ttu-id="eb09c-165">Alternate keys use database indexes to enforce uniqueness and optimize lookup performance.</span><span class="sxs-lookup"><span data-stu-id="eb09c-165">Alternate keys use database indexes to enforce uniqueness and optimize lookup performance.</span></span> <span data-ttu-id="eb09c-166">If there are lots of existing records in a table, index creation can be a lengthy process.</span><span class="sxs-lookup"><span data-stu-id="eb09c-166">If there are lots of existing records in a table, index creation can be a lengthy process.</span></span> <span data-ttu-id="eb09c-167">You can increase the responsiveness of the customization UI and solution import by doing the index creation as a background process.</span><span class="sxs-lookup"><span data-stu-id="eb09c-167">You can increase the responsiveness of the customization UI and solution import by doing the index creation as a background process.</span></span> <span data-ttu-id="eb09c-168">The `EntityKeyMetadata.AsyncJob` property (<xref href="Microsoft.Dynamics.CRM.EntityKeyMetadata?text=EntityKeyMetadata EntityType" /> or <xref:Microsoft.Xrm.Sdk.Metadata.EntityKeyMetadata>) refers to the asynchronous job that is doing the index creation.</span><span class="sxs-lookup"><span data-stu-id="eb09c-168">The `EntityKeyMetadata.AsyncJob` property (<xref href="Microsoft.Dynamics.CRM.EntityKeyMetadata?text=EntityKeyMetadata EntityType" /> or <xref:Microsoft.Xrm.Sdk.Metadata.EntityKeyMetadata>) refers to the asynchronous job that is doing the index creation.</span></span> <span data-ttu-id="eb09c-169">The `EntityKeyMetadata.EntityKeyIndexStatus` property specifies the status of the key as its index creation job progresses.</span><span class="sxs-lookup"><span data-stu-id="eb09c-169">The `EntityKeyMetadata.EntityKeyIndexStatus` property specifies the status of the key as its index creation job progresses.</span></span> <span data-ttu-id="eb09c-170">The status could be any of the following:</span><span class="sxs-lookup"><span data-stu-id="eb09c-170">The status could be any of the following:</span></span>  

- <span data-ttu-id="eb09c-171">Pending</span><span class="sxs-lookup"><span data-stu-id="eb09c-171">Pending</span></span>  
- <span data-ttu-id="eb09c-172">Đang Tiến hành</span><span class="sxs-lookup"><span data-stu-id="eb09c-172">In Progress</span></span>  
- <span data-ttu-id="eb09c-173">Hoạt động</span><span class="sxs-lookup"><span data-stu-id="eb09c-173">Active</span></span>  
- <span data-ttu-id="eb09c-174">Không thành công</span><span class="sxs-lookup"><span data-stu-id="eb09c-174">Failed</span></span>  

<span data-ttu-id="eb09c-175">When an alternate key is created using the API, if the index creation fails, you can drill into details about the cause of the failure, correct the problems, and reactivate the key request using the `ReactivateEntityKey` (<xref href="Microsoft.Dynamics.CRM.ReactivateEntityKey?text=ReactivateEntityKey Action" /> or <xref:Microsoft.Xrm.Sdk.Messages.ReactivateEntityKeyRequest> message).</span><span class="sxs-lookup"><span data-stu-id="eb09c-175">When an alternate key is created using the API, if the index creation fails, you can drill into details about the cause of the failure, correct the problems, and reactivate the key request using the `ReactivateEntityKey` (<xref href="Microsoft.Dynamics.CRM.ReactivateEntityKey?text=ReactivateEntityKey Action" /> or <xref:Microsoft.Xrm.Sdk.Messages.ReactivateEntityKeyRequest> message).</span></span>  

<span data-ttu-id="eb09c-176">If the alternate key is deleted while an index creation job is still pending or in progress, the job is cancelled and the index is deleted.</span><span class="sxs-lookup"><span data-stu-id="eb09c-176">If the alternate key is deleted while an index creation job is still pending or in progress, the job is cancelled and the index is deleted.</span></span>  

### <a name="see-also"></a><span data-ttu-id="eb09c-177">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="eb09c-177">See also</span></span>  
 [<span data-ttu-id="eb09c-178">Using alternate keys</span><span class="sxs-lookup"><span data-stu-id="eb09c-178">Using alternate keys</span></span>](use-alternate-key-create-record.md)<br />
 [<span data-ttu-id="eb09c-179">Use change tracking to synchronize data with external systems</span><span class="sxs-lookup"><span data-stu-id="eb09c-179">Use change tracking to synchronize data with external systems</span></span>](use-change-tracking-synchronize-data-external-systems.md)<br />
 [<span data-ttu-id="eb09c-180">Use Upsert to insert or update a record</span><span class="sxs-lookup"><span data-stu-id="eb09c-180">Use Upsert to insert or update a record</span></span>](use-upsert-insert-update-record.md)
