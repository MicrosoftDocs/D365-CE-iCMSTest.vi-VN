---
title: Authenticate Office 365 users with Customer Engagement web services (Developer Guide for Dynamics 365 for Customer Engagement apps)| MicrosoftDocs
description: This topic applies to customers who access Dynamics 365 for Customer Engagement apps Customer Engagement through the Microsoft Online Services environment. It discusses how Dynamics 365 for Customer Engagement apps web service authentication with managed domain and federated identity providers works
ms.custom: ''
ms.date: 10/31/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: bdd3b0f8-bdd7-4604-941e-7308f4c2d83c
caps.latest.revision: 49
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: de150292961b8ad9587b0ac2617af9990e128993
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "386992"
---
# <a name="authenticate-office-365-users-with-customer-engagement-web-services"></a><span data-ttu-id="f2b22-104">Authenticate Office 365 users with Customer Engagement web services</span><span class="sxs-lookup"><span data-stu-id="f2b22-104">Authenticate Office 365 users with Customer Engagement web services</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="f2b22-105">This topic applies to customers who access [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps through the [!INCLUDE[pn_ms_online_services_environment](../includes/pn-ms-online-services-environment.md)].</span><span class="sxs-lookup"><span data-stu-id="f2b22-105">This topic applies to customers who access [!INCLUDE[pn_dynamics_crm_online](../includes/pn-dynamics-crm-online.md)] apps through the [!INCLUDE[pn_ms_online_services_environment](../includes/pn-ms-online-services-environment.md)].</span></span> <span data-ttu-id="f2b22-106">There are multiple [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps identity providers that must be accounted for when you develop an application that connects to the Organization or Discovery web services.</span><span class="sxs-lookup"><span data-stu-id="f2b22-106">There are multiple [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps identity providers that must be accounted for when you develop an application that connects to the Organization or Discovery web services.</span></span> <span data-ttu-id="f2b22-107">These providers can be identified as managed domain, federated, and [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)].</span><span class="sxs-lookup"><span data-stu-id="f2b22-107">These providers can be identified as managed domain, federated, and [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)].</span></span> <span data-ttu-id="f2b22-108">This topic focuses on [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps web service authentication with managed domain and federated identity providers, although the same classes and code shown here also work with all supported identity providers and [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps deployment types.</span><span class="sxs-lookup"><span data-stu-id="f2b22-108">This topic focuses on [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps web service authentication with managed domain and federated identity providers, although the same classes and code shown here also work with all supported identity providers and [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps deployment types.</span></span>  
  
<a name="bkmk_simplified"></a>
   
## <a name="use-the-simplified-authentication-classes"></a><span data-ttu-id="f2b22-109">Use the simplified authentication classes</span><span class="sxs-lookup"><span data-stu-id="f2b22-109">Use the simplified authentication classes</span></span> 
 
 <span data-ttu-id="f2b22-110">You can use the  <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy> and <xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy> classes when authenticating with the web services.</span><span class="sxs-lookup"><span data-stu-id="f2b22-110">You can use the  <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy> and <xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy> classes when authenticating with the web services.</span></span>  
<span data-ttu-id="f2b22-111">For more information about using these proxy classes see [Authentication by using the client proxy classes](active-directory-claims-based-authentication.md#bkmk_clientproxy).</span><span class="sxs-lookup"><span data-stu-id="f2b22-111">For more information about using these proxy classes see [Authentication by using the client proxy classes](active-directory-claims-based-authentication.md#bkmk_clientproxy).</span></span> 
  
 <span data-ttu-id="f2b22-112">Another authentication approach is to use the helper source code provided in the SDK.</span><span class="sxs-lookup"><span data-stu-id="f2b22-112">Another authentication approach is to use the helper source code provided in the SDK.</span></span> <span data-ttu-id="f2b22-113">The `ServerConnection` helper class, shown in the [Helper Code: ServerConnection Class](org-service/helper-code-serverconnection-class.md) topic, provides `GetOrganizationProxy` and `GetProxy` methods for authentication.</span><span class="sxs-lookup"><span data-stu-id="f2b22-113">The `ServerConnection` helper class, shown in the [Helper Code: ServerConnection Class](org-service/helper-code-serverconnection-class.md) topic, provides `GetOrganizationProxy` and `GetProxy` methods for authentication.</span></span> <span data-ttu-id="f2b22-114">If you look at the source code for `ServerConnection`, you will see that `GetOrganizationProxy` actually calls `GetProxy`.</span><span class="sxs-lookup"><span data-stu-id="f2b22-114">If you look at the source code for `ServerConnection`, you will see that `GetOrganizationProxy` actually calls `GetProxy`.</span></span>  
  
```csharp  
using ( OrganizationServiceProxy orgServiceProxy = ServerConnection.GetOrganizationProxy(serverConfig) ) { }  
```  
  
 <span data-ttu-id="f2b22-115">You must create these organization or discovery service proxy objects in a `using` statement to correctly dispose of the service proxy, or call `Dispose` directly.</span><span class="sxs-lookup"><span data-stu-id="f2b22-115">You must create these organization or discovery service proxy objects in a `using` statement to correctly dispose of the service proxy, or call `Dispose` directly.</span></span> <span data-ttu-id="f2b22-116">For sample code that uses the `GetOrganizationProxy` helper code method, see [Sample: Quick Start](sample-quick-start.md).</span><span class="sxs-lookup"><span data-stu-id="f2b22-116">For sample code that uses the `GetOrganizationProxy` helper code method, see [Sample: Quick Start](sample-quick-start.md).</span></span>  
  
 <span data-ttu-id="f2b22-117">The complete list of authentication classes available in the SDK assemblies are shown in the [Authentication Classes](active-directory-claims-based-authentication.md#bkmk_classes) section.</span><span class="sxs-lookup"><span data-stu-id="f2b22-117">The complete list of authentication classes available in the SDK assemblies are shown in the [Authentication Classes](active-directory-claims-based-authentication.md#bkmk_classes) section.</span></span>  
  
<a name="bkmk_migration"></a>

## <a name="authenticate-microsoft-account-users-with-office-365"></a><span data-ttu-id="f2b22-118">Authenticate Microsoft account users with Office 365</span><span class="sxs-lookup"><span data-stu-id="f2b22-118">Authenticate Microsoft account users with Office 365</span></span>

 <span data-ttu-id="f2b22-119">Your application needs to support those [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] users whose organization is transitioned from the [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] identity provider to the [!INCLUDE[pn_MS_Online_Services](../includes/pn-ms-online-services.md)] identity provider.</span><span class="sxs-lookup"><span data-stu-id="f2b22-119">Your application needs to support those [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] users whose organization is transitioned from the [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] identity provider to the [!INCLUDE[pn_MS_Online_Services](../includes/pn-ms-online-services.md)] identity provider.</span></span> <span data-ttu-id="f2b22-120">In this scenario, users may provide their [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] sign-in credentials when they authenticate with the [!INCLUDE[pn_MS_Online_Services](../includes/pn-ms-online-services.md)] identity provider of [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)].</span><span class="sxs-lookup"><span data-stu-id="f2b22-120">In this scenario, users may provide their [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] sign-in credentials when they authenticate with the [!INCLUDE[pn_MS_Online_Services](../includes/pn-ms-online-services.md)] identity provider of [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)].</span></span>  
  
 <span data-ttu-id="f2b22-121">To do this, pass the populated credentials in the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy> constructor or the <xref:Microsoft.Xrm.Sdk.Client.AuthenticationCredentials> method of the `IServiceManagement` class.</span><span class="sxs-lookup"><span data-stu-id="f2b22-121">To do this, pass the populated credentials in the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy> constructor or the <xref:Microsoft.Xrm.Sdk.Client.AuthenticationCredentials> method of the `IServiceManagement` class.</span></span> <span data-ttu-id="f2b22-122">The credential values are populated as follows:</span><span class="sxs-lookup"><span data-stu-id="f2b22-122">The credential values are populated as follows:</span></span>  
  
```csharp  
AuthenticationCredentials.ClientCredentials = <Microsoft account sign-in credentials>  
AuthenticationCredentials.SupportingCredentials.ClientCredentials = <device credentials>  
``` 

 <span data-ttu-id="f2b22-123">If your code checks the identity provider type to determine how to authenticate, then additional code is required.</span><span class="sxs-lookup"><span data-stu-id="f2b22-123">If your code checks the identity provider type to determine how to authenticate, then additional code is required.</span></span> <span data-ttu-id="f2b22-124">See the `GetCredentials` method in the next section for sample code that supports transitioned [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] users.</span><span class="sxs-lookup"><span data-stu-id="f2b22-124">See the `GetCredentials` method in the next section for sample code that supports transitioned [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] users.</span></span>  
  
 <span data-ttu-id="f2b22-125">For more information about this transition, see [Dynamics 365 for Customer Engagement apps Integration with Office 365](online-integration-office-365.md).</span><span class="sxs-lookup"><span data-stu-id="f2b22-125">For more information about this transition, see [Dynamics 365 for Customer Engagement apps Integration with Office 365](online-integration-office-365.md).</span></span>  
  
<a name="bkmk_deep"></a> 
  
## <a name="authentication-deep-dive"></a><span data-ttu-id="f2b22-126">Authentication deep dive</span><span class="sxs-lookup"><span data-stu-id="f2b22-126">Authentication deep dive</span></span>  

 <span data-ttu-id="f2b22-127">The previous discussion introduced two simple approaches that can be used to authenticate a user with the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps web services.</span><span class="sxs-lookup"><span data-stu-id="f2b22-127">The previous discussion introduced two simple approaches that can be used to authenticate a user with the [!INCLUDE[pn_dynamics_crm](../includes/pn-dynamics-crm.md)] apps web services.</span></span> <span data-ttu-id="f2b22-128">The following information shows how to authenticate a user by using the <xref:Microsoft.Xrm.Sdk.Client.IServiceManagement`1> class and includes the source code to the `GetProxy` method.</span><span class="sxs-lookup"><span data-stu-id="f2b22-128">The following information shows how to authenticate a user by using the <xref:Microsoft.Xrm.Sdk.Client.IServiceManagement`1> class and includes the source code to the `GetProxy` method.</span></span> <span data-ttu-id="f2b22-129">To see the complete sample that contains the following examples, see [Sample: Authenticate Office 365 Users](sample-authenticate-users-web-services.md).</span><span class="sxs-lookup"><span data-stu-id="f2b22-129">To see the complete sample that contains the following examples, see [Sample: Authenticate Office 365 Users](sample-authenticate-users-web-services.md).</span></span> <span data-ttu-id="f2b22-130">You will notice that authentication at this level takes a lot more code.</span><span class="sxs-lookup"><span data-stu-id="f2b22-130">You will notice that authentication at this level takes a lot more code.</span></span>  
  
 <span data-ttu-id="f2b22-131">The following sample code demonstrates the classes and methods that you can use in your application to authenticate an [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS user using the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps web services.</span><span class="sxs-lookup"><span data-stu-id="f2b22-131">The following sample code demonstrates the classes and methods that you can use in your application to authenticate an [!INCLUDE[pn_Office_365](../includes/pn-office-365.md)]/MOS user using the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps web services.</span></span>  
  
 [!code-csharp[AuthenticateWithNoHelp#AuthenticateWithNoHelp3](../snippets/csharp/CRMV8/authenticatewithnohelp/cs/authenticatewithnohelp3.cs#authenticatewithnohelp3)]  

  
 <span data-ttu-id="f2b22-132">The code creates an <xref:Microsoft.Xrm.Sdk.Client.IServiceManagement`1> object for the Organization service.</span><span class="sxs-lookup"><span data-stu-id="f2b22-132">The code creates an <xref:Microsoft.Xrm.Sdk.Client.IServiceManagement`1> object for the Organization service.</span></span> <span data-ttu-id="f2b22-133">An object of type <xref:Microsoft.Xrm.Sdk.Client.AuthenticationCredentials> is used to contain the user’s sign-in credentials.</span><span class="sxs-lookup"><span data-stu-id="f2b22-133">An object of type <xref:Microsoft.Xrm.Sdk.Client.AuthenticationCredentials> is used to contain the user’s sign-in credentials.</span></span> <span data-ttu-id="f2b22-134">The `IServiceManagement` object and user credentials are then passed to `GetProxy` to obtain the web service proxy reference.</span><span class="sxs-lookup"><span data-stu-id="f2b22-134">The `IServiceManagement` object and user credentials are then passed to `GetProxy` to obtain the web service proxy reference.</span></span>  
  
 [!code-csharp[AuthenticateWithNoHelp#AuthenticateWithNoHelp2](../snippets/csharp/CRMV8/authenticatewithnohelp/cs/authenticatewithnohelp2.cs#authenticatewithnohelp2)]  

  
 <span data-ttu-id="f2b22-135">The <xref:Microsoft.Xrm.Sdk.Client.AuthenticationCredentials> object is configured according to the subscribed identity for the signed-in user.</span><span class="sxs-lookup"><span data-stu-id="f2b22-135">The <xref:Microsoft.Xrm.Sdk.Client.AuthenticationCredentials> object is configured according to the subscribed identity for the signed-in user.</span></span> <span data-ttu-id="f2b22-136">Notice that user credentials for all types of identity providers are shown.</span><span class="sxs-lookup"><span data-stu-id="f2b22-136">Notice that user credentials for all types of identity providers are shown.</span></span> <span data-ttu-id="f2b22-137">The default case handles [!INCLUDE[pn_MS_Office_365](../includes/pn-ms-office-365.md)]/MOS managed domain, online users whose identities are federated in the cloud, and transitioned [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] users.</span><span class="sxs-lookup"><span data-stu-id="f2b22-137">The default case handles [!INCLUDE[pn_MS_Office_365](../includes/pn-ms-office-365.md)]/MOS managed domain, online users whose identities are federated in the cloud, and transitioned [!INCLUDE[pn_Windows_Live_ID](../includes/pn-windows-live-id.md)] users.</span></span> <span data-ttu-id="f2b22-138">Now let’s take a look at what `GetProxy` actually does.</span><span class="sxs-lookup"><span data-stu-id="f2b22-138">Now let’s take a look at what `GetProxy` actually does.</span></span>  
  
 [!code-csharp[AuthenticateWithNoHelp#AuthenticateWithNoHelp4](../snippets/csharp/CRMV8/authenticatewithnohelp/cs/authenticatewithnohelp4.cs#authenticatewithnohelp4)]  

  
[!INCLUDE[cc_sdk_onpremises_note](../includes/cc-sdk-onpremises-note.md)]

<span data-ttu-id="f2b22-139">For all deployments other than on-premises ([!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)], without claims), the <xref:Microsoft.Xrm.Sdk.Client.IServiceManagement`1.Authenticate(Microsoft.Xrm.Sdk.Client.AuthenticationCredentials)> method is invoked and then the service proxy is instantiated.</span><span class="sxs-lookup"><span data-stu-id="f2b22-139">For all deployments other than on-premises ([!INCLUDE[pn_Active_Directory](../includes/pn-active-directory.md)], without claims), the <xref:Microsoft.Xrm.Sdk.Client.IServiceManagement`1.Authenticate(Microsoft.Xrm.Sdk.Client.AuthenticationCredentials)> method is invoked and then the service proxy is instantiated.</span></span> <span data-ttu-id="f2b22-140">Notice that the authentication credentials returned from `Authenticate` contain the security token response that is used in the service proxy constructor.</span><span class="sxs-lookup"><span data-stu-id="f2b22-140">Notice that the authentication credentials returned from `Authenticate` contain the security token response that is used in the service proxy constructor.</span></span> <span data-ttu-id="f2b22-141">The generic `GetProxy` method shown previously can be used to obtain an object reference to either <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy> or <xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy>.</span><span class="sxs-lookup"><span data-stu-id="f2b22-141">The generic `GetProxy` method shown previously can be used to obtain an object reference to either <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy> or <xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy>.</span></span>  
  
### <a name="see-also"></a><span data-ttu-id="f2b22-142">Xem thêm</span><span class="sxs-lookup"><span data-stu-id="f2b22-142">See also</span></span> 
 
 <span data-ttu-id="f2b22-143">[Connect with Microsoft Office 365 and Dynamics 365 for Customer Engagement apps](connect-microsoft-office-365.md) [Sample: Authenticate Office 365 Users](sample-authenticate-users-web-services.md) </span><span class="sxs-lookup"><span data-stu-id="f2b22-143">[Connect with Microsoft Office 365 and Dynamics 365 for Customer Engagement apps](connect-microsoft-office-365.md) [Sample: Authenticate Office 365 Users](sample-authenticate-users-web-services.md) </span></span>  
 <span data-ttu-id="f2b22-144">[Helper Code: ServerConnection Class](org-service/helper-code-serverconnection-class.md) </span><span class="sxs-lookup"><span data-stu-id="f2b22-144">[Helper Code: ServerConnection Class](org-service/helper-code-serverconnection-class.md) </span></span>  
 <span data-ttu-id="f2b22-145">[Active Directory and Claims-Based Authentication](active-directory-claims-based-authentication.md) </span><span class="sxs-lookup"><span data-stu-id="f2b22-145">[Active Directory and Claims-Based Authentication](active-directory-claims-based-authentication.md) </span></span>  
 [<span data-ttu-id="f2b22-146">Use connection strings in XRM tooling to connect to Dynamics 365 for Customer Engagement apps</span><span class="sxs-lookup"><span data-stu-id="f2b22-146">Use connection strings in XRM tooling to connect to Dynamics 365 for Customer Engagement apps</span></span>](xrm-tooling/use-connection-strings-xrm-tooling-connect.md)
