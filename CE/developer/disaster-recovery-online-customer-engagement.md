---
title: Disaster recovery (Developer Guide for Dynamics 365 for Customer Engagement apps) | MicrosoftDocs
description: Online feature to recover from a planned or unplanned service interruption.
ms.custom: ''
ms.date: 11/20/2017
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 for Customer Engagement (online)
ms.assetid: a4b17ddb-c0a8-433d-a428-858b495e6734
caps.latest.revision: 18
author: JimDaly
ms.author: jdaly
manager: amyla
search.audienceType:
- developer
search.app:
- D365CE
ms.openlocfilehash: 06f8d408db2d3789b7f590ca0166561ac9f95d4c
ms.sourcegitcommit: 9f0efd59de16a6d9902fa372cb25fc0baf1c2838
ms.translationtype: HT
ms.contentlocale: vi-VN
ms.lasthandoff: 01/08/2019
ms.locfileid: "385962"
---
# <a name="disaster-recovery-in-customer-engagement-online"></a><span data-ttu-id="1c0c1-103">Disaster recovery in Customer Engagement (online)</span><span class="sxs-lookup"><span data-stu-id="1c0c1-103">Disaster recovery in Customer Engagement (online)</span></span>

[!INCLUDE[](../includes/cc_applies_to_update_9_0_0.md)]

<span data-ttu-id="1c0c1-104">Disaster recovery is a feature of [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps to recover from a planned or unplanned service interruption.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-104">Disaster recovery is a feature of [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] apps to recover from a planned or unplanned service interruption.</span></span> <span data-ttu-id="1c0c1-105">An example of a planned service interruption is regular and periodic datacenter system maintenance.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-105">An example of a planned service interruption is regular and periodic datacenter system maintenance.</span></span> <span data-ttu-id="1c0c1-106">An example of an unplanned service interruption is a failure of a key computer system or network component in a data center.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-106">An example of an unplanned service interruption is a failure of a key computer system or network component in a data center.</span></span> <span data-ttu-id="1c0c1-107">For either case, you temporarily lose access to your organization's data and the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] services.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-107">For either case, you temporarily lose access to your organization's data and the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] services.</span></span>  
  
 <span data-ttu-id="1c0c1-108">Planned service interruptions are preceded by a public notice in the web application or [!INCLUDE[pn_crm_for_outlook_short](../includes/pn-crm-for-outlook-short.md)] identifying the date and time of the service maintenance so that businesses can plan for the interruption in accessing their organization's data.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-108">Planned service interruptions are preceded by a public notice in the web application or [!INCLUDE[pn_crm_for_outlook_short](../includes/pn-crm-for-outlook-short.md)] identifying the date and time of the service maintenance so that businesses can plan for the interruption in accessing their organization's data.</span></span> <span data-ttu-id="1c0c1-109">Unplanned service interruptions result in a notice that the organization is currently undergoing unplanned maintenance.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-109">Unplanned service interruptions result in a notice that the organization is currently undergoing unplanned maintenance.</span></span>  
  
 <span data-ttu-id="1c0c1-110">When a failure or a disaster occurs, well-defined processes are applied by the administrators of the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] data center to recover from a service interruption.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-110">When a failure or a disaster occurs, well-defined processes are applied by the administrators of the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] data center to recover from a service interruption.</span></span> <span data-ttu-id="1c0c1-111">The processes and software to recover from these service interruptions is known as *disaster recovery failover*.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-111">The processes and software to recover from these service interruptions is known as *disaster recovery failover*.</span></span> <span data-ttu-id="1c0c1-112">Your [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)]apps datacenter maintains a duplicate and synchronized (alternate) copy of your organization's data on a different server.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-112">Your [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)]apps datacenter maintains a duplicate and synchronized (alternate) copy of your organization's data on a different server.</span></span> <span data-ttu-id="1c0c1-113">Should a disaster occur in the data center where you no longer have access to your data, the administrators monitoring the datacenter can switch access from your primary organization to this alternate organization, thereby minimizing the service interruption.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-113">Should a disaster occur in the data center where you no longer have access to your data, the administrators monitoring the datacenter can switch access from your primary organization to this alternate organization, thereby minimizing the service interruption.</span></span> <span data-ttu-id="1c0c1-114">When the failure has been corrected, service access to your primary organization can be restored.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-114">When the failure has been corrected, service access to your primary organization can be restored.</span></span>  
  
 <span data-ttu-id="1c0c1-115">This recovery happens in the datacenter and is handled transparently to you and your .NET managed applications.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-115">This recovery happens in the datacenter and is handled transparently to you and your .NET managed applications.</span></span> <span data-ttu-id="1c0c1-116">However, there is one issue that application developers must deal with: data loss.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-116">However, there is one issue that application developers must deal with: data loss.</span></span> <span data-ttu-id="1c0c1-117">When the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] services encounter a failure, data change operations that your application performs using web service calls may not complete successfully.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-117">When the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] services encounter a failure, data change operations that your application performs using web service calls may not complete successfully.</span></span> <span data-ttu-id="1c0c1-118">This can result in data loss.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-118">This can result in data loss.</span></span> <span data-ttu-id="1c0c1-119">The following sections in this topic describe how you can write your applications to deal with data loss issues.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-119">The following sections in this topic describe how you can write your applications to deal with data loss issues.</span></span>  
  
<a name="develop"></a>   
## <a name="develop-a-net-managed-code-application-for-failover-recovery"></a><span data-ttu-id="1c0c1-120">Develop a .NET Managed Code application for failover recovery</span><span class="sxs-lookup"><span data-stu-id="1c0c1-120">Develop a .NET Managed Code application for failover recovery</span></span>  
 <span data-ttu-id="1c0c1-121">Developers can write their applications to account for data center failure and recovery by implementing code to check for and handle a failover event gracefully.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-121">Developers can write their applications to account for data center failure and recovery by implementing code to check for and handle a failover event gracefully.</span></span> <span data-ttu-id="1c0c1-122">An application can subscribe to the <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitched> and <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitchRequired> notification events.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-122">An application can subscribe to the <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitched> and <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitchRequired> notification events.</span></span> <span data-ttu-id="1c0c1-123">These events are also available in derived classes like <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy>.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-123">These events are also available in derived classes like <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy>.</span></span> <span data-ttu-id="1c0c1-124">For more information about these events, see the <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1> class documentation.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-124">For more information about these events, see the <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1> class documentation.</span></span>  
  
 <span data-ttu-id="1c0c1-125">Your application can check the <xref:Microsoft.Xrm.Sdk.Client.IEndpointSwitch.EndpointAutoSwitchEnabled> property to determine whether automatic failover behavior is enabled for an organization.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-125">Your application can check the <xref:Microsoft.Xrm.Sdk.Client.IEndpointSwitch.EndpointAutoSwitchEnabled> property to determine whether automatic failover behavior is enabled for an organization.</span></span> <span data-ttu-id="1c0c1-126">This property is set to **true** for organizations where a failover alternate endpoint is available.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-126">This property is set to **true** for organizations where a failover alternate endpoint is available.</span></span> <span data-ttu-id="1c0c1-127">No other special code is required in your application other than optionally subscribing to the notification events when `EndpointAutoSwitchEnabled` is **true**.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-127">No other special code is required in your application other than optionally subscribing to the notification events when `EndpointAutoSwitchEnabled` is **true**.</span></span>  
  
#### <a name="typical-application-logic-flow-for-a-disaster-event-and-failover"></a><span data-ttu-id="1c0c1-128">Typical application logic flow for a disaster event and failover</span><span class="sxs-lookup"><span data-stu-id="1c0c1-128">Typical application logic flow for a disaster event and failover</span></span>  
  
1. <span data-ttu-id="1c0c1-129">A disaster event occurs in the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] datacenter.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-129">A disaster event occurs in the [!INCLUDE[pn_CRM_Online](../includes/pn-crm-online.md)] datacenter.</span></span>  
  
2. <span data-ttu-id="1c0c1-130">Your application makes a service call through a service proxy class object: <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy>, <xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy>.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-130">Your application makes a service call through a service proxy class object: <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceProxy>, <xref:Microsoft.Xrm.Sdk.Client.DiscoveryServiceProxy>.</span></span>  
  
3. <span data-ttu-id="1c0c1-131">The service proxy class object receives an exception after attempting the service call.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-131">The service proxy class object receives an exception after attempting the service call.</span></span>  
  
4. <span data-ttu-id="1c0c1-132">If the target organization of the call is not enabled for failover, go to step 9.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-132">If the target organization of the call is not enabled for failover, go to step 9.</span></span>  
  
5. <span data-ttu-id="1c0c1-133">The <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitchRequired> event is thrown.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-133">The <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitchRequired> event is thrown.</span></span>  
  
6. <span data-ttu-id="1c0c1-134">The <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitched> event is thrown.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-134">The <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitched> event is thrown.</span></span>  
  
7. <span data-ttu-id="1c0c1-135">The service proxy class object automatically tries the call again.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-135">The service proxy class object automatically tries the call again.</span></span>  
  
8. <span data-ttu-id="1c0c1-136">If the second call was successful, the application continues normally.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-136">If the second call was successful, the application continues normally.</span></span>  
  
9. <span data-ttu-id="1c0c1-137">If the call was not successful, an exception is returned to the application: `EndpointNotFoundException`, `TimeoutException`, `FaultException<OrganizationServiceFault>` where `fault.Detail.ErrorCode` == -2147176347.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-137">If the call was not successful, an exception is returned to the application: `EndpointNotFoundException`, `TimeoutException`, `FaultException<OrganizationServiceFault>` where `fault.Detail.ErrorCode` == -2147176347.</span></span>  
  
   <span data-ttu-id="1c0c1-138">You may want to implement code that checks for potential data loss after endpoint switch events are received and handle it appropriately.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-138">You may want to implement code that checks for potential data loss after endpoint switch events are received and handle it appropriately.</span></span>  
  
   <span data-ttu-id="1c0c1-139">After the disaster affecting the primary organization endpoint has been corrected in the datacenter, a fail back from the alternate endpoint URL to the primary endpoint URL for the organization occurs as part of planned organization maintenance.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-139">After the disaster affecting the primary organization endpoint has been corrected in the datacenter, a fail back from the alternate endpoint URL to the primary endpoint URL for the organization occurs as part of planned organization maintenance.</span></span>  
  
<a name="develop_fail"></a>   

## <a name="develop-a-non-net-application-for-failover-recovery"></a><span data-ttu-id="1c0c1-140">Develop a Non-.NET application for failover recovery</span><span class="sxs-lookup"><span data-stu-id="1c0c1-140">Develop a Non-.NET application for failover recovery</span></span> 
 
 <span data-ttu-id="1c0c1-141">Applications that do not use the .NET assemblies, for example Java applications that access the web services by using the Organization service or Web API can try accessing the failover URL for the target organization.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-141">Applications that do not use the .NET assemblies, for example Java applications that access the web services by using the Organization service or Web API can try accessing the failover URL for the target organization.</span></span> <span data-ttu-id="1c0c1-142">The URL for a failover alternate organization is the same as the URL for the primary organization with “--S” added to the organization name.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-142">The URL for a failover alternate organization is the same as the URL for the primary organization with “--S” added to the organization name.</span></span> <span data-ttu-id="1c0c1-143">For example, an organization named Contoso would have the primary and alternate URLs shown in the following table.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-143">For example, an organization named Contoso would have the primary and alternate URLs shown in the following table.</span></span>  
  
|<span data-ttu-id="1c0c1-144">Primary Organization URL</span><span class="sxs-lookup"><span data-stu-id="1c0c1-144">Primary Organization URL</span></span>|<span data-ttu-id="1c0c1-145">Alternate Organization URL</span><span class="sxs-lookup"><span data-stu-id="1c0c1-145">Alternate Organization URL</span></span>|  
|------------------------------|--------------------------------|  
| https://contoso.api.crm.dynamics.com | https://contoso--s.api.crm.dynamics.com |  
  
 <span data-ttu-id="1c0c1-146">For non.NET-connected applications, there is no notification event to which your application can subscribe to receive notice of a service interruption and failover.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-146">For non.NET-connected applications, there is no notification event to which your application can subscribe to receive notice of a service interruption and failover.</span></span> <span data-ttu-id="1c0c1-147">Your application will begin to receive a variety of fault exceptions, as listed previously, during the service interruption.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-147">Your application will begin to receive a variety of fault exceptions, as listed previously, during the service interruption.</span></span> <span data-ttu-id="1c0c1-148">At that point, the application can attempt to connect to the failover alternate URL for the target organization.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-148">At that point, the application can attempt to connect to the failover alternate URL for the target organization.</span></span> <span data-ttu-id="1c0c1-149">After the disaster has been corrected, a fail back to the primary URL for the organization occurs as part of planned organization maintenance.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-149">After the disaster has been corrected, a fail back to the primary URL for the organization occurs as part of planned organization maintenance.</span></span>  
  
<a name="best_practices"></a>   
## <a name="best-practices"></a><span data-ttu-id="1c0c1-150">Thực tiễn tốt nhất</span><span class="sxs-lookup"><span data-stu-id="1c0c1-150">Best practices</span></span>  
 <span data-ttu-id="1c0c1-151">The following list describes some best practices you can implement in your applications to make them more robust when they deal with service interruptions and failure recovery.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-151">The following list describes some best practices you can implement in your applications to make them more robust when they deal with service interruptions and failure recovery.</span></span>  
  
-   <span data-ttu-id="1c0c1-152">Write application code to check the <xref:Microsoft.Xrm.Sdk.Client.IEndpointSwitch.EndpointAutoSwitchEnabled> property value to determine whether it is set to **true**.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-152">Write application code to check the <xref:Microsoft.Xrm.Sdk.Client.IEndpointSwitch.EndpointAutoSwitchEnabled> property value to determine whether it is set to **true**.</span></span> <span data-ttu-id="1c0c1-153">If **true**, consider subscribing to the <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitched> and <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitchRequired> notification events.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-153">If **true**, consider subscribing to the <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitched> and <xref:Microsoft.Xrm.Sdk.Client.ServiceProxy`1.EndpointSwitchRequired> notification events.</span></span>  
  
-   <span data-ttu-id="1c0c1-154">If your application works with critical data where any data loss is disastrous, write event handler code or catch the indicated exceptions to handle the disaster event and failover as appropriate for business needs.</span><span class="sxs-lookup"><span data-stu-id="1c0c1-154">If your application works with critical data where any data loss is disastrous, write event handler code or catch the indicated exceptions to handle the disaster event and failover as appropriate for business needs.</span></span>  
   
